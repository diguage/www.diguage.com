<!doctype html><html class=no-js lang=zh-cn><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><title>玩转 Kubernetes（一）：离线安装 Kubernetes 1 - "地瓜哥"博客网</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=keywords content="Kubernetes,Kubespray,Kubernetes,Linux,开发工具,系统架构"><meta name=description content><meta property="og:url" content="https://www.diguage.com/post/play-with-kubernetes-01-install-kubernetes-offline/"><meta property="og:site_name" content='"地瓜哥"博客网'><meta property="og:title" content="玩转 Kubernetes（一）：离线安装 Kubernetes 1"><meta property="og:description" content=' 在 基于 Docker 搭建开发环境（三）：链路追踪 等几篇文章中，D瓜哥分享了如何使用 Docker Compose 在本地搭建起来一套应用可观测性环境。感觉还不够好玩，毕竟正在在企业中，Kubernetes 已经是绝对的主流。要玩就玩最具挑战性的东西，玩最符合企业所需的技能和工具。所以，打算将上面那套简易玩具，按照企业级的要求，搬到 Kubernetes 上去。
如果想玩 Kubernetes，首先面临的一个问题就是 Kubernetes 集群的搭建。本来是一个非常简单的事情，但是由于众所周知的原因，变得非常具有挑战性。经过各种探索和多次试验，发现一种“离线”安装方式，感觉是一个不错的方式。
本方法是基于 Kubespray 的一种安装办法，Kubespray 是由 Kubernetes SIG 小组来负责维护的一整套安装方式。既可以支持在裸机环境上安装，也支持云上环境安装。而且，只需要简单几行可以复制粘贴的命令，即可完成安装工作。非常适合入门玩耍使用。
本安装方法所需的软件，D瓜哥都已经上传到 GitHub，如果需要下载，请移步： Kubespray-2.26.0 安装包大全。
搭建服务器集群 这里推荐使用 Vagrant 搭建集群。搭配 VirtualBox，只需要一个配置文件，就可以轻轻松松搭建一个 Linux 服务器集群。搭建集群的配置文件 Vagrantfile 如下：
# -*- mode: ruby -*- # vi: set ft=ruby : # @author D瓜哥 · https://www.diguage.com/ # All Vagrant configuration is done below. The "2" in Vagrant.configure # configures the configuration version (we support older styles for # backwards compatibility). Please don&#39;t change it unless you know what # you&#39;re doing. Vagrant.configure("2") do |config| # The most common configuration options are documented and commented below. # For a complete reference, please see the online documentation at # https://docs.vagrantup.com # 三节点集群 (1..3).each do |i| config.vm.define "node#{i}" do |node| # Every Vagrant development environment requires a box. You can search for # boxes at https://vagrantcloud.com/search # https://portal.cloud.hashicorp.com/vagrant/discover/bento/ubuntu-24.04 # https://portal.cloud.hashicorp.com/vagrant/discover/alvistack/ubuntu-24.04 node.vm.box = "alvistack/ubuntu-24.04" node.vm.box_version = "20250210.0.0" # 设置虚拟机的主机名 node.vm.hostname = "node#{i}" config.vm.boot_timeout = 600 # Disable automatic box update checking. If you disable this, then # boxes will only be checked for updates when the user runs # `vagrant box outdated`. This is not recommended. # config.vm.box_check_update = false # Create a forwarded port mapping which allows access to a specific port # within the machine from a port on the host machine. In the example below, # accessing "localhost:8080" will access port 80 on the guest machine. # NOTE: This will enable public access to the opened port # config.vm.network "forwarded_port", guest: 80, host: 8080 # Create a forwarded port mapping which allows access to a specific port # within the machine from a port on the host machine and only allow access # via 127.0.0.1 to disable public access # config.vm.network "forwarded_port", guest: 80, host: 8080, host_ip: "127.0.0.1" # Create a private network, which allows host-only access to the machine # using a specific IP. # 设置虚拟机的IP node.vm.network "private_network", ip: "10.0.2.#{20+i}", auto_config: true # Create a public network, which generally matched to bridged network. # Bridged networks make the machine appear as another physical device on # your network. # config.vm.network "public_network" # Share an additional folder to the guest VM. The first argument is # the path on the host to the actual folder. The second argument is # the path on the guest to mount the folder. And the optional third # argument is a set of non-required options. # 设置主机与虚拟机的共享目录，根据需要开启 node.vm.synced_folder "/path/to/#{i}", "/data" # Disable the default share of the current code directory. Doing this # provides improved isolation between the vagrant box and your host # by making sure your Vagrantfile isn&#39;t accessible to the vagrant box. # If you use this you may want to enable additional shared subfolders as # shown above. # config.vm.synced_folder ".", "/vagrant", disabled: true # Provider-specific configuration so you can fine-tune various # backing providers for Vagrant. These expose provider-specific options. # Example for VirtualBox: node.vm.provider "virtualbox" do |vb| # 设置虚拟机的名称 # vb.name = "node#{i}" # if node.vm.hostname == "node1" # # Display the VirtualBox GUI when booting the machine # vb.gui = true # end # Customize the amount of memory on the VM: vb.memory = "6144" # 设置虚拟机的CPU个数 vb.cpus = 2 end # View the documentation for the provider you are using for more # information on available options. # Enable provisioning with a shell script. Additional provisioners such as # Ansible, Chef, Docker, Puppet and Salt are also available. Please see the # documentation for more information about their specific syntax and use. # config.vm.provision "shell", inline: <<-SHELL # sudo yum makecache --refresh # sudo yum install -y tcpdump # sudo yum install -y nc # sudo yum install -y net-tools # SHELL end end end '><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2025-01-14T16:13:19+08:00"><meta property="article:modified_time" content="2025-05-27T10:28:26+08:00"><meta property="article:tag" content="Kubernetes"><meta property="article:tag" content="Linux"><meta name=twitter:card content="summary"><meta name=twitter:title content="玩转 Kubernetes（一）：离线安装 Kubernetes 1"><meta name=twitter:description content=' 在 基于 Docker 搭建开发环境（三）：链路追踪 等几篇文章中，D瓜哥分享了如何使用 Docker Compose 在本地搭建起来一套应用可观测性环境。感觉还不够好玩，毕竟正在在企业中，Kubernetes 已经是绝对的主流。要玩就玩最具挑战性的东西，玩最符合企业所需的技能和工具。所以，打算将上面那套简易玩具，按照企业级的要求，搬到 Kubernetes 上去。
如果想玩 Kubernetes，首先面临的一个问题就是 Kubernetes 集群的搭建。本来是一个非常简单的事情，但是由于众所周知的原因，变得非常具有挑战性。经过各种探索和多次试验，发现一种“离线”安装方式，感觉是一个不错的方式。
本方法是基于 Kubespray 的一种安装办法，Kubespray 是由 Kubernetes SIG 小组来负责维护的一整套安装方式。既可以支持在裸机环境上安装，也支持云上环境安装。而且，只需要简单几行可以复制粘贴的命令，即可完成安装工作。非常适合入门玩耍使用。
本安装方法所需的软件，D瓜哥都已经上传到 GitHub，如果需要下载，请移步： Kubespray-2.26.0 安装包大全。
搭建服务器集群 这里推荐使用 Vagrant 搭建集群。搭配 VirtualBox，只需要一个配置文件，就可以轻轻松松搭建一个 Linux 服务器集群。搭建集群的配置文件 Vagrantfile 如下：
# -*- mode: ruby -*- # vi: set ft=ruby : # @author D瓜哥 · https://www.diguage.com/ # All Vagrant configuration is done below. The "2" in Vagrant.configure # configures the configuration version (we support older styles for # backwards compatibility). Please don&#39;t change it unless you know what # you&#39;re doing. Vagrant.configure("2") do |config| # The most common configuration options are documented and commented below. # For a complete reference, please see the online documentation at # https://docs.vagrantup.com # 三节点集群 (1..3).each do |i| config.vm.define "node#{i}" do |node| # Every Vagrant development environment requires a box. You can search for # boxes at https://vagrantcloud.com/search # https://portal.cloud.hashicorp.com/vagrant/discover/bento/ubuntu-24.04 # https://portal.cloud.hashicorp.com/vagrant/discover/alvistack/ubuntu-24.04 node.vm.box = "alvistack/ubuntu-24.04" node.vm.box_version = "20250210.0.0" # 设置虚拟机的主机名 node.vm.hostname = "node#{i}" config.vm.boot_timeout = 600 # Disable automatic box update checking. If you disable this, then # boxes will only be checked for updates when the user runs # `vagrant box outdated`. This is not recommended. # config.vm.box_check_update = false # Create a forwarded port mapping which allows access to a specific port # within the machine from a port on the host machine. In the example below, # accessing "localhost:8080" will access port 80 on the guest machine. # NOTE: This will enable public access to the opened port # config.vm.network "forwarded_port", guest: 80, host: 8080 # Create a forwarded port mapping which allows access to a specific port # within the machine from a port on the host machine and only allow access # via 127.0.0.1 to disable public access # config.vm.network "forwarded_port", guest: 80, host: 8080, host_ip: "127.0.0.1" # Create a private network, which allows host-only access to the machine # using a specific IP. # 设置虚拟机的IP node.vm.network "private_network", ip: "10.0.2.#{20+i}", auto_config: true # Create a public network, which generally matched to bridged network. # Bridged networks make the machine appear as another physical device on # your network. # config.vm.network "public_network" # Share an additional folder to the guest VM. The first argument is # the path on the host to the actual folder. The second argument is # the path on the guest to mount the folder. And the optional third # argument is a set of non-required options. # 设置主机与虚拟机的共享目录，根据需要开启 node.vm.synced_folder "/path/to/#{i}", "/data" # Disable the default share of the current code directory. Doing this # provides improved isolation between the vagrant box and your host # by making sure your Vagrantfile isn&#39;t accessible to the vagrant box. # If you use this you may want to enable additional shared subfolders as # shown above. # config.vm.synced_folder ".", "/vagrant", disabled: true # Provider-specific configuration so you can fine-tune various # backing providers for Vagrant. These expose provider-specific options. # Example for VirtualBox: node.vm.provider "virtualbox" do |vb| # 设置虚拟机的名称 # vb.name = "node#{i}" # if node.vm.hostname == "node1" # # Display the VirtualBox GUI when booting the machine # vb.gui = true # end # Customize the amount of memory on the VM: vb.memory = "6144" # 设置虚拟机的CPU个数 vb.cpus = 2 end # View the documentation for the provider you are using for more # information on available options. # Enable provisioning with a shell script. Additional provisioners such as # Ansible, Chef, Docker, Puppet and Salt are also available. Please see the # documentation for more information about their specific syntax and use. # config.vm.provision "shell", inline: <<-SHELL # sudo yum makecache --refresh # sudo yum install -y tcpdump # sudo yum install -y nc # sudo yum install -y net-tools # SHELL end end end '><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/css/asciidoctor.css><link rel=stylesheet href=/css/rouge-monokai.css><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-1MMT2NLEL4"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-1MMT2NLEL4")}</script><script id=baidu_analytics>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?e56e7dd0a120b414f5741f4c5e5218ea",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title='"地瓜哥"博客网' rel=home><div class="logo__item logo__text"><div class=logo__title>"地瓜哥"博客网</div><div class=logo__tagline>分享技术带来的喜悦 — https://www.diguage.com/</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>菜单</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>首页</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>分类</span></a></li><li class=menu__item><a class=menu__link href=/about/><span class=menu__text>关于</span></a></li><li class=menu__item><a class=menu__link href=/archives/><span class=menu__text>归档</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>玩转 Kubernetes（一）：离线安装 Kubernetes 1</h1><div class="post__meta meta"><div class="meta__item-author meta__item"><svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 12 16"><path d="M6 1c2.2.0 3.5 2 3.5 4.5C9.5 7 8.9 8.2 8 9c2.9.8 4 2.5 4 5v1H0v-1c0-2.5 1.1-4.2 4-5-.9-.8-1.5-2-1.5-3.5C2.5 3 3.8 1 6 1z"/></svg><span class=meta__text>D瓜哥</span></div><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2025-01-14T16:13:19+08:00>2025-01-14</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/ rel=category>开发工具</a>, <a class=meta__link href=/categories/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/ rel=category>系统架构</a></span></div></div></header><figure class="post__thumbnail thumbnail"><img class=thumbnail__image src=/images/logos/kubernetes.svg alt="玩转 Kubernetes（一）：离线安装 Kubernetes 1"></figure><div class="content post__content clearfix"><div class=paragraph><p>在 <a href=https://www.diguage.com/post/building-a-develop-environment-based-on-docker-3/ target=_blank rel=noopener>基于 Docker 搭建开发环境（三）：链路追踪</a> 等几篇文章中，D瓜哥分享了如何使用 Docker Compose 在本地搭建起来一套应用可观测性环境。感觉还不够好玩，毕竟正在在企业中，Kubernetes 已经是绝对的主流。要玩就玩最具挑战性的东西，玩最符合企业所需的技能和工具。所以，打算将上面那套简易玩具，按照企业级的要求，搬到 Kubernetes 上去。</p></div><div class=paragraph><p>如果想玩 Kubernetes，首先面临的一个问题就是 Kubernetes 集群的搭建。本来是一个非常简单的事情，但是由于众所周知的原因，变得非常具有挑战性。经过各种探索和多次试验，发现一种“离线”安装方式，感觉是一个不错的方式。</p></div><div class=paragraph><p>本方法是基于 <a href=https://kubespray.io/#/ target=_blank rel=noopener>Kubespray</a> 的一种安装办法，Kubespray 是由 Kubernetes SIG 小组来负责维护的一整套安装方式。既可以支持在裸机环境上安装，也支持云上环境安装。而且，只需要简单几行可以复制粘贴的命令，即可完成安装工作。非常适合入门玩耍使用。</p></div><div class=paragraph><p>本安装方法所需的软件，D瓜哥都已经上传到 GitHub，如果需要下载，请移步： <a href=https://github.com/diguage/k8s-packages/releases/tag/2.26.0 target=_blank rel=noopener>Kubespray-2.26.0 安装包大全</a>。</p></div><div class=sect1><h2 id=_搭建服务器集群>搭建服务器集群</h2><div class=sectionbody><div class=paragraph><p>这里推荐使用 <a href=https://www.vagrantup.com/ target=_blank rel=noopener>Vagrant</a> 搭建集群。搭配 <a href=https://www.virtualbox.org/ target=_blank rel=noopener>VirtualBox</a>，只需要一个配置文件，就可以轻轻松松搭建一个 Linux 服务器集群。搭建集群的配置文件 <code>Vagrantfile</code> 如下：</p></div><div class=listingblock><div class=content><pre class="rouge highlight nowrap"><code data-lang=ruby><span class=c1># -*- mode: ruby -*-</span>
<span class=c1># vi: set ft=ruby :</span>
<span class=c1># @author D瓜哥 · <a href=https://www.diguage.com/ target=_blank>https://www.diguage.com/</a></span>

<span class=c1># All Vagrant configuration is done below. The &#34;2&#34; in Vagrant.configure</span>
<span class=c1># configures the configuration version (we support older styles for</span>
<span class=c1># backwards compatibility). Please don&#39;t change it unless you know what</span>
<span class=c1># you&#39;re doing.</span>

<span class=no>Vagrant</span><span class=p>.</span><span class=nf>configure</span><span class=p>(</span><span class=s2>&#34;2&#34;</span><span class=p>)</span> <span class=k>do</span> <span class=o>|</span><span class=n>config</span><span class=o>|</span>
  <span class=c1># The most common configuration options are documented and commented below.</span>
  <span class=c1># For a complete reference, please see the online documentation at</span>
  <span class=c1># <a href=https://docs.vagrantup.com target=_blank>https://docs.vagrantup.com</a></span>

  <span class=c1># 三节点集群</span>
  <span class=p>(</span><span class=mi>1</span><span class=o>..</span><span class=mi>3</span><span class=p>).</span><span class=nf>each</span> <span class=k>do</span> <span class=o>|</span><span class=n>i</span><span class=o>|</span>
    <span class=n>config</span><span class=p>.</span><span class=nf>vm</span><span class=p>.</span><span class=nf>define</span> <span class=s2>&#34;node</span><span class=si>#{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span> <span class=k>do</span> <span class=o>|</span><span class=n>node</span><span class=o>|</span>

      <span class=c1># Every Vagrant development environment requires a box. You can search for</span>
      <span class=c1># boxes at <a href=https://vagrantcloud.com/search target=_blank>https://vagrantcloud.com/search</a></span>
      <span class=c1># <a href=https://portal.cloud.hashicorp.com/vagrant/discover/bento/ubuntu-24.04 target=_blank>https://portal.cloud.hashicorp.com/vagrant/discover/bento/ubuntu-24.04</a></span>
      <span class=c1># <a href=https://portal.cloud.hashicorp.com/vagrant/discover/alvistack/ubuntu-24.04 target=_blank>https://portal.cloud.hashicorp.com/vagrant/discover/alvistack/ubuntu-24.04</a></span>
      <span class=n>node</span><span class=p>.</span><span class=nf>vm</span><span class=p>.</span><span class=nf>box</span> <span class=o>=</span> <span class=s2>&#34;alvistack/ubuntu-24.04&#34;</span>
      <span class=n>node</span><span class=p>.</span><span class=nf>vm</span><span class=p>.</span><span class=nf>box_version</span> <span class=o>=</span> <span class=s2>&#34;20250210.0.0&#34;</span>

      <span class=c1># 设置虚拟机的主机名</span>
      <span class=n>node</span><span class=p>.</span><span class=nf>vm</span><span class=p>.</span><span class=nf>hostname</span> <span class=o>=</span> <span class=s2>&#34;node</span><span class=si>#{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span>

      <span class=n>config</span><span class=p>.</span><span class=nf>vm</span><span class=p>.</span><span class=nf>boot_timeout</span> <span class=o>=</span> <span class=mi>600</span>

      <span class=c1># Disable automatic box update checking. If you disable this, then</span>
      <span class=c1># boxes will only be checked for updates when the user runs</span>
      <span class=c1># `vagrant box outdated`. This is not recommended.</span>
      <span class=c1># config.vm.box_check_update = false</span>

      <span class=c1># Create a forwarded port mapping which allows access to a specific port</span>
      <span class=c1># within the machine from a port on the host machine. In the example below,</span>
      <span class=c1># accessing &#34;localhost:8080&#34; will access port 80 on the guest machine.</span>
      <span class=c1># NOTE: This will enable public access to the opened port</span>
      <span class=c1># config.vm.network &#34;forwarded_port&#34;, guest: 80, host: 8080</span>

      <span class=c1># Create a forwarded port mapping which allows access to a specific port</span>
      <span class=c1># within the machine from a port on the host machine and only allow access</span>
      <span class=c1># via 127.0.0.1 to disable public access</span>
      <span class=c1># config.vm.network &#34;forwarded_port&#34;, guest: 80, host: 8080, host_ip: &#34;127.0.0.1&#34;</span>

      <span class=c1># Create a private network, which allows host-only access to the machine</span>
      <span class=c1># using a specific IP.</span>
      <span class=c1># 设置虚拟机的IP</span>
      <span class=n>node</span><span class=p>.</span><span class=nf>vm</span><span class=p>.</span><span class=nf>network</span> <span class=s2>&#34;private_network&#34;</span><span class=p>,</span> <span class=ss>ip: </span><span class=s2>&#34;10.0.2.</span><span class=si>#{</span><span class=mi>20</span><span class=o>+</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=ss>auto_config: </span><span class=kp>true</span>

      <span class=c1># Create a public network, which generally matched to bridged network.</span>
      <span class=c1># Bridged networks make the machine appear as another physical device on</span>
      <span class=c1># your network.</span>
      <span class=c1># config.vm.network &#34;public_network&#34;</span>

      <span class=c1># Share an additional folder to the guest VM. The first argument is</span>
      <span class=c1># the path on the host to the actual folder. The second argument is</span>
      <span class=c1># the path on the guest to mount the folder. And the optional third</span>
      <span class=c1># argument is a set of non-required options.</span>
      <span class=c1># 设置主机与虚拟机的共享目录，根据需要开启</span>
      <span class=n>node</span><span class=p>.</span><span class=nf>vm</span><span class=p>.</span><span class=nf>synced_folder</span> <span class=s2>&#34;/path/to/</span><span class=si>#{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;/data&#34;</span>


      <span class=c1># Disable the default share of the current code directory. Doing this</span>
      <span class=c1># provides improved isolation between the vagrant box and your host</span>
      <span class=c1># by making sure your Vagrantfile isn&#39;t accessible to the vagrant box.</span>
      <span class=c1># If you use this you may want to enable additional shared subfolders as</span>
      <span class=c1># shown above.</span>
      <span class=c1># config.vm.synced_folder &#34;.&#34;, &#34;/vagrant&#34;, disabled: true</span>

      <span class=c1># Provider-specific configuration so you can fine-tune various</span>
      <span class=c1># backing providers for Vagrant. These expose provider-specific options.</span>
      <span class=c1># Example for VirtualBox:</span>

      <span class=n>node</span><span class=p>.</span><span class=nf>vm</span><span class=p>.</span><span class=nf>provider</span> <span class=s2>&#34;virtualbox&#34;</span> <span class=k>do</span> <span class=o>|</span><span class=n>vb</span><span class=o>|</span>
        <span class=c1># 设置虚拟机的名称</span>
        <span class=c1># vb.name = &#34;node#{i}&#34;</span>

        <span class=c1># if node.vm.hostname == &#34;node1&#34;</span>
        <span class=c1>#   # Display the VirtualBox GUI when booting the machine</span>
        <span class=c1>#   vb.gui = true</span>
        <span class=c1># end</span>

        <span class=c1># Customize the amount of memory on the VM:</span>
        <span class=n>vb</span><span class=p>.</span><span class=nf>memory</span> <span class=o>=</span> <span class=s2>&#34;6144&#34;</span>

        <span class=c1># 设置虚拟机的CPU个数</span>
        <span class=n>vb</span><span class=p>.</span><span class=nf>cpus</span> <span class=o>=</span> <span class=mi>2</span>
      <span class=k>end</span>

      <span class=c1># View the documentation for the provider you are using for more</span>
      <span class=c1># information on available options.</span>

      <span class=c1># Enable provisioning with a shell script. Additional provisioners such as</span>
      <span class=c1># Ansible, Chef, Docker, Puppet and Salt are also available. Please see the</span>
      <span class=c1># documentation for more information about their specific syntax and use.</span>
      <span class=c1># config.vm.provision &#34;shell&#34;, inline: &lt;&lt;-SHELL</span>
      <span class=c1>#   sudo yum makecache --refresh</span>
      <span class=c1>#   sudo yum install -y tcpdump</span>
      <span class=c1>#   sudo yum install -y nc</span>
      <span class=c1>#   sudo yum install -y net-tools</span>
      <span class=c1># SHELL</span>
    <span class=k>end</span>
  <span class=k>end</span>
<span class=k>end</span></code></pre></div></div><div class=paragraph><p>将上述文件置于一个文件夹下，然后在终端进入该文件夹，执行 <code>vagrant up</code> 可以启动三个虚拟机。然后，配置公私钥，</p></div><details><summary class=title>点击查看：一种没有经过检验的自动配置的相互访问方法</summary><div class=content><div class=listingblock><div class=content><pre class="rouge highlight nowrap"><code data-lang=ruby><span class=c1># @author D瓜哥 · <a href=https://www.diguage.com/ target=_blank>https://www.diguage.com/</a></span>

<span class=no>Vagrant</span><span class=p>.</span><span class=nf>configure</span><span class=p>(</span><span class=s2>&#34;2&#34;</span><span class=p>)</span> <span class=k>do</span> <span class=o>|</span><span class=n>config</span><span class=o>|</span>
  <span class=c1># 定义节点</span>
  <span class=n>nodes</span> <span class=o>=</span> <span class=p>[</span>
    <span class=p>{</span> <span class=ss>name: </span><span class=s2>&#34;node1&#34;</span><span class=p>,</span> <span class=ss>ip: </span><span class=s2>&#34;192.168.56.101&#34;</span> <span class=p>},</span>
    <span class=p>{</span> <span class=ss>name: </span><span class=s2>&#34;node2&#34;</span><span class=p>,</span> <span class=ss>ip: </span><span class=s2>&#34;192.168.56.102&#34;</span> <span class=p>},</span>
    <span class=p>{</span> <span class=ss>name: </span><span class=s2>&#34;node3&#34;</span><span class=p>,</span> <span class=ss>ip: </span><span class=s2>&#34;192.168.56.103&#34;</span> <span class=p>}</span>
  <span class=p>]</span>

  <span class=c1># 通用配置</span>
  <span class=n>nodes</span><span class=p>.</span><span class=nf>each</span> <span class=k>do</span> <span class=o>|</span><span class=n>node</span><span class=o>|</span>
    <span class=n>config</span><span class=p>.</span><span class=nf>vm</span><span class=p>.</span><span class=nf>define</span> <span class=n>node</span><span class=p>[</span><span class=ss>:name</span><span class=p>]</span> <span class=k>do</span> <span class=o>|</span><span class=n>node_config</span><span class=o>|</span>
      <span class=n>node_config</span><span class=p>.</span><span class=nf>vm</span><span class=p>.</span><span class=nf>box</span> <span class=o>=</span> <span class=s2>&#34;ubuntu/bionic64&#34;</span> <span class=c1># 使用的 box 名称</span>
      <span class=n>node_config</span><span class=p>.</span><span class=nf>vm</span><span class=p>.</span><span class=nf>network</span> <span class=s2>&#34;private_network&#34;</span><span class=p>,</span> <span class=ss>ip: </span><span class=n>node</span><span class=p>[</span><span class=ss>:ip</span><span class=p>]</span>

      <span class=c1># 自动生成 SSH 密钥并分发公钥</span>
      <span class=n>node_config</span><span class=p>.</span><span class=nf>vm</span><span class=p>.</span><span class=nf>provision</span> <span class=s2>&#34;shell&#34;</span><span class=p>,</span> <span class=ss>inline: </span><span class=o>&lt;&lt;-</span><span class=no>SHELL</span><span class=sh>
        # 生成 SSH 密钥（如果不存在）
        if [ ! -f ~/.ssh/id_rsa ]; then
          ssh-keygen -t rsa -N &#34;&#34; -f ~/.ssh/id_rsa
        fi

        # 分发公钥到其他节点
        mkdir -p /vagrant/ssh_keys
        cp ~/.ssh/id_rsa.pub /vagrant/ssh_keys/</span><span class=si>#{</span><span class=n>node</span><span class=p>[</span><span class=ss>:name</span><span class=p>]</span><span class=si>}</span><span class=sh>.pub
</span><span class=no>      SHELL</span>
    <span class=k>end</span>
  <span class=k>end</span>

  <span class=c1># 第二阶段：将公钥分发到所有节点</span>
  <span class=n>nodes</span><span class=p>.</span><span class=nf>each</span> <span class=k>do</span> <span class=o>|</span><span class=n>node</span><span class=o>|</span>
    <span class=n>config</span><span class=p>.</span><span class=nf>vm</span><span class=p>.</span><span class=nf>provision</span> <span class=s2>&#34;shell&#34;</span><span class=p>,</span> <span class=ss>run: </span><span class=s2>&#34;always&#34;</span><span class=p>,</span> <span class=ss>inline: </span><span class=o>&lt;&lt;-</span><span class=no>SHELL</span><span class=sh>
      mkdir -p ~/.ssh
      chmod 700 ~/.ssh

      # 合并所有节点的公钥到 authorized_keys
      for pubkey in /vagrant/ssh_keys/*.pub; do
        cat $pubkey &gt;&gt; ~/.ssh/authorized_keys
      done

      chmod 600 ~/.ssh/authorized_keys
</span><span class=no>    SHELL</span>
  <span class=k>end</span>
<span class=k>end</span></code></pre></div></div></div></details></div></div><div class=sect1><h2 id=_修改容器镜像地址>修改容器镜像地址</h2><div class=sectionbody><div class=paragraph><p>Kubernetes 从 v1.24 起，将 Dockershim 从 Kubernetes 项目中移除。而 Kubespray 2.26.0 安装的 Kubernetes 是 v1.30.4。Kubernetes v1.30.4 是使用 containerd 这个容器运行时。所以，专门配置一下容器镜像，更方便安装 Kubernetes 以及后续使用。</p></div><div class=paragraph><p>启动好 Linux 集群后，正式安装之前，使用下面的脚本，来修改 containerd 的镜像配置。同时，也会提前下载 Kubernetes 所需的基本镜像。可以加快安装速度。</p></div><div class=listingblock><div class=content><pre class="rouge highlight nowrap"><code data-lang=bash><span class=c>#!/usr/bin/env bash</span>

<span class=c># @author D瓜哥 · <a href=https://www.diguage.com/ target=_blank>https://www.diguage.com/</a></span>

<span class=nv>CONFIG_FILE</span><span class=o>=</span>/etc/containerd/config.toml

<span class=nv>BASE_DIR</span><span class=o>=</span>/etc/containerd/certs.d

<span class=nv>K8S_VERSION</span><span class=o>=</span><span class=s1>&#39;1.30.4&#39;</span>


<span class=c># 检查 /etc/containerd/config.toml 文件是否存在，存在则修改配置</span>
<span class=c># <a href=https://blog.csdn.net/yang_song_yao/article/details/124017139 target=_blank>https://blog.csdn.net/yang_song_yao/article/details/124017139</a></span>
<span class=c># 注意：在 v1.7.24 中，会自动生成目录的配置方式。</span>
<span class=k>while </span><span class=nb>true
</span><span class=k>do
  if</span> <span class=o>[</span> <span class=nt>-f</span> <span class=k>${</span><span class=nv>CONFIG_FILE</span><span class=k>}</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
    <span class=c># 判断匹配函数，匹配函数不为0，则包含给定字符</span>
    <span class=k>if </span><span class=nb>grep</span> <span class=nt>-q</span> <span class=s1>&#39;\[plugins\.&#34;io\.containerd\.grpc\.v1\.cri&#34;\.registry\]&#39;</span> <span class=s2>&#34;</span><span class=k>${</span><span class=nv>CONFIG_FILE</span><span class=k>}</span><span class=s2>&#34;</span> <span class=o>&amp;&amp;</span> <span class=se>\</span>
       <span class=nb>grep</span> <span class=nt>-A</span> 1 <span class=s1>&#39;\[plugins\.&#34;io\.containerd\.grpc\.v1\.cri&#34;\.registry\]&#39;</span> <span class=s2>&#34;</span><span class=k>${</span><span class=nv>CONFIG_FILE</span><span class=k>}</span><span class=s2>&#34;</span> | <span class=nb>grep</span> <span class=nt>-q</span> <span class=s1>&#39;config_path = &#34;&#34;&#39;</span><span class=p>;</span> <span class=k>then</span>
      <span class=c># 按照位置来做处理的</span>
      <span class=c># sudo sed -i &#39;0,/config_path = &#34;&#34;/s|config_path = &#34;&#34;|config_path = &#34;/etc/containerd/certs.d&#34;|&#39;  ${CONFIG_FILE}</span>
      <span class=c># 根据上下文来处理</span>
      <span class=nb>sudo sed</span> <span class=nt>-i</span> <span class=s1>&#39;/\[plugins\.&#34;io\.containerd\.grpc\.v1\.cri&#34;\.registry\]/,/config_path = &#34;&#34;/s|config_path = &#34;&#34;|config_path = &#34;/etc/containerd/certs.d&#34;|&#39;</span> <span class=k>${</span><span class=nv>CONFIG_FILE</span><span class=k>}</span>
      <span class=nb>sudo sed</span> <span class=nt>-i</span> <span class=s1>&#39;/\[plugins.&#34;io.containerd.grpc.v1.cri&#34;.registry\./d&#39;</span> <span class=k>${</span><span class=nv>CONFIG_FILE</span><span class=k>}</span>
      <span class=nb>echo</span> <span class=s1>&#39;config registry config_path&#39;</span>
      <span class=nb>break
    </span><span class=k>else</span>
      <span class=c># 如果文件中不包含 config_path，则是旧配置</span>
      <span class=nb>sudo sed</span> <span class=nt>-i</span> <span class=s1>&#39;s@\[plugins.&#34;io.containerd.grpc.v1.cri&#34;.registry.mirrors\]@config_path = &#34;/etc/containerd/certs.d&#34;@g&#39;</span> <span class=k>${</span><span class=nv>CONFIG_FILE</span><span class=k>}</span>
      <span class=nb>sudo sed</span> <span class=nt>-i</span> <span class=s1>&#39;/\[plugins.&#34;io.containerd.grpc.v1.cri&#34;.registry.mirrors.&#34;docker.io&#34;\]/d&#39;</span> <span class=k>${</span><span class=nv>CONFIG_FILE</span><span class=k>}</span>
      <span class=nb>sudo sed</span> <span class=nt>-i</span> <span class=s1>&#39;/endpoint = \[&#34;https:\/\/registry-1.docker.io&#34;\]/d&#39;</span> <span class=k>${</span><span class=nv>CONFIG_FILE</span><span class=k>}</span>
      <span class=nb>echo</span> <span class=s1>&#39;config registry config_path&#39;</span>
      <span class=nb>break
    </span><span class=k>fi
  else
    </span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=k>${</span><span class=nv>CONFIG_FILE</span><span class=k>}</span><span class=s2> 文件不存在，休眠一秒钟再试…&#34;</span>
    <span class=nb>sleep </span>1 <span class=c>#休眠1秒后重试</span>
  <span class=k>fi
done

</span><span class=nb>sudo mkdir</span> <span class=nt>-p</span>  <span class=k>${</span><span class=nv>BASE_DIR</span><span class=k>}</span>/docker.io/

<span class=c># docker hub镜像加速</span>
<span class=nb>sudo tee</span> <span class=k>${</span><span class=nv>BASE_DIR</span><span class=k>}</span>/docker.io/hosts.toml <span class=o>&lt;&lt;</span> <span class=no>EOF</span><span class=sh>
server = &#34;https://docker.io&#34;

[host.&#34;https://docker.1panel.top&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://dockerpull.pw&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.13140521.xyz&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://dk.nastool.de&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.1ms.run&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.1panel.live&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://hub1.nat.tf&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.m.daocloud.io&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false
</span><span class=no>EOF


</span><span class=c># registry.k8s.io镜像加速</span>

<span class=nb>sudo mkdir</span> <span class=nt>-p</span> <span class=k>${</span><span class=nv>BASE_DIR</span><span class=k>}</span>/registry.k8s.io

<span class=nb>sudo tee</span> <span class=k>${</span><span class=nv>BASE_DIR</span><span class=k>}</span>/registry.k8s.io/hosts.toml <span class=o>&lt;&lt;</span> <span class=sh>&#39;</span><span class=no>EOF</span><span class=sh>&#39;
server = &#34;https://registry.k8s.io&#34;

[host.&#34;https://docker.1panel.top&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://dockerpull.pw&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.13140521.xyz&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://dk.nastool.de&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.1ms.run&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.1panel.live&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://hub1.nat.tf&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.m.daocloud.io&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false
</span><span class=no>EOF


</span><span class=c># gcr.io镜像加速</span>

<span class=nb>sudo mkdir</span> <span class=nt>-p</span> <span class=k>${</span><span class=nv>BASE_DIR</span><span class=k>}</span>/gcr.io

<span class=nb>sudo tee</span> <span class=k>${</span><span class=nv>BASE_DIR</span><span class=k>}</span>/gcr.io/hosts.toml <span class=o>&lt;&lt;</span> <span class=sh>&#39;</span><span class=no>EOF</span><span class=sh>&#39;
server = &#34;https://gcr.io&#34;

[host.&#34;https://docker.1panel.top&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://dockerpull.pw&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.13140521.xyz&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://dk.nastool.de&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.1ms.run&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.1panel.live&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://hub1.nat.tf&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.m.daocloud.io&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false
</span><span class=no>EOF


</span><span class=c># ghcr.io镜像加速</span>

<span class=nb>sudo mkdir</span> <span class=nt>-p</span> <span class=k>${</span><span class=nv>BASE_DIR</span><span class=k>}</span>/ghcr.io

<span class=nb>sudo tee</span> <span class=k>${</span><span class=nv>BASE_DIR</span><span class=k>}</span>/ghcr.io/hosts.toml <span class=o>&lt;&lt;</span> <span class=sh>&#39;</span><span class=no>EOF</span><span class=sh>&#39;
server = &#34;https://ghcr.io&#34;

[host.&#34;https://docker.1panel.top&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://dockerpull.pw&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.13140521.xyz&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://dk.nastool.de&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.1ms.run&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.1panel.live&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://hub1.nat.tf&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.m.daocloud.io&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false
</span><span class=no>EOF


</span><span class=c># k8s.gcr.io镜像加速</span>

<span class=nb>sudo mkdir</span> <span class=nt>-p</span> <span class=k>${</span><span class=nv>BASE_DIR</span><span class=k>}</span>/k8s.gcr.io

<span class=nb>sudo tee</span> <span class=k>${</span><span class=nv>BASE_DIR</span><span class=k>}</span>/k8s.gcr.io/hosts.toml <span class=o>&lt;&lt;</span> <span class=sh>&#39;</span><span class=no>EOF</span><span class=sh>&#39;
server = &#34;https://k8s.gcr.io&#34;

[host.&#34;https://docker.1panel.top&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://dockerpull.pw&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.13140521.xyz&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://dk.nastool.de&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.1ms.run&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.1panel.live&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://hub1.nat.tf&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.m.daocloud.io&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false
</span><span class=no>EOF

</span><span class=c># docker.elastic.co镜像加速</span>
<span class=nb>sudo mkdir</span> <span class=nt>-p</span> <span class=k>${</span><span class=nv>BASE_DIR</span><span class=k>}</span>/docker.elastic.co
<span class=nb>sudo tee</span> <span class=k>${</span><span class=nv>BASE_DIR</span><span class=k>}</span>/docker.elastic.co/hosts.toml <span class=o>&lt;&lt;</span> <span class=sh>&#39;</span><span class=no>EOF</span><span class=sh>&#39;
server = &#34;https://docker.elastic.co&#34;

[host.&#34;https://docker.1panel.top&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://dockerpull.pw&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.13140521.xyz&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://dk.nastool.de&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.1ms.run&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.1panel.live&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://hub1.nat.tf&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.m.daocloud.io&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false
</span><span class=no>EOF

</span><span class=c># mcr.m.daocloud.io镜像加速</span>
<span class=nb>sudo mkdir</span> <span class=nt>-p</span> <span class=k>${</span><span class=nv>BASE_DIR</span><span class=k>}</span>/mcr.microsoft.com
<span class=nb>sudo tee</span> <span class=k>${</span><span class=nv>BASE_DIR</span><span class=k>}</span>/mcr.microsoft.com/hosts.toml <span class=o>&lt;&lt;</span> <span class=sh>&#39;</span><span class=no>EOF</span><span class=sh>&#39;
server = &#34;https://mcr.microsoft.com&#34;

[host.&#34;https://docker.1panel.top&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://dockerpull.pw&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.13140521.xyz&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://dk.nastool.de&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.1ms.run&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.1panel.live&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://hub1.nat.tf&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.m.daocloud.io&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false
</span><span class=no>EOF

</span><span class=c># nvcr.io镜像加速</span>
<span class=nb>sudo mkdir</span> <span class=nt>-p</span> <span class=k>${</span><span class=nv>BASE_DIR</span><span class=k>}</span>/nvcr.io
<span class=nb>sudo tee</span> <span class=k>${</span><span class=nv>BASE_DIR</span><span class=k>}</span>/nvcr.io/hosts.toml <span class=o>&lt;&lt;</span> <span class=sh>&#39;</span><span class=no>EOF</span><span class=sh>&#39;
server = &#34;https://nvcr.io&#34;

[host.&#34;https://docker.1panel.top&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://dockerpull.pw&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.13140521.xyz&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://dk.nastool.de&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.1ms.run&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.1panel.live&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://hub1.nat.tf&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.m.daocloud.io&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false
</span><span class=no>EOF

</span><span class=c># quay.io镜像加速</span>
<span class=nb>sudo mkdir</span> <span class=nt>-p</span> <span class=k>${</span><span class=nv>BASE_DIR</span><span class=k>}</span>/quay.io
<span class=nb>sudo tee</span> <span class=k>${</span><span class=nv>BASE_DIR</span><span class=k>}</span>/quay.io/hosts.toml <span class=o>&lt;&lt;</span> <span class=sh>&#39;</span><span class=no>EOF</span><span class=sh>&#39;
server = &#34;https://quay.io&#34;

[host.&#34;https://docker.1panel.top&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://dockerpull.pw&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.13140521.xyz&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://dk.nastool.de&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.1ms.run&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.1panel.live&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://hub1.nat.tf&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false

[host.&#34;https://docker.m.daocloud.io&#34;]
  capabilities = [&#34;pull&#34;, &#34;resolve&#34;]
  skip_verify = false
  override_path = false
</span><span class=no>EOF

</span><span class=c># <a href=https://blog.csdn.net/IOT_AI/article/details/131975562 target=_blank>https://blog.csdn.net/IOT_AI/article/details/131975562</a></span>
<span class=c># <a href=https://blog.csdn.net/wlcs_6305/article/details/122270487 target=_blank>https://blog.csdn.net/wlcs_6305/article/details/122270487</a></span>
<span class=c># <a href=https://github.com/DaoCloud/public-image-mirror target=_blank>https://github.com/DaoCloud/public-image-mirror</a></span>

<span class=nb>sudo </span>systemctl restart containerd.service
<span class=nb>sudo </span>systemctl <span class=nb>enable </span>containerd

<span class=k>while </span><span class=nb>true
</span><span class=k>do</span>
  <span class=c># 检查是否存在 kubeadm 命令</span>
  <span class=k>if </span><span class=nb>command</span> <span class=nt>-v</span> kubeadm <span class=o>&gt;</span> /dev/null 2&gt;&amp;1<span class=p>;</span> <span class=k>then
    </span><span class=nb>echo</span> <span class=s2>&#34;kubeadm 命令存在，开始拉取镜像...&#34;</span>
    <span class=c># 执行 kubeadm config images pull</span>
    <span class=k>until </span><span class=nb>sudo </span>kubeadm config images pull <span class=nt>--kubernetes-version</span> <span class=k>${</span><span class=nv>K8S_VERSION</span><span class=k>}</span>
    <span class=k>do
      </span><span class=nb>echo</span> <span class=s2>&#34;Try again...&#34;</span>
    <span class=k>done

    </span><span class=nb>break
  </span><span class=k>else
    </span><span class=nb>echo</span> <span class=s2>&#34;kubeadm 命令不存在，休眠一秒钟再试…&#34;</span>
    <span class=nb>sleep </span>1
  <span class=k>fi
done</span></code></pre></div></div></div></div><div class=sect1><h2 id=_搭建安装文件下载服务器>搭建安装文件下载服务器</h2><div class=sectionbody><div class=paragraph><p>在宿主机中，从 <a href=https://github.com/diguage/k8s-packages/releases/tag/2.26.0 class=bare>https://github.com/diguage/k8s-packages/releases/tag/2.26.0</a> 页面，将 <a href=https://github.com/diguage/k8s-packages/releases/download/2.26.0/binary-installer.tar.gz>binary-installer.tar.gz</a> 下载并解压。然后，安装 <a href=https://caddyserver.com/ target=_blank rel=noopener>Caddy</a>，并用 Caddy 启动一个 HTTP 下载服务器。操作如下：</p></div><div class=listingblock><div class=title>举例：在 Linux 主机上操作如下</div><div class=content><pre class="rouge highlight nowrap"><code data-lang=bash><span class=c># @author D瓜哥 · <a href=https://www.diguage.com/ target=_blank>https://www.diguage.com/</a></span>

curl <span class=nt>-1sLf</span> <span class=s1>&#39;https://dl.cloudsmith.io/public/caddy/stable/gpg.key&#39;</span> <span class=se>\</span>
  | <span class=nb>sudo </span>gpg <span class=nt>--dearmor</span> <span class=nt>-o</span> /usr/share/keyrings/caddy-stable-archive-keyring.gpg

curl <span class=nt>-1sLf</span> <span class=s1>&#39;https://dl.cloudsmith.io/public/caddy/stable/debian.deb.txt&#39;</span> <span class=se>\</span>
  | <span class=nb>sudo tee</span> /etc/apt/sources.list.d/caddy-stable.list

<span class=nb>sudo </span>apt <span class=nb>install </span>caddy

caddy file-server <span class=nt>--root</span> /path/to/binary-installer <span class=nt>--listen</span> 0.0.0.0:8888 <span class=nt>--browse</span></code></pre></div></div></div></div><div class=sect1><h2 id=setup-registry>搭建容器镜像仓库</h2><div class=sectionbody><div class=paragraph><p>从 <a href=https://github.com/diguage/k8s-packages/releases/tag/2.26.0 class=bare>https://github.com/diguage/k8s-packages/releases/tag/2.26.0</a> 页面，将 <a href=https://github.com/diguage/k8s-packages/releases/download/2.26.0/container-images.tar.gz>container-images.tar.gz</a> 下载并解压，里面包含所有所需的镜像导出包。</p></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content>D瓜哥尝试在本地环境启动容器镜像仓库，但是在下载镜像时，提示必须是 HTTPS 服务。所以，建议搞一套云主机来折腾，顺便使用 Let’s Encrypt 来配置 HTTPS。如果不想找，也可以找个容器镜像仓库服务来用。</td></tr></tbody></table></div><div class="olist arabic"><ol class=arabic><li><p>执行 <code>1.setup-registry.sh</code> 来搭建一个容器镜像仓库服务</p><div class=openblock><div class=content><div class=listingblock><div class=content><pre class="rouge highlight nowrap"><code data-lang=bash><span class=c>#!/usr/bin/env bash</span>
<span class=c>#</span>
<span class=c># 启动 Docker Registry</span>
<span class=c># @author D瓜哥 · <a href=https://www.diguage.com/ target=_blank>https://www.diguage.com/</a></span>
<span class=c>#</span>

<span class=nv>IMAGE_DIR</span><span class=o>=</span><span class=si>$(</span><span class=nb>cd</span> <span class=si>$(</span><span class=nb>dirname</span> <span class=nv>$0</span><span class=si>)</span><span class=p>;</span> <span class=nb>pwd</span><span class=si>)</span>

<span class=nv>REGISTRY_PORT</span><span class=o>=</span><span class=k>${</span><span class=nv>REGISTRY_PORT</span><span class=k>:-</span><span class=s2>&#34;5000&#34;</span><span class=k>}</span>

<span class=nb>sudo </span>docker load <span class=nt>-i</span> <span class=k>${</span><span class=nv>IMAGE_DIR</span><span class=k>}</span>/registry-latest.tar

<span class=nb>sudo </span>docker container inspect registry <span class=o>&gt;</span>/dev/null 2&gt;&amp;1

<span class=nb>sudo </span>docker run <span class=nt>--restart</span><span class=o>=</span>always <span class=nt>-d</span> <span class=nt>-p</span> <span class=s2>&#34;</span><span class=k>${</span><span class=nv>REGISTRY_PORT</span><span class=k>}</span><span class=s2>&#34;</span>:<span class=s2>&#34;</span><span class=k>${</span><span class=nv>REGISTRY_PORT</span><span class=k>}</span><span class=s2>&#34;</span> <span class=nt>--name</span> registry registry:latest</code></pre></div></div></div></div></li><li><p>执行 <code>2.load-images.sh</code>，来把所有镜像加载到容器镜像仓库中</p><div class=openblock><div class=content><div class=listingblock><div class=content><pre class="rouge highlight nowrap"><code data-lang=bash><span class=c>#!/usr/bin/env bash</span>
<span class=c>#</span>
<span class=c># 加载镜像</span>
<span class=c># @author D瓜哥 · <a href=https://www.diguage.com/ target=_blank>https://www.diguage.com/</a></span>
<span class=c>#</span>

<span class=nv>REGISTRY_HOST</span><span class=o>=</span>localhost:5000

docker load <span class=nt>-i</span> ./docker.io-mirantis-k8s-netchecker-server-v1.2.2.tar
docker tag  3fe402881a14307b8d56a81a0e123d9a433f8502ac1d77d311123f3c022772ec <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/mirantis/k8s-netchecker-server:v1.2.2
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/mirantis/k8s-netchecker-server:v1.2.2

docker load <span class=nt>-i</span> ./docker.io-mirantis-k8s-netchecker-agent-v1.2.2.tar
docker tag  bf9a79a05945f73127f3bac2c89e921c951bc0445ebb968a658807fb638cdf6e <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/mirantis/k8s-netchecker-agent:v1.2.2
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/mirantis/k8s-netchecker-agent:v1.2.2

docker load <span class=nt>-i</span> ./quay.io-coreos-etcd-v3.5.12.tar
docker tag  3a5389f209cef93c0229a4916964d90d002d44cdf07f6bf4c35f64420c2a0077 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/coreos/etcd:v3.5.12
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/coreos/etcd:v3.5.12

docker load <span class=nt>-i</span> ./quay.io-cilium-cilium-v1.15.4.tar
docker tag  aebfd554d3483825021208b1a2b6ed6029cabfb4b79a8db688bcbad95ebe774b <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/cilium/cilium:v1.15.4
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/cilium/cilium:v1.15.4

docker load <span class=nt>-i</span> ./quay.io-cilium-operator-v1.15.4.tar
docker tag  cf4b9cdd4ba077d891fcc84033031f2487e9ed3bfb2224368a83d1b52aa42c50 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/cilium/operator:v1.15.4
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/cilium/operator:v1.15.4

docker load <span class=nt>-i</span> ./quay.io-cilium-hubble-relay-v1.15.4.tar
docker tag  667864766e0111a6092aa678a8800450bf181b677ad59f7c39145b433733d04c <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/cilium/hubble-relay:v1.15.4
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/cilium/hubble-relay:v1.15.4

docker load <span class=nt>-i</span> ./quay.io-cilium-certgen-v0.1.8.tar
docker tag  a283370c8d8373c5a9d80c0a9fcab27683226ab095a02861e72db9c55325aa31 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/cilium/certgen:v0.1.8
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/cilium/certgen:v0.1.8

docker load <span class=nt>-i</span> ./quay.io-cilium-hubble-ui-v0.11.0.tar
docker tag  b555a2c7b3de8de852589f81b88381bec8071d7897541feeff65ad86d4be5e40 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/cilium/hubble-ui:v0.11.0
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/cilium/hubble-ui:v0.11.0

docker load <span class=nt>-i</span> ./quay.io-cilium-hubble-ui-backend-v0.11.0.tar
docker tag  0631ce248fa693cd92f88ac6bc51485269bca3ea2b8160114ba7ba506196b167 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/cilium/hubble-ui-backend:v0.11.0
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/cilium/hubble-ui-backend:v0.11.0

docker load <span class=nt>-i</span> ./docker.io-envoyproxy-envoy-v1.22.5.tar
docker tag  e9c4ee2ce7207ce0f446892dda8f1bcc16cd6aec0c7c55d04bddca52f8af280d <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/envoyproxy/envoy:v1.22.5
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/envoyproxy/envoy:v1.22.5

docker load <span class=nt>-i</span> ./ghcr.io-k8snetworkplumbingwg-multus-cni-v3.8.tar
docker tag  c65d3833b509f9769a2e37ee7c68d6fbe54a47540b19a436455a9ee596b41100 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/k8snetworkplumbingwg/multus-cni:v3.8
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/k8snetworkplumbingwg/multus-cni:v3.8

docker load <span class=nt>-i</span> ./docker.io-flannel-flannel-v0.22.0.tar
docker tag  38c11b8f4aa1904512c0b3e93d34604de20ba24b38d4365d27fe05b7a4ce6f68 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/flannel/flannel:v0.22.0
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/flannel/flannel:v0.22.0

docker load <span class=nt>-i</span> ./docker.io-flannel-flannel-cni-plugin-v1.1.2.tar
docker tag  7a2dcab94698c786e7e41360faf8cd0ea2b29952469be75becc34c61902240e0 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/flannel/flannel-cni-plugin:v1.1.2
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/flannel/flannel-cni-plugin:v1.1.2

docker load <span class=nt>-i</span> ./quay.io-calico-node-v3.28.1.tar
docker tag  8bbeb9e1ee3287b8f750c10383f53fa1ec6f942aaea2a900f666d5e4e63cf4cc <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/calico/node:v3.28.1
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/calico/node:v3.28.1

docker load <span class=nt>-i</span> ./quay.io-calico-cni-v3.28.1.tar
docker tag  f6d76a1259a8c22fd1c603577ee5bb8109bc40f2b3d0536d39160a027ffe9bab <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/calico/cni:v3.28.1
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/calico/cni:v3.28.1

docker load <span class=nt>-i</span> ./quay.io-calico-pod2daemon-flexvol-v3.28.1.tar
docker tag  00564b1c843430f804fda219f98769c25b538adebc11504477d5ee331fd8f85b <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/calico/pod2daemon-flexvol:v3.28.1
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/calico/pod2daemon-flexvol:v3.28.1

docker load <span class=nt>-i</span> ./quay.io-calico-kube-controllers-v3.28.1.tar
docker tag  9d19dff735fa0889ad6e741790dd1ff35dc4443f14c95bd61459ff0b9162252e <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/calico/kube-controllers:v3.28.1
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/calico/kube-controllers:v3.28.1

docker load <span class=nt>-i</span> ./quay.io-calico-typha-v3.28.1.tar
docker tag  a19ab150adede78dd36481226e260735eb3b811481c6765aec79e8da6ae78b7f <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/calico/typha:v3.28.1
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/calico/typha:v3.28.1

docker load <span class=nt>-i</span> ./quay.io-calico-apiserver-v3.28.1.tar
docker tag  91dd0fd3dab3f170b52404ec5e67926439207bf71c08b7f54de8f3db6209537b <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/calico/apiserver:v3.28.1
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/calico/apiserver:v3.28.1

docker load <span class=nt>-i</span> ./docker.io-rajchaudhuri-weave-kube-2.8.7.tar
docker tag  3e91ac165aaecd4d5fd5d09ce5cb145b1941f5702eb402f58d664bbadb0b72cd <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/rajchaudhuri/weave-kube:2.8.7
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/rajchaudhuri/weave-kube:2.8.7

docker load <span class=nt>-i</span> ./docker.io-rajchaudhuri-weave-npc-2.8.7.tar
docker tag  7c7344bfd580a1e474c2958cc0ba029430fb85e6181a6d0afa55953c0cf40871 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/rajchaudhuri/weave-npc:2.8.7
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/rajchaudhuri/weave-npc:2.8.7

docker load <span class=nt>-i</span> ./docker.io-kubeovn-kube-ovn-v1.12.21.tar
docker tag  2e2403ea690b9fa2c4d53233fdf1ced0dabb1fe8f39efb6fcdf6b422ca4749d1 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/kubeovn/kube-ovn:v1.12.21
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/kubeovn/kube-ovn:v1.12.21

docker load <span class=nt>-i</span> ./docker.io-cloudnativelabs-kube-router-v2.0.0.tar
docker tag  1fa8c5c5d0d3632a0312573c4310801e8b72450e22a75924f8fcf59555ae3dc3 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/cloudnativelabs/kube-router:v2.0.0
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/cloudnativelabs/kube-router:v2.0.0

docker load <span class=nt>-i</span> ./docker.io-amazon-aws-alb-ingress-controller-v1.1.9.tar
docker tag  4b1d22ffb3c0ff343f48c6dea02be3317ce9a9e539057619c88b1ea97d205985 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/amazon/aws-alb-ingress-controller:v1.1.9
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/amazon/aws-alb-ingress-controller:v1.1.9

docker load <span class=nt>-i</span> ./docker.io-amazon-aws-ebs-csi-driver-v0.5.0.tar
docker tag  187fd7ffef67eb25c49f94a5afb0ec57f0ebfb014650983ab29b0d4b68ad4191 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/amazon/aws-ebs-csi-driver:v0.5.0
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/amazon/aws-ebs-csi-driver:v0.5.0

docker load <span class=nt>-i</span> ./docker.io-kubernetesui-dashboard-v2.7.0.tar
docker tag  07655ddf2eebe5d250f7a72c25f638b27126805d61779741b4e62e69ba080558 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/kubernetesui/dashboard:v2.7.0
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/kubernetesui/dashboard:v2.7.0

docker load <span class=nt>-i</span> ./docker.io-kubernetesui-metrics-scraper-v1.0.8.tar
docker tag  115053965e86b2df4d78af78d7951b8644839d20a03820c6df59a261103315f7 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/kubernetesui/metrics-scraper:v1.0.8
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/kubernetesui/metrics-scraper:v1.0.8

docker load <span class=nt>-i</span> ./docker.io-library-haproxy-2.8.2-alpine.tar
docker tag  a3c8e99e9327aabf90c04224a994daacdab6f16da7c6f0baed4669102cd25875 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/library/haproxy:2.8.2-alpine
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/library/haproxy:2.8.2-alpine

docker load <span class=nt>-i</span> ./docker.io-library-nginx-1.25.2-alpine.tar
docker tag  661daf9bcac824a4be78d50e09fdb7c5d3755e78295c71e1004385244c0c97b1 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/library/nginx:1.25.2-alpine
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/library/nginx:1.25.2-alpine

docker load <span class=nt>-i</span> ./docker.io-rancher-local-path-provisioner-v0.0.24.tar
docker tag  b29384aeb4b13e047448ccfd312c52b4d023abcbbaafcab174293a97821dddb0 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/rancher/local-path-provisioner:v0.0.24
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/rancher/local-path-provisioner:v0.0.24

docker load <span class=nt>-i</span> ./ghcr.io-kube-vip-kube-vip-v0.8.0.tar
docker tag  38af8ddebf499adc4631fe68b0ee224ffd6d7dd6b4aeeb393aff3d33cb94eb12 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/kube-vip/kube-vip:v0.8.0
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/kube-vip/kube-vip:v0.8.0

docker load <span class=nt>-i</span> ./quay.io-jetstack-cert-manager-cainjector-v1.14.7.tar
docker tag  7a3c1a7f8a5e7096d7b08b7b296abfd8cb04986e316fc84f99fbcb4f9dfed47a <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/jetstack/cert-manager-cainjector:v1.14.7
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/jetstack/cert-manager-cainjector:v1.14.7

docker load <span class=nt>-i</span> ./quay.io-jetstack-cert-manager-controller-v1.14.7.tar
docker tag  06ea6ac6af07a59fcfe135250c86c21b38ef6b6e7871a1511c92bc8c8f75e785 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/jetstack/cert-manager-controller:v1.14.7
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/jetstack/cert-manager-controller:v1.14.7

docker load <span class=nt>-i</span> ./quay.io-jetstack-cert-manager-webhook-v1.14.7.tar
docker tag  2c1a523c226a0b6b2e94bb109263b040b0f8f72af23cfcfeddc0f35b200a57e4 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/jetstack/cert-manager-webhook:v1.14.7
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/jetstack/cert-manager-webhook:v1.14.7

docker load <span class=nt>-i</span> ./quay.io-metallb-controller-v0.13.9.tar
docker tag  26952499c3023d9c7520c0cff480b3be67567d0cd85453d5dc83f08587c43767 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/metallb/controller:v0.13.9
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/metallb/controller:v0.13.9

docker load <span class=nt>-i</span> ./quay.io-metallb-speaker-v0.13.9.tar
docker tag  697605b359357289e5fc3737397f69b00dae7d23db5cc74ddf2f5702acf7ad63 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/metallb/speaker:v0.13.9
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/metallb/speaker:v0.13.9

docker load <span class=nt>-i</span> ./registry.k8s.io-coredns-coredns-v1.11.1.tar
docker tag  cbb01a7bd410dc08ba382018ab909a674fb0e48687f0c00797ed5bc34fcc6bb4 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/coredns/coredns:v1.11.1
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/coredns/coredns:v1.11.1

docker load <span class=nt>-i</span> ./registry.k8s.io-cpa-cluster-proportional-autoscaler-v1.8.8.tar
docker tag  b6d1a4be0743fd35029afe89eb5d5a0da894d072817575fcf6fddfa94749138b <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/cpa/cluster-proportional-autoscaler:v1.8.8
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/cpa/cluster-proportional-autoscaler:v1.8.8

docker load <span class=nt>-i</span> ./registry.k8s.io-cpa-cluster-proportional-autoscaler-v1.8.8.tar
docker tag  b6d1a4be0743fd35029afe89eb5d5a0da894d072817575fcf6fddfa94749138b <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/cpa/cluster-proportional-autoscaler:v1.8.8
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/cpa/cluster-proportional-autoscaler:v1.8.8

docker load <span class=nt>-i</span> ./registry.k8s.io-dns-k8s-dns-node-cache-1.22.28.tar
docker tag  59d295ba73230e5f3773325f65ff363d99a036cfa73153f6c6094d90ad4a359a <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/dns/k8s-dns-node-cache:1.22.28
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/dns/k8s-dns-node-cache:1.22.28

docker load <span class=nt>-i</span> ./registry.k8s.io-ingress-nginx-controller-v1.11.2.tar
docker tag  a80c8fd6e52292d38d4e58453f310d612da59d802a3b62f4b88a21c50178f7ab <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/ingress-nginx/controller:v1.11.2
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/ingress-nginx/controller:v1.11.2

docker load <span class=nt>-i</span> ./registry.k8s.io-kube-apiserver-v1.30.4.tar
docker tag  8a97b1fb3e2ebd03bf97ce8ae894b3dc8a68ab1f4ecfd0a284921c45c56f5aa4 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/kube-apiserver:v1.30.4
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/kube-apiserver:v1.30.4

docker load <span class=nt>-i</span> ./registry.k8s.io-kube-controller-manager-v1.30.4.tar
docker tag  8398ad49a121d58ecf8a36e8371c0928fdf75eb0a83d28232ab2b39b1c6a9050 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/kube-controller-manager:v1.30.4
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/kube-controller-manager:v1.30.4

docker load <span class=nt>-i</span> ./registry.k8s.io-kube-proxy-v1.30.4.tar
docker tag  568d5ba88d944bcd67415d8c358fce615824410f3a43bab2b353336bc3795a10 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/kube-proxy:v1.30.4
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/kube-proxy:v1.30.4

docker load <span class=nt>-i</span> ./registry.k8s.io-kube-scheduler-v1.30.4.tar
docker tag  4939f82ab9ab456e782c06ed37b245127c8a9ac29a72982346a7160f18107833 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/kube-scheduler:v1.30.4
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/kube-scheduler:v1.30.4

docker load <span class=nt>-i</span> ./registry.k8s.io-metrics-server-metrics-server-v0.7.0.tar
docker tag  b9a5a1927366a21e45606fe303f1d287adcb1e09d1be13dd44bdb4cf29146c86 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/metrics-server/metrics-server:v0.7.0
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/metrics-server/metrics-server:v0.7.0

docker load <span class=nt>-i</span> ./registry.k8s.io-pause-3.9.tar
docker tag  e6f1816883972d4be47bd48879a08919b96afcd344132622e4d444987919323c <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/pause:3.9
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/pause:3.9

docker load <span class=nt>-i</span> ./registry.k8s.io-provider-os-cinder-csi-plugin-v1.30.0.tar
docker tag  5736bcd73da4e2be55d2b30eea8043344089c337cc7336afcdcfc58ac8300ac0 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/provider-os/cinder-csi-plugin:v1.30.0
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/provider-os/cinder-csi-plugin:v1.30.0

docker load <span class=nt>-i</span> ./registry.k8s.io-sig-storage-csi-attacher-v3.3.0.tar
docker tag  37f46af926da00dc4997b585763a56c8b30b058af800ae3327a01361adcd3426 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/sig-storage/csi-attacher:v3.3.0
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/sig-storage/csi-attacher:v3.3.0

docker load <span class=nt>-i</span> ./registry.k8s.io-sig-storage-csi-node-driver-registrar-v2.4.0.tar
docker tag  f45c8a305a0bb15ff256a32686d56356be69e1b8d469e90a247d279ad6702382 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/sig-storage/csi-node-driver-registrar:v2.4.0
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/sig-storage/csi-node-driver-registrar:v2.4.0

docker load <span class=nt>-i</span> ./registry.k8s.io-sig-storage-csi-provisioner-v3.0.0.tar
docker tag  fe0f921f3c92aaf2167c7c373ae48f2f008c0259b288785432c150e82ab62be8 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/sig-storage/csi-provisioner:v3.0.0
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/sig-storage/csi-provisioner:v3.0.0

docker load <span class=nt>-i</span> ./registry.k8s.io-sig-storage-csi-resizer-v1.3.0.tar
docker tag  1df30f0e255525c1fdea96abd7c475e4311f9e9fc99663f7cba2972e083bfa17 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/sig-storage/csi-resizer:v1.3.0
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/sig-storage/csi-resizer:v1.3.0

docker load <span class=nt>-i</span> ./registry.k8s.io-sig-storage-csi-snapshotter-v5.0.0.tar
docker tag  c5bdb516176ec494e00061b50723fd4d8d87346f0992a3193387bb2b329adbca <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/sig-storage/csi-snapshotter:v5.0.0
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/sig-storage/csi-snapshotter:v5.0.0

docker load <span class=nt>-i</span> ./registry.k8s.io-sig-storage-local-volume-provisioner-v2.5.0.tar
docker tag  84fe61c6a33abf84fac7b4dd92d7c173440ae60119b871c0747fa6b581aacf06 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/sig-storage/local-volume-provisioner:v2.5.0
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/sig-storage/local-volume-provisioner:v2.5.0

docker load <span class=nt>-i</span> ./registry.k8s.io-sig-storage-snapshot-controller-v7.0.2.tar
docker tag  9a80c30d510050bd44c7835d92a76793af7b8a7912e2530a626da30df1af8548 <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/sig-storage/snapshot-controller:v7.0.2
docker push <span class=k>${</span><span class=nv>REGISTRY_HOST</span><span class=k>}</span>/sig-storage/snapshot-controller:v7.0.2</code></pre></div></div></div></div></li></ol></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content>这里使用的都是魔改脚本，在 <a href=https://www.diguage.com/post/play-with-kubernetes-01-install-kubernetes-offline-2/ target=_blank rel=noopener>玩转 Kubernetes（一）：离线安装 Kubernetes 2</a> 中分享了基于 Kubespray 原生支持的方案。</td></tr></tbody></table></div><div class=paragraph><p>如果有 HTTPS 证书，可以把证书下载下来，在宿主机使用 Caddy 搭建一个 Docker 镜像服务器，配置如下：</p></div><div class=listingblock><div class=content><pre class="rouge highlight nowrap"><code data-lang=bash><span class=c># @author D瓜哥 · <a href=https://www.diguage.com/ target=_blank>https://www.diguage.com/</a></span>

<span class=nv>$ </span><span class=nb>cat </span>Caddyfile
docker.example.com <span class=o>{</span> <span class=c># 网站的域名信息</span>
    tls fullchain.pem privkey.pem <span class=c># 证书和密钥的 PEM 格式的文件路径</span>
	reverse_proxy localhost:5000 <span class=c># 反向代理</span>
    log <span class=o>{</span>
        output stdout
    <span class=o>}</span>
<span class=o>}</span>

<span class=c># 在配置文件同一目录下，执行如下命令：</span>
<span class=nv>$ </span>caddy run</code></pre></div></div><div class=paragraph><p>这样就可以启动一个本地的 Docker 镜像服务。</p></div></div></div><div class=sect1><h2 id=_使用_kubespray_搭建_kubernetes_集群>使用 Kubespray 搭建 Kubernetes 集群</h2><div class=sectionbody><div class=paragraph><p>从 <a href=https://github.com/diguage/k8s-packages/releases/tag/2.26.0 class=bare>https://github.com/diguage/k8s-packages/releases/tag/2.26.0</a> 页面，将 <a href=https://github.com/diguage/k8s-packages/releases/download/2.26.0/kubespray.tar.gz>kubespray.tar.gz</a> 和 <a href=https://github.com/diguage/k8s-packages/releases/download/2.26.0/kubespray-venv.tar.gz>kubespray-venv.tar.gz</a> 下载下来，并解压到同一目录。下面正式开始安装。</p></div><div class="olist arabic"><ol class=arabic><li><p>使用 <code>vagrant ssh node1</code> 命令登录一下一个节点，退出，然后再次登录一下，这样在最后就能看到如下日志：</p><div class=openblock><div class=content><div class=listingblock><div class=content><pre class="rouge highlight nowrap"><code data-lang=bash><span class=c># @author D瓜哥 · <a href=https://www.diguage.com/ target=_blank>https://www.diguage.com/</a></span>
Last login: Wed Jan  8 09:19:16 2025 from 10.0.2.2</code></pre></div></div><div class=paragraph><p>这里的 IP <code>10.0.2.2</code> 就是宿主机的 IP 地址，这个 IP 地址可以持续在虚拟机中进行访问宿主机服务。</p></div></div></div></li><li><p>配置虚拟机 SSH 密钥相互登录及 DNS</p><div class=openblock><div class=content><div class=listingblock><div class=title><code>ssh.sh</code></div><div class=content><pre class="rouge highlight nowrap"><code data-lang=bash><span class=c>#!/usr/bin/env bash</span>

<span class=c># @author D瓜哥 · <a href=https://www.diguage.com/ target=_blank>https://www.diguage.com/</a></span>

<span class=nb>mkdir</span> <span class=nt>-p</span> ~/.ssh
<span class=nb>cp</span> /vagrant/id_ed25519 ~/.ssh/
<span class=nb>cp</span> /vagrant/id_ed25519.pub ~/.ssh/
<span class=nb>cat</span> /vagrant/id_ed25519.pub <span class=o>&gt;&gt;</span> ~/.ssh/authorized_keys

<span class=nb>echo</span> <span class=s2>&#34;10.0.2.2 docker.example.com&#34;</span> | <span class=nb>sudo tee</span> <span class=nt>-a</span> /etc/hosts</code></pre></div></div><div class=paragraph><p>在 <code>Vagrantfile</code> 文件所在的宿主机同一个目录下，创建 <code>ssh.sh</code> 脚本文件，并将上述内容复制到脚本文件中。</p></div><div class=paragraph><p>登录到每一台虚拟主机，执行 <code>bash /vagrant/ssh.sh</code> 完成虚拟机 SSH 密钥相互登录及 DNS配置</p></div></div></div></li><li><p>修改 <code>KUBESPRAY/inventory/kubestar/group_vars/all/offline.yml</code> 配置。</p><div class=openblock><div class=content><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content>目录中的 <code>kubestar</code> 是根据 Kubespray 新建的一个集群配置，已经包含在压缩包中。</td></tr></tbody></table></div><div class=listingblock><div class=content><pre class="rouge highlight nowrap"><code data-lang=bash><span class=c># @author D瓜哥 · <a href=https://www.diguage.com/ target=_blank>https://www.diguage.com/</a></span>

<span class=nt>---</span>
<span class=c>## Global Offline settings</span>

<span class=c># 可以修改这里的下载地址</span>
files_repo: <span class=s2>&#34;http://docker.example.com&#34;</span>

<span class=c>### If using CentOS, RedHat, AlmaLinux or Fedora</span>
<span class=c># yum_repo: &#34;<a href=http://myinternalyumrepo " target=_blank>http://myinternalyumrepo&#34;</a></span>
<span class=c>### If using Debian</span>
<span class=c># debian_repo: &#34;<a href=http://myinternaldebianrepo " target=_blank>http://myinternaldebianrepo&#34;</a></span>
<span class=c>### If using Ubuntu</span>
<span class=c># ubuntu_repo: &#34;<a href=http://myinternalubunturepo " target=_blank>http://myinternalubunturepo&#34;</a></span>

<span class=c>## Container Registry overrides</span>
<span class=c>### Private Container Image Registry</span>
<span class=c># 可以修改下面的代理地址，并取消注释</span>
registry_host: <span class=s2>&#34;docker.example.com&#34;</span>
kube_image_repo: <span class=s2>&#34;{{ registry_host }}&#34;</span>
gcr_image_repo: <span class=s2>&#34;{{ registry_host }}&#34;</span>
github_image_repo: <span class=s2>&#34;{{ registry_host }}&#34;</span>
docker_image_repo: <span class=s2>&#34;{{ registry_host }}&#34;</span>
quay_image_repo: <span class=s2>&#34;{{ registry_host }}&#34;</span>

<span class=c># ...省略其余没有修改的内容</span></code></pre></div></div><div class=paragraph><p>说明一下：这里重点就是修改了 <code>files_repo</code> 和 <code>registry_host</code>，告诉 Kubespray 从指定的服务端下载内容。</p></div></div></div></li><li><p>修改 <code>KUBESPRAY/inventory/kubestar/group_vars/k8s_cluster/addons.yml</code> 配置文件，打开其他一些有用的附加插件：</p><div class=openblock><div class=content><div class=listingblock><div class=content><pre class="rouge highlight nowrap"><code data-lang=bash><span class=c># @author D瓜哥 · <a href=https://www.diguage.com/ target=_blank>https://www.diguage.com/</a></span>

<span class=c># Helm deployment</span>
helm_enabled: <span class=nb>true</span>

<span class=c># Metrics Server deployment</span>
metrics_server_enabled: <span class=nb>true</span>

<span class=c># 建议打开 Local volume provisioner，</span>
<span class=c># 后续可以通过增加虚拟磁盘来完成持久化相关的测试</span>
<span class=c># Local volume provisioner deployment</span>
local_volume_provisioner_enabled: <span class=nb>true
</span>local_volume_provisioner_namespace: kube-system
local_volume_provisioner_nodelabels:
 - kubernetes.io/hostname
 - topology.kubernetes.io/region
 - topology.kubernetes.io/zone
local_volume_provisioner_storage_classes:
 local-storage:
   host_dir: /mnt/disks
   mount_dir: /mnt/disks
   volume_mode: Filesystem
   fs_type: ext4
 fast-disks:
   host_dir: /mnt/fast-disks
   mount_dir: /mnt/fast-disks
   block_cleaner_command:
     - <span class=s2>&#34;/scripts/shred.sh&#34;</span>
     - <span class=s2>&#34;2&#34;</span>
   volume_mode: Filesystem
   fs_type: ext4
local_volume_provisioner_tolerations:
 - effect: NoSchedule
   operator: Exists

<span class=c># Gateway API CRDs</span>
gateway_api_enabled: <span class=nb>true</span>

<span class=c># The plugin manager for kubectl</span>
krew_enabled: <span class=nb>true
</span>krew_root_dir: <span class=s2>&#34;/usr/local/krew&#34;</span></code></pre></div></div></div></div></li><li><p>完成上述配置，就可以开始安装了。登录到任意一台虚拟机，依次执行如下命令：</p><div class=openblock><div class=content><div class=listingblock><div class=content><pre class="rouge highlight nowrap"><code data-lang=bash><span class=c># @author D瓜哥 · <a href=https://www.diguage.com/ target=_blank>https://www.diguage.com/</a></span>

<span class=c># 设置 pip 的镜像</span>
pip config <span class=nb>set </span>global.index-url https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple

<span class=nb>cd</span> /vagrant/

<span class=nv>VENVDIR</span><span class=o>=</span>kubespray-venv
<span class=nv>KUBESPRAYDIR</span><span class=o>=</span>kubespray
python3 <span class=nt>-m</span> venv <span class=nv>$VENVDIR</span>
<span class=nb>source</span> <span class=nv>$VENVDIR</span>/bin/activate
<span class=nb>cd</span> <span class=nv>$KUBESPRAYDIR</span>
<span class=c># 上述下载的 kubespray-venv.tar.gz 即包含了所需的依赖，下载应该可以很快完成</span>
<span class=c># 在原始依赖的基础上，增加遗漏的 ruamel.yaml</span>
pip <span class=nb>install</span> <span class=nt>-U</span> <span class=nt>-r</span> requirements.txt

<span class=nb>declare</span> <span class=nt>-a</span> <span class=nv>IPS</span><span class=o>=(</span>10.0.2.21 10.0.2.22 10.0.2.23<span class=o>)</span>

<span class=nv>CONFIG_FILE</span><span class=o>=</span>inventory/kubestar/hosts.yaml python3 contrib/inventory_builder/inventory.py <span class=k>${</span><span class=nv>IPS</span><span class=p>[@]</span><span class=k>}</span>

<span class=c># 安装 Kubernetes 集群</span>
ansible-playbook <span class=nt>-i</span> inventory/kubestar/hosts.yaml  <span class=nt>--become</span> <span class=nt>--become-user</span><span class=o>=</span>root cluster.yml</code></pre></div></div></div></div></li></ol></div><div class=paragraph><p>等待二十分钟，即可完成安装。</p></div></div></div><div class=sect1><h2 id=_参考资料>参考资料</h2><div class=sectionbody><div class="olist arabic"><ol class=arabic><li><p><a href=https://github.com/kubernetes-sigs/kubespray/tree/release-2.26 target=_blank rel=noopener>kubernetes-sigs/kubespray 2.26</a></p></li><li><p><a href=https://github.com/kubernetes-sigs/kubespray/blob/release-2.26/docs/ansible/ansible.md#installing-ansible target=_blank rel=noopener>kubespray/docs/ansible/ansible</a></p></li><li><p><a href=https://gist.github.com/diguage/7b03b43b37eabd814d0534280b2438ff target=_blank rel=noopener>快速 启动一套 kubespray 集群(Ubuntu)</a></p></li><li><p><a href=https://imroc.cc/kubernetes/deploy/kubespray/offline target=_blank rel=noopener>kubespray 离线安装配置</a></p></li></ol></div></div></div></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/kubernetes/ rel=tag>Kubernetes</a></li><li class=tags__item><a class="tags__link btn" href=/tags/linux/ rel=tag>Linux</a></li></ul></div></footer></article></main><div class=clearfix><h3>看在D瓜哥码字的辛苦上，请友情支持一下，D瓜哥感激不尽，😜</h3><table><tr><td><img alt=微信打赏码 src=/images/wxpay.jpg></td><td><img alt=支付宝打赏码 src=/images/alipay.png></td></tr></table></div><br><div class=clearfix><h3>欢迎关注D瓜哥的微信公众号，在公众号可以获取我的微信二维码：</h3><img alt=微信公众号 src=/images/wx-jikerizhi.jpg></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><i class="fa icon-tip" title=Tip></i></td><td class=content><strong>公众号的微信号是: <code>jikerizhi</code></strong>。如果图片加载不出来，可以直接通过搜索公众号的微信号来查找D瓜哥的公众号。</td></tr></tbody></table></div><div class="authorbox clearfix"><figure class=authorbox__avatar><a target=_blank href=/about/><img alt="D瓜哥 avatar" src=/images/avatar.jpg class=avatar height=110 width=110></a></figure><div class=authorbox__header><span class=authorbox__name>关于 D瓜哥</span></div><div class=authorbox__description>厨艺界最好的码农，挨踢界最棒的厨师。<ul><li><a target=_blank href=https://wordpress.diguage.com/>旧版“地瓜哥”博客网</a></li><li><a target=_blank href=https://notes.diguage.com/mysql/>MySQL 学习笔记<sup>Alpha</sup></a></li><li><a target=_blank href=https://diguage.github.io/jdk-source-analysis/>JDK 源码分析<sup>Alpha</sup></a></li></ul></div></div><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/post/killercoda-cka-troubleshooting-3/ rel=prev><span class=pager__subtitle>«&#8201;上一篇</span><p class=pager__title>killercoda CKA：Troubleshooting - 3</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/post/play-with-kubernetes-01-install-kubernetes-offline-2/ rel=next><span class=pager__subtitle>下一篇&#8201;»</span><p class=pager__title>玩转 Kubernetes（一）：离线安装 Kubernetes 2</p></a></div></nav><section class=comments><div id=SOHUCS sid=/post/play-with-kubernetes-01-install-kubernetes-offline/></div><script type=text/javascript>(function(){if(window.location.hostname==="localhost")return;var n,e="cyuuTeBp3",t="prod_2906c47c31e735e0ed518282fec489a6",s=window.innerWidth||document.documentElement.clientWidth;s<960?window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id='+e+"&conf="+t+'"><\/script>'):(n=function(e,t){var s=document.getElementsByTagName("head")[0]||document.head||document.documentElement,n=document.createElement("script");n.setAttribute("type","text/javascript"),n.setAttribute("charset","UTF-8"),n.setAttribute("src",e),typeof t=="function"&&(window.attachEvent?n.onreadystatechange=function(){var e=n.readyState;(e==="loaded"||e==="complete")&&(n.onreadystatechange=null,t())}:n.onload=t),s.appendChild(n)},n("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:e,conf:t})}))})()</script></section></div><aside class=sidebar><div class="widget-search widget"><form class=widget-search__form role=search method=get action=https://google.com/search><label><input class=widget-search__field type=search placeholder=搜索… name=q aria-label=搜索…>
</label><input class=widget-search__submit type=submit value=Search>
<input type=hidden name=sitesearch value=https://www.diguage.com/></form></div><div class="widget-wechat widget"><h4 class=widget__title>微信公众号</h4><img alt=微信公众号 class=center src=/images/wx-jikerizhi-qrcode.jpg></div><div class="widget-wechat widget"><h4 class=widget__title>知识星球</h4><img alt=微信公众号 class=center src=/images/zhishixingqiu.png></div><div class="widget-recent widget"><h4 class=widget__title>近期文章</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/post/spring-boot-startup-process-overview/>Spring Boot 启动流程概述</a></li><li class=widget__item><a class=widget__link href=/post/redis-core-data-structure-4/>Redis 核心数据结构（四）</a></li><li class=widget__item><a class=widget__link href=/post/redis-core-data-structure-3/>Redis 核心数据结构（三）</a></li><li class=widget__item><a class=widget__link href=/post/algorithm-pattern-subsets/>算法模式：子集</a></li><li class=widget__item><a class=widget__link href=/post/algorithm-pattern-backtracking/>算法模式：回溯</a></li><li class=widget__item><a class=widget__link href=/post/algorithm-pattern-transform-and-conquer/>算法模式：变治法</a></li><li class=widget__item><a class=widget__link href=/post/algorithm-pattern-divide-and-conquer/>算法模式：分治法</a></li><li class=widget__item><a class=widget__link href=/post/algorithm-pattern-decrease-and-conquer/>算法模式：减治法</a></li><li class=widget__item><a class=widget__link href=/post/algorithm-pattern-topological-sort/>算法模式：拓扑排序</a></li><li class=widget__item><a class=widget__link href=/post/algorithm-pattern-union-find/>算法模式：并查集</a></li><li class=widget__item><a class=widget__link href=/post/algorithm-pattern-trie/>算法模式：前缀树</a></li><li class=widget__item><a class=widget__link href=/post/algorithm-pattern-depth-first-search/>算法模式：深度优先搜索</a></li><li class=widget__item><a class=widget__link href=/post/algorithm-pattern-breadth-first-search/>算法模式：广度优先搜索</a></li><li class=widget__item><a class=widget__link href=/post/algorithm-pattern-k-way-merge/>算法模式：多路归并</a></li><li class=widget__item><a class=widget__link href=/post/algorithm-pattern-two-heaps/>算法模式：双堆</a></li><li class=widget__item><a class=widget__link href=/post/algorithm-pattern-cyclic-sort/>算法模式：循环排序</a></li><li class=widget__item><a class=widget__link href=/post/algorithm-pattern-quickselect/>算法模式：快速选择</a></li><li class=widget__item><a class=widget__link href=/post/algorithm-pattern-top-k-elements/>算法模式：Top K 问题</a></li><li class=widget__item><a class=widget__link href=/post/algorithm-pattern-monotonic-stack/>算法模式：单调栈</a></li><li class=widget__item><a class=widget__link href=/post/algorithm-pattern-sliding-window/>算法模式：滑动窗口</a></li></ul></div></div><div class="widget-categories widget"><h4 class=widget__title>分类</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/categories/%E4%B8%AA%E4%BA%BA%E6%88%90%E9%95%BF/>个人成长</a></li><li class=widget__item><a class=widget__link href=/categories/%E5%88%86%E5%B8%83%E5%BC%8F/>分布式</a></li><li class=widget__item><a class=widget__link href=/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/>开发工具</a></li><li class=widget__item><a class=widget__link href=/categories/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/>性能优化</a></li><li class=widget__item><a class=widget__link href=/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/>操作系统</a></li><li class=widget__item><a class=widget__link href=/categories/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/>数据存储</a></li><li class=widget__item><a class=widget__link href=/categories/%E6%96%87%E5%AD%A6/>文学</a></li><li class=widget__item><a class=widget__link href=/categories/%E6%96%B9%E6%B3%95%E8%AE%BA/>方法论</a></li><li class=widget__item><a class=widget__link href=/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/>程序设计</a></li><li class=widget__item><a class=widget__link href=/categories/%E7%AE%97%E6%B3%95/>算法</a></li><li class=widget__item><a class=widget__link href=/categories/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/>系统架构</a></li><li class=widget__item><a class=widget__link href=/categories/%E7%BB%8F%E6%B5%8E%E9%87%91%E8%9E%8D/>经济金融</a></li><li class=widget__item><a class=widget__link href=/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/>编程语言</a></li><li class=widget__item><a class=widget__link href=/categories/%E7%BD%91%E7%BB%9C/>网络</a></li><li class=widget__item><a class=widget__link href=/categories/%E8%81%8C%E4%B8%9A%E5%8F%91%E5%B1%95/>职业发展</a></li><li class=widget__item><a class=widget__link href=/categories/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/>软件工程</a></li><li class=widget__item><a class=widget__link href=/categories/%E9%80%B8%E9%97%BB%E8%B6%A3%E4%BA%8B/>逸闻趣事</a></li><li class=widget__item><a class=widget__link href=/categories/%E9%98%85%E8%AF%BB%E6%91%98%E8%A6%81/>阅读摘要</a></li></ul></div></div><div class="widget-taglist widget"><h4 class=widget__title>标签</h4><div class=widget__content><a class="widget-taglist__link widget__link btn" href=/tags/gc/ title=GC>GC (9)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/http/ title=HTTP>HTTP (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/java/ title=Java>Java (64)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/jvm/ title=JVM>JVM (2)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/kpi/ title=KPI>KPI (4)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/kubernetes/ title=Kubernetes>Kubernetes (10)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/linux/ title=Linux>Linux (12)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/okr/ title=OKR>OKR (5)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/redis/ title=Redis>Redis (2)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/shell/ title=Shell>Shell (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/spring/ title=Spring>Spring (26)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/tcp/ title=TCP>TCP (2)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/udp/ title=UDP>UDP (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/zookeeper/ title=ZooKeeper>ZooKeeper (2)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E4%B8%AA%E4%BA%BA%E6%8F%90%E5%8D%87/ title=个人提升>个人提升 (10)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E4%B9%A6%E7%B1%8D/ title=书籍>书籍 (15)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E4%BA%A7%E5%93%81/ title=产品>产品 (7)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E5%80%BA%E5%88%B8/ title=债券>债券 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E5%88%86%E5%B8%83%E5%BC%8F/ title=分布式>分布式 (15)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E5%88%86%E6%B2%BB/ title=分治>分治 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/ title=动态规划>动态规划 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E5%9B%A2%E9%98%9F%E5%BB%BA%E8%AE%BE/ title=团队建设>团队建设 (6)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E5%9B%A2%E9%98%9F%E6%96%87%E5%8C%96/ title=团队文化>团队文化 (4)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E5%9B%BE/ title=图>图 (7)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E5%9F%BA%E9%87%91/ title=基金>基金 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E5%A0%86/ title=堆>堆 (3)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E5%AD%98%E5%82%A8/ title=存储>存储 (6)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E5%B7%A5%E4%BD%9C%E6%96%B9%E6%B3%95/ title=工作方法>工作方法 (5)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E5%B9%B6%E5%8F%91/ title=并发>并发 (3)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E5%BA%8F%E5%88%97%E5%8C%96/ title=序列化>序列化 (10)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/ title=微服务>微服务 (17)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E5%BF%83%E7%90%86%E5%AD%A6/ title=心理学>心理学 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/ title=性能测试>性能测试 (4)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E6%8A%95%E8%B5%84%E7%90%86%E8%B4%A2/ title=投资理财>投资理财 (5)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/ title=数据库>数据库 (10)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/ title=数据结构>数据结构 (4)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E6%95%B0%E7%BB%84/ title=数组>数组 (13)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E6%96%B9%E6%B3%95%E8%AE%BA/ title=方法论>方法论 (13)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E6%97%85%E8%A1%8C/ title=旅行>旅行 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/ title=最佳实践>最佳实践 (10)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E6%9E%B6%E6%9E%84/ title=架构>架构 (44)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E6%A0%88/ title=栈>栈 (3)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E6%A0%91/ title=树>树 (11)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E6%B2%9F%E9%80%9A%E6%8A%80%E5%B7%A7/ title=沟通技巧>沟通技巧 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ title=源码分析>源码分析 (8)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E7%90%86%E8%B4%A2/ title=理财>理财 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E7%94%9F%E6%B4%BB/ title=生活>生活 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E7%AC%94%E8%AE%B0/ title=笔记>笔记 (5)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E7%AE%97%E6%B3%95/ title=算法>算法 (8)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E7%AE%97%E6%B3%95%E6%A8%A1%E5%BC%8F/ title=算法模式>算法模式 (23)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E7%BB%8F%E6%B5%8E/ title=经济>经济 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E7%BC%96%E7%A0%81/ title=编码>编码 (3)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E7%BD%91%E7%BB%9C/ title=网络>网络 (2)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E7%BF%BB%E8%AF%91/ title=翻译>翻译 (7)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E8%82%A1%E7%A5%A8/ title=股票>股票 (5)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E8%84%91%E5%9B%BE/ title=脑图>脑图 (5)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E8%8A%82%E6%97%A5/ title=节日>节日 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E8%8B%B1%E8%AF%AD/ title=英语>英语 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/ title=虚拟机>虚拟机 (9)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E8%AE%BA%E6%96%87/ title=论文>论文 (2)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E8%AE%BE%E8%AE%A1/ title=设计>设计 (36)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/ title=设计模式>设计模式 (3)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E8%AF%97%E6%AD%8C/ title=诗歌>诗歌 (2)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E8%AF%BB%E4%B9%A6/ title=读书>读书 (5)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E9%80%92%E5%BD%92/ title=递归>递归 (1)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E9%87%91%E8%9E%8D/ title=金融>金融 (5)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E9%93%BE%E8%A1%A8/ title=链表>链表 (5)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/ title=面向对象>面向对象 (5)</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1/ title=领域驱动设计>领域驱动设计 (5)</a></div></div><div class="widget-social widget"><h4 class="widget-social__title widget__title">社交</h4><div class="widget-social__content widget__content"><div class="widget-social__item widget__item"><a class="widget-social__link widget__link btn" title=Twitter rel="noopener noreferrer" href=https://twitter.com/diguage target=_blank><svg class="widget-social__link-icon icon icon-twitter" width="24" height="24" viewBox="0 0 384 312"><path d="m384 36.9c-14.1 6.3-29.3 10.5-45.2 12.4 16.3-9.7 28.8-25.2 34.6-43.6-15.2 9-32.1 15.6-50 19.1-14.4-15.2-34.9-24.8-57.5-24.8-43.5.0-78.8 35.3-78.8 78.8.0 6.2.7 12.2 2 17.9-65.5-3.3-123.5-34.6-162.4-82.3C20 26 16.1 39.6 16.1 54c0 27.3 13.9 51.4 35 65.6-12.9-.4-25.1-4-35.7-9.9v1c0 38.2 27.2 70 63.2 77.2-6.6 1.8-13.6 2.8-20.8 2.8-5.1.0-10-.5-14.8-1.4 10 31.3 39.1 54.1 73.6 54.7-27 21.1-60.9 33.7-97.8 33.7-6.4.0-12.6-.4-18.8-1.1C34.9 299 76.3 312 120.8 312c144.9.0 224.1-120 224.1-224.1.0-3.4-.1-6.8-.2-10.2 15.4-11.1 28.7-25 39.3-40.8z"/></svg>
<span>Twitter</span></a></div><div class="widget-social__item widget__item"><a class="widget-social__link widget__link btn" title=GitHub rel="noopener noreferrer" href=https://github.com/diguage target=_blank><svg class="widget-social__link-icon icon icon-github" width="24" height="24" viewBox="0 0 384 374"><path d="m192 0C85.9.0.0 85.8.0 191.7c0 84.7 55 156.6 131.3 181.9 9.6 1.8 13.1-4.2 13.1-9.2.0-4.6-.2-16.6-.3-32.6-53.4 11.6-64.7-25.7-64.7-25.7-8.7-22.1-21.3-28-21.3-28-17.4-11.9 1.3-11.6 1.3-11.6 19.3 1.4 29.4 19.8 29.4 19.8 17.1 29.3 44.9 20.8 55.9 15.9 1.7-12.4 6.7-20.8 12.2-25.6-42.6-4.8-87.5-21.3-87.5-94.8.0-20.9 7.5-38 19.8-51.4-2-4.9-8.6-24.3 1.9-50.7.0.0 16.1-5.2 52.8 19.7 15.3-4.2 31.7-6.4 48.1-6.5 16.3.1 32.7 2.2 48.1 6.5 36.7-24.8 52.8-19.7 52.8-19.7 10.5 26.4 3.9 45.9 1.9 50.7 12.3 13.4 19.7 30.5 19.7 51.4.0 73.7-44.9 89.9-87.7 94.6 6.9 5.9 13 17.6 13 35.5.0 25.6-.2 46.3-.2 52.6.0 5.1 3.5 11.1 13.2 9.2C329 348.2 384 276.4 384 191.7 384 85.8 298 0 192 0z"/></svg>
<span>GitHub</span></a></div><div class="widget-social__item widget__item"><a class="widget-social__link widget__link btn" title=Email href=mailto:leejun119@gmail.com><svg class="widget-social__link-icon icon icon-mail" width="24" height="24" viewBox="0 0 416 288"><path d="m0 16v256 16h16 384 16v-16V16 0h-16H16 0zm347 16-139 92.5L69 32zM199 157.5l9 5.5 9-5.5L384 46v210H32V46z"/></svg>
<span>leejun119@gmail.com</span></a></div></div></div></aside></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 "地瓜哥"博客网.
<span class=footer__copyright-credits>基于 <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> 引擎和 <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> 主题</span>
<span><a href=https://beian.miit.gov.cn/ target=_target>京ICP备14046450号-4</a></span></div></div></footer></div><script async defer src=/js/menu.js></script><script type=text/x-mathjax-config>
	MathJax.Hub.Config({
	  messageStyle: "none",
	  tex2jax: {
		inlineMath: [["\\(", "\\)"]],
		displayMath: [["\\[", "\\]"]],
		ignoreClass: "nostem|nolatexmath"
	  },
	  asciimath2jax: {
		delimiters: [["\\$", "\\$"]],
		ignoreClass: "nostem|noasciimath"
	  },
	  TeX: { equationNumbers: { autoNumber: "none" } }
	})
	MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
	  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
		if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
		  data.math.root.display = "block"
		}
		return data
	  })
	})
</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML" async></script></body></html>