---
title: "Hessian åè®®è§£é‡Šä¸å®æˆ˜ï¼ˆäº”ï¼‰ï¼šå¯¹è±¡ä¸æ˜ å°„"
date: 2022-05-31T16:02:13+08:00
draft: false
keywords: ["Hessian","åºåˆ—åŒ–","åè®®","Java","å¾®æœåŠ¡","æ¶æ„","ç¨‹åºè®¾è®¡"]
tags: ["Java","å¾®æœåŠ¡","æ¶æ„","è®¾è®¡","åºåˆ—åŒ–"]
categories: ["ç³»ç»Ÿæ¶æ„","ç¨‹åºè®¾è®¡"]
thumbnail: "images/common/confused-target-vector.jpg"

weight: 1
---


å‰æ®µæ—¶é—´ï¼Œç¿»è¯‘äº† Hessian 2.0 çš„åºåˆ—åŒ–åè®®ï¼Œå‘å¸ƒåœ¨äº† https://www.diguage.com/post/hessian-serialization-protocol/[Hessian 2.0 åºåˆ—åŒ–åè®®ï¼ˆä¸­æ–‡ç‰ˆï¼‰^]ã€‚ä½†æ˜¯ï¼Œå…¶ä¸­æœ‰å¾ˆå¤šè¨€è¯­ä¸è¯¦ä¹‹å¤„ã€‚æ‰€ä»¥ï¼Œæ¥ä¸‹æ¥ä¼šç”¨å‡ ç¯‡æ–‡ç« æ¥è¯¦ç»†è§£é‡Šå¹¶å®è·µä¸€ä¸‹ Hessian åºåˆ—åŒ–åè®®ï¼Œä»¥æ±‚åšåˆ°çŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶ã€‚ç›®å½•å¦‚ä¸‹ï¼š

. https://www.diguage.com/post/hessian-protocol-interpretation-and-practice-1/[Hessian åè®®è§£é‡Šä¸å®æˆ˜ï¼ˆä¸€ï¼‰ï¼šå¸ƒå°”ã€æ—¥æœŸã€æµ®ç‚¹æ•°ä¸æ•´æ•°^] -- ä»‹ç»å¸ƒå°”å‹æ•°æ®ã€æ—¥æœŸç±»å‹ã€æµ®ç‚¹ç±»å‹æ•°æ®å’Œæ•´æ•°ç±»å‹æ•°æ®ç­‰å››ç§ç±»å‹çš„æ•°æ®çš„å¤„ç†ã€‚
. https://www.diguage.com/post/hessian-protocol-interpretation-and-practice-2/[Hessian åè®®è§£é‡Šä¸å®æˆ˜ï¼ˆäºŒï¼‰ï¼šé•¿æ•´å‹ã€äºŒè¿›åˆ¶æ•°æ®ä¸ Null^] -- ä»‹ç»é•¿æ•´æ•°ç±»å‹æ•°æ®ã€äºŒè¿›åˆ¶æ•°æ®å’Œ `null` ç­‰ä¸‰ç§ç±»å‹çš„æ•°æ®çš„å¤„ç†ã€‚
. https://www.diguage.com/post/hessian-protocol-interpretation-and-practice-3/[Hessian åè®®è§£é‡Šä¸å®æˆ˜ï¼ˆä¸‰ï¼‰ï¼šå­—ç¬¦ä¸²^] -- ä¸“é—¨ä»‹ç»äº†å…³äºå­—ç¬¦ä¸²çš„å¤„ç†ã€‚ç”±äºå­—ç¬¦ä¸²éœ€è¦é“ºå«çš„åŸºç¡€çŸ¥è¯†æ¯”è¾ƒå¤šï¼Œå¤„ç†ç»†èŠ‚ä¹Ÿæœ‰ç¹çï¼Œæ‰€ä»¥å•ç‹¬æˆç¯‡æ¥ä»‹ç»ã€‚
. https://www.diguage.com/post/hessian-source-analysis-for-java/[Hessian æºç åˆ†æï¼ˆJavaï¼‰^] -- å¼€å§‹ç¬¬å››ç¯‡åˆ†æä¹‹å‰ï¼Œå…ˆæ¥ä»‹ç»ä¸€ä¸‹ Hessian çš„æºç å®ç°ã€‚æ–¹ä¾¿åç»­å±•å¼€è¯´æ˜ã€‚
. https://www.diguage.com/post/hessian-protocol-interpretation-and-practice-4/[Hessian åè®®è§£é‡Šä¸å®æˆ˜ï¼ˆå››ï¼‰ï¼šæ•°ç»„ä¸é›†åˆ^] -- é“ºå«äº†ä¸€äº›å…³äºå®ä¾‹å¯¹è±¡çš„å¤„ç†ï¼Œé‡ç‚¹ä»‹ç»å…³äºæ•°ç»„å’Œé›†åˆçš„ç›¸å…³å¤„ç†ã€‚
. https://www.diguage.com/post/hessian-protocol-interpretation-and-practice-5/[Hessian åè®®è§£é‡Šä¸å®æˆ˜ï¼ˆäº”ï¼‰ï¼šå¯¹è±¡ä¸æ˜ å°„^] -- é‡ç‚¹ä»‹ç»å…³äºå¯¹è±¡ä¸æ˜ å°„çš„ç›¸å…³å¤„ç†ã€‚
. https://www.diguage.com/post/hessian-vs-msgpack-vs-json/[Hessianã€Msgpack å’Œ JSON å®ä¾‹å¯¹æ¯”^] -- ç”¨å®ä¾‹å¯¹æ¯” JSONã€Hessian å’Œ MessagePack çš„åŒºåˆ«ã€‚
. æœªå®Œå¾…ç»­ï¼Œæ•¬è¯·ç»§ç»­å…³æ³¨ https://www.diguage.com/["åœ°ç“œå“¥"åšå®¢ç½‘^]ã€‚

åœ¨ä¸Šä¸€ç¯‡æ–‡ç«  https://www.diguage.com/post/hessian-protocol-interpretation-and-practice-4/[Hessian åè®®è§£é‡Šä¸å®æˆ˜ï¼ˆå››ï¼‰ï¼šæ•°ç»„ä¸é›†åˆ^] ä¸­ç ”ç©¶äº†æ•°ç»„å’Œé›†åˆçš„å¤„ç†æ–¹å¼ã€‚æ¥ä¸‹æ¥ä»‹ç»å¯¹è±¡å’Œæ˜ å°„çš„å¤„ç†ã€‚

== åŸºç¡€å·¥å…·æ–¹æ³•

åŸºç¡€å·¥å…·æ–¹æ³•å°±ä¸å†èµ˜è¿°ï¼Œè¯·ç›´æ¥å‚è€ƒ https://www.diguage.com/post/hessian-protocol-interpretation-and-practice-1/#helper-methods[Hessian åè®®è§£é‡Šä¸å®æˆ˜ï¼ˆä¸€ï¼‰ï¼šåŸºç¡€å·¥å…·æ–¹æ³•^] ä¸­æåˆ°çš„å‡ ä¸ªæ–¹æ³•ã€‚

å¦å¤–ï¼Œåœ¨ https://www.diguage.com/post/hessian-protocol-interpretation-and-practice-4/[Hessian åè®®è§£é‡Šä¸å®æˆ˜ï¼ˆå››ï¼‰ï¼šæ•°ç»„ä¸é›†åˆ^] ä¸­ï¼Œåˆå¯¹ä¸€äº›æ–¹æ³•åšäº†æ‰©å±•å’Œæ›´æ–°ã€‚

ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€çœ‹æ˜ å°„çš„å¤„ç†ã€‚

[#map]
== æ˜ å°„

å¦ç™½è®²ï¼Œä¸ªäººè§‰å¾— https://www.diguage.com/post/hessian-serialization-protocol/#map[Hessian 2.0 åºåˆ—åŒ–åè®®ï¼ˆä¸­æ–‡ç‰ˆï¼‰ï¼šæ˜ å°„^] çš„åè®®å®šä¹‰å†™çš„éå¸¸æ¨¡ç³Šã€‚å€’æ˜¯ç»™çš„ç¤ºä¾‹ï¼Œè¿˜å¯åœˆå¯ç‚¹ã€‚

=== ç›¸å…³ä»£ç å®ç°

é€šè¿‡ https://www.diguage.com/post/hessian-source-analysis-for-java/[Hessian æºç åˆ†æï¼ˆJavaï¼‰^] å¯ä»¥æŒ‡å®šï¼Œ `MapSerializer` æ˜¯å¤„ç†æ˜ å°„çš„ `Serializer`ã€‚æ‰€ä»¥ï¼Œåªéœ€è¦å…³æ³¨ä¸€ä¸‹ `MapSerializer` å°±å¯ä»¥å¯¹æ˜ å°„çš„å¤„ç†ä¸€ç›®äº†ç„¶ã€‚ç»“åˆä»£ç ï¼Œå¯ä»¥çœ‹å‡ºï¼Œæ˜ å°„çš„åºåˆ—åŒ–æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š

. `AbstractHessianOutput.writeMapBegin(String type)` -- å†™å…¥æ˜ å°„èµ·å§‹ä¿¡æ¯ï¼›
. éå† `Map.Entry`ï¼Œå¹¶ä¸”æ˜¯å…ˆåºåˆ—åŒ– Keyï¼Œç„¶ååºåˆ—åŒ– Valueï¼›
. `AbstractHessianOutput.writeMapEnd()` -- å†™å…¥æ˜ å°„ç»“æŸä¿¡æ¯ã€‚

å¦å¤–ï¼Œåœ¨ https://www.diguage.com/post/hessian-source-analysis-for-java/[Hessian æºç åˆ†æï¼ˆJavaï¼‰^] ä¸­ï¼Œä¹Ÿæåˆ°åœ¨ `Hessian2Output` ä¸­å®ç°äº† `AbstractHessianOutput` çš„æ¥å£ã€‚æ‰€ä»¥ï¼Œåªéœ€è¦å…³æ³¨ `Hessian2Output` å¯¹ä¸Šè¿°æ–¹æ³•çš„å®ç°å³å¯ã€‚

åœ¨ `Hessian2Output` ä¸­å¯ä»¥çœ‹å‡ºï¼š

. `Hessian2Output.writeMapBegin(String type)` æœ‰ä¸¤ä¸ªç±»å‹ï¼š
.. éœ€è¦å†™å…¥ç±»å‹ï¼š `M`ï¼Œå‰ç½®æ ‡å¿—ä½åæ˜¯æ˜ å°„ç±»å‹ä¿¡æ¯ï¼›
.. ä¸éœ€è¦å†™å…¥ç±»å‹ï¼š `H`ï¼Œè¿™é‡Œæ²¡æœ‰å†™å…¥ç±»å‹ä¿¡æ¯ã€‚
. `AbstractHessianOutput.writeMapEnd()` -- æ˜ å°„ç»“æŸä¿¡æ¯åªæœ‰ä¸€ä¸ªç»“æŸæ ‡å¿—ä½ï¼š `Z`ã€‚è¿™ä¸ªæ ‡å¿—ä½ï¼Œåœ¨ https://www.diguage.com/post/hessian-protocol-interpretation-and-practice-4/#iterator[Hessian åè®®è§£é‡Šä¸å®æˆ˜ï¼ˆå››ï¼‰ï¼šæ•°ç»„ä¸é›†åˆï¼š `Collection<Integer>.iterator` ğŸ‘‰ `IteratorSerializer`^] ä¸­ä¹Ÿç”¨åˆ°äº†ã€‚

ä¸‹é¢å¼€å§‹åšå®éªŒæ¥éªŒè¯ã€‚

=== `HashMap`

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹åºåˆ—åŒ–æ“ä½œï¼š

[source%nowrap,java,{source_attr}]
----
/**
 * æµ‹è¯• HashMap çš„åºåˆ—åŒ–
 *
 * @author Dç“œå“¥ Â· https://www.diguage.com/
 */
@Test
public void testHashMap() throws Throwable {
    // ç”± MapSerializer æ¥å¤„ç†ã€‚åˆ†ä¸‰æ­¥æ¥å¤„ç†ï¼š
    // 1ã€é¦–å…ˆï¼Œå†™å…¥å‰ç½®æ ‡å¿—ä½ BC_MAP_UNTYPED = 'H'
    // 2ã€å…¶æ¬¡ï¼Œéå† Map.Entryï¼Œå¹¶å°†å…¶åºåˆ—åŒ–ï¼šâ‘ Key â‘¡Value
    // 3ã€æœ€åï¼Œå†™å…¥ç»“æŸæ ‡å¿—ä½ BC_END = 'Z'
    Map<Integer, Car> map = new HashMap<>();
    map.put(1, new Car("diguage", 47));
    objectTo(map);
}


// -- è¾“å‡ºç»“æœ ------------------------------------------------
== Object: java.util.HashMap  ==
== Key Object: java.lang.Integer  ==
== Val Object: com.diguage.Car  ==
{"1":{"name":"diguage","age":47}}
== byte array: hessian result ==
.... 0 ~ 40 ....
  72 0x48 01001000 H 
-111 0x91 10010001 
  67 0x43 01000011 C 
  15 0x0F 00001111  
  99 0x63 01100011 c 
 111 0x6F 01101111 o 
 109 0x6D 01101101 m 
  46 0x2E 00101110 . 
 100 0x64 01100100 d 
 105 0x69 01101001 i 
 103 0x67 01100111 g 
 117 0x75 01110101 u 
  97 0x61 01100001 a 
 103 0x67 01100111 g 
 101 0x65 01100101 e 
  46 0x2E 00101110 . 
  67 0x43 01000011 C 
  97 0x61 01100001 a 
 114 0x72 01110010 r 
-110 0x92 10010010 
   4 0x04 00000100  
 110 0x6E 01101110 n 
  97 0x61 01100001 a 
 109 0x6D 01101101 m 
 101 0x65 01100101 e 
   3 0x03 00000011  
  97 0x61 01100001 a 
 103 0x67 01100111 g 
 101 0x65 01100101 e 
  96 0x60 01100000 ` 
   7 0x07 00000111  
 100 0x64 01100100 d 
 105 0x69 01101001 i 
 103 0x67 01100111 g 
 117 0x75 01110101 u 
  97 0x61 01100001 a 
 103 0x67 01100111 g 
 101 0x65 01100101 e 
 -65 0xBF 10111111 
  90 0x5A 01011010 Z 
----

ä»ç»“æœä¸Šæ¥çœ‹ï¼Œè·Ÿæˆ‘ä»¬ä¸Šé¢çš„åˆ†æå·®ä¸å¤šï¼Œç¡®å®šäº†ä¸€äº›ç»†èŠ‚ï¼š

. é¦–å…ˆï¼Œå†™å…¥å‰ç½®æ ‡å¿—ä½ `0x48`ï¼ˆ`H`ï¼‰
. å…¶æ¬¡ï¼Œéå† `Map.Entry`ï¼Œå¹¶å°†å…¶åºåˆ—åŒ–
.. Key
.. Value
. æœ€åï¼Œå†™å…¥ç»“æŸæ ‡å¿—ä½ `0x5A`ï¼ˆ`Z`ï¼‰ã€‚

æ¥ä¸‹æ¥å†çœ‹çœ‹å…¶ä»–ç±»å‹çš„ `Map` çš„å¤„ç†æƒ…å†µã€‚

=== `TreeMap`

æ¥çœ‹çœ‹ `TreeMap` çš„å¤„ç†æƒ…å†µï¼š

[source%nowrap,java,{source_attr}]
----
/**
 * æµ‹è¯• TreeMap çš„åºåˆ—åŒ–
 *
 * @author Dç“œå“¥ Â· https://www.diguage.com/
 */
@Test
public void testTreeMap() throws Throwable {
    Car c = new Car("diguage", 47);
    Map<Integer, Car> map = new TreeMap<>();
    map.put(1, c);
    objectTo(map);
}


// -- è¾“å‡ºç»“æœ ------------------------------------------------
== Object: java.util.TreeMap  ==
== Key Object: java.lang.Integer  ==
== Val Object: com.diguage.Car  ==
{"1":{"name":"diguage","age":47}}
== byte array: hessian result ==
.... 0 ~ 58 ....
  77 0x4D 01001101 M 
  17 0x11 00010001  
 106 0x6A 01101010 j 
  97 0x61 01100001 a 
 118 0x76 01110110 v 
  97 0x61 01100001 a 
  46 0x2E 00101110 . 
 117 0x75 01110101 u 
 116 0x74 01110100 t 
 105 0x69 01101001 i 
 108 0x6C 01101100 l 
  46 0x2E 00101110 . 
  84 0x54 01010100 T 
 114 0x72 01110010 r 
 101 0x65 01100101 e 
 101 0x65 01100101 e 
  77 0x4D 01001101 M 
  97 0x61 01100001 a 
 112 0x70 01110000 p 
-111 0x91 10010001 
  67 0x43 01000011 C 
  15 0x0F 00001111  
  99 0x63 01100011 c 
 111 0x6F 01101111 o 
 109 0x6D 01101101 m 
  46 0x2E 00101110 . 
 100 0x64 01100100 d 
 105 0x69 01101001 i 
 103 0x67 01100111 g 
 117 0x75 01110101 u 
  97 0x61 01100001 a 
 103 0x67 01100111 g 
 101 0x65 01100101 e 
  46 0x2E 00101110 . 
  67 0x43 01000011 C 
  97 0x61 01100001 a 
 114 0x72 01110010 r 
-110 0x92 10010010 
   4 0x04 00000100  
 110 0x6E 01101110 n 
  97 0x61 01100001 a 
 109 0x6D 01101101 m 
 101 0x65 01100101 e 
   3 0x03 00000011  
  97 0x61 01100001 a 
 103 0x67 01100111 g 
 101 0x65 01100101 e 
  96 0x60 01100000 ` 
   7 0x07 00000111  
 100 0x64 01100100 d 
 105 0x69 01101001 i 
 103 0x67 01100111 g 
 117 0x75 01110101 u 
  97 0x61 01100001 a 
 103 0x67 01100111 g 
 101 0x65 01100101 e 
 -65 0xBF 10111111 
  90 0x5A 01011010 Z 
----

é’ˆå¯¹ `TreeMap` çš„å¤„ç†ï¼Œå¤§è‡´ä¹Ÿå¯ä»¥åˆ†ä¸ºä¸‰æ­¥ï¼š

. é¦–å…ˆï¼Œå†™å…¥å‰ç½®ä¿¡æ¯ï¼š
.. å†™å…¥å‰ç½®æ ‡å¿—ä½ `0x4D`ï¼ˆ`M`ï¼‰
.. å†™å…¥ `Map` çš„ç±»å‹ï¼ˆå­—ç¬¦ä¸²å½¢å¼ï¼‰
. å…¶æ¬¡ï¼Œéå† `Map.Entry`ï¼Œå¹¶å°†å…¶åºåˆ—åŒ–
.. Key
.. Value
. æœ€åï¼Œå†™å…¥ç»“æŸæ ‡å¿—ä½ `0x5A`ï¼ˆ`Z`ï¼‰ã€‚

ä¸ `HashMap` ä¸åŒä¹‹å¤„æ—¶ï¼Œè¿™é‡Œå†™å…¥äº† `Map` çš„ç±»å‹ä¿¡æ¯ã€‚æ‰€ä»¥ï¼Œ**ç›¸æ¯”æ¥è¯´ `HashMap` æ›´åŠ è½»é‡çº§ã€‚åœ¨åšå¾®æœåŠ¡æ¥å£çš„å‚æ•°å’Œè¿”å›ç»“æœæ—¶ï¼Œå¯ä»¥ä¼˜å…ˆè€ƒè™‘ `HashMap`ã€‚**

[#object]
== å†è°ˆå®ä¾‹å¯¹è±¡

ä¸ºäº†æ–¹ä¾¿å™è¿°ï¼Œåœ¨ https://www.diguage.com/post/hessian-protocol-interpretation-and-practice-4/#object-1[Hessian åè®®è§£é‡Šä¸å®æˆ˜ï¼ˆå››ï¼‰ï¼šæ•°ç»„ä¸é›†åˆï¼šé¦–è°ˆå®ä¾‹å¯¹è±¡^] ä¸­ï¼Œå¯¹å¯¹è±¡çš„å¤„ç†åšäº†ç®€è¦çš„æ¦‚è¿°ã€‚åˆ°è¿™é‡Œï¼Œè®©æˆ‘ä»¬å†æ¥è®¤è¯†ä¸€ä¸‹å®ä¾‹å¯¹è±¡ã€‚

åœ¨ https://www.diguage.com/post/hessian-source-analysis-for-java/#hessian-serializer[Hessian æºç åˆ†æï¼ˆJavaï¼‰ï¼š `Serializer`^] ä¸­æåˆ°ï¼š

____
å¤„ç†å®ä¾‹å¯¹è±¡çš„åºåˆ—åŒ–ä¸»è¦æœ‰ `JavaSerializer` å’Œ `BeanSerializer`ã€‚è¿™ä¸¤è€…çš„åŒºåˆ«å¦‚ä¸‹ï¼š

* `JavaSerializer` æ˜¯é€šè¿‡åå°„è·å–å®ä¾‹å¯¹è±¡çš„å±æ€§è¿›è¡Œåºåˆ—åŒ–ã€‚æ’é™¤ `static` å’Œ `transient` å±æ€§ï¼Œå¯¹å…¶ä»–æ‰€æœ‰çš„å±æ€§è¿›è¡Œé€’å½’åºåˆ—åŒ–å¤„ç†ã€‚
* `BeanSerializer` æ˜¯éµå¾ª POJI bean çš„çº¦å®šï¼Œæ‰«æå®ä¾‹çš„æ‰€æœ‰æ–¹æ³•ï¼Œå‘ç°åŒæ—¶å­˜åœ¨ Getter å’Œ Setter æ–¹æ³•çš„å±æ€§æ‰è¿›è¡Œåºåˆ—åŒ–ï¼Œå®ƒå¹¶ä¸ç›´æ¥ç›´æ¥æ“ä½œæ‰€æœ‰çš„å±æ€§ã€‚æ³¨æ„ï¼š [.red]#`BeanSerializer` å°†ä¼šæ— æ³•å¤„ç† Getter æ–¹æ³•æ˜¯ä»¥ `is` å¼€å¤´çš„ `boolean` å±æ€§ï¼Œå› ä¸º `BeanSerializer` åªè®¤ä»¥ `get` å¼€å¤´çš„æ–¹æ³•ã€‚#
____

åœ¨ Java 8 ä¸­ï¼Œå…¶å®é»˜è®¤ä½¿ç”¨çš„å¹¶ä¸æ˜¯è¿™ä¸¤ä¸ªï¼Œè€Œæ˜¯ `UnsafeSerializer`ã€‚å®ƒä¸ `JavaSerializer` ç›¸ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡åå°„è·å–ç±»çš„å±æ€§åˆ—è¡¨ï¼›ä½†æ˜¯ä¸ `JavaSerializer` ä¸åŒä¹‹å¤„æ—¶ï¼Œ `JavaSerializer` é€šè¿‡ `Field` ä½¿ç”¨åå°„è·å–å®ä¾‹å¯¹è±¡å±æ€§å¯¹åº”çš„å€¼ï¼›è€Œ `UnsafeSerializer` æ˜¯ä½¿ç”¨ `sun.misc.Unsafe` æ¥è·å–å­—æ®µçš„â€œæŒ‡é’ˆâ€ï¼ˆ`offset`ï¼‰ï¼Œå†é€šè¿‡â€œæŒ‡é’ˆâ€è·å–å®ä¾‹å¯¹è±¡å±æ€§å¯¹åº”çš„å€¼ã€‚

å¦å¤–ï¼Œå¯ç”¨ `UnsafeSerializer` çš„å…ˆå†³æ¡ä»¶æ˜¯èƒ½å¦è·å¾— `sun.misc.Unsafe` å®ä¾‹ã€‚å¦‚æœå¯ä»¥è·å¾— `sun.misc.Unsafe` å®ä¾‹ï¼Œåˆ™å°±ä¼šå¯ç”¨ `UnsafeSerializer`ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é…ç½® `com.caucho.hessian.unsafe` å˜é‡ä¸º `false` æ¥ç¦ç”¨ `UnsafeSerializer`ã€‚è¿™é‡Œï¼Œè¿˜æœ‰ä¸€ä¸ªä¾‹å¤–ï¼šå¦‚æœå¾…åºåˆ—åŒ–çš„ç±»åŒ…å«äº† `writeReplace()` æ–¹æ³•ï¼Œåˆ™å°±ä¼šå¯ç”¨ `JavaSerializer`ã€‚

ä¸‹é¢ä»‹ç»ä¸€ä¸‹ç»§æ‰¿å¯¹è±¡çš„åºåˆ—åŒ–æƒ…å†µï¼š

=== ç»§æ‰¿å¯¹è±¡

.çˆ¶ç±»
[source%nowrap,java,{source_attr}]
----
package com.diguage;

import java.math.BigDecimal;
import java.util.Date;

/**
 * ç”¨æˆ·
 *
 * @author Dç“œå“¥ Â· https://www.diguage.com
 */
public class User {
    private Integer id;
    private String name;
    private Date birthday;
    private BigDecimal money;

    public User() {
    }

    public User(Integer id, String name, Date birthday, BigDecimal money) {
        this.id = id;
        this.name = name;
        this.birthday = birthday;
        this.money = money;
    }

    // å„ç§ Setter å’Œ Getter æ–¹æ³•
}
----

.å­ç±»
[source%nowrap,java,{source_attr}]
----
package com.diguage;

import java.math.BigDecimal;
import java.util.Date;

/**
 * Webç”¨æˆ·
 *
 * @author Dç“œå“¥ Â· https://www.diguage.com
 */
public class WebUser extends User {
    private String site;

    public WebUser() {
    }

    public WebUser(Integer id, String name, Date birthday, BigDecimal money, String site) {
        super(id, name, birthday, money);
        this.site = site;
    }

    // å„ç§ Setter å’Œ Getter æ–¹æ³•
}
----

[source%nowrap,java,{source_attr}]
----
/**
 * æµ‹è¯•çˆ¶å­ç±»çš„åºåˆ—åŒ–
 *
 * @author Dç“œå“¥ Â· https://www.diguage.com
 */
@Test
public void testInheritance() throws Throwable {
    BigDecimal money = new BigDecimal("1234.56789")
            .setScale(2, BigDecimal.ROUND_HALF_UP);
    int id = 4;
    String name = "diguage";
    Date date = new Date();
    String site = "https://www.diguage.com";
    WebUser webUser = new WebUser(id, name, date, money, site);
    objectTo(webUser);
}


// -- è¾“å‡ºç»“æœ ------------------------------------------------
== Object: com.diguage.WebUser  ==
== object: json length=107 ==
{
  "id": 4,
  "name": "diguage",
  "birthday": "2022-08-05 19:37:15",
  "money": 1234.57,
  "site": "https://www.diguage.com"
}
== object: hessian result ==
.... 0 ~ 131 ....
  67 0x43 01000011 C
  19 0x13 00010011 
  99 0x63 01100011 c
 111 0x6F 01101111 o
 109 0x6D 01101101 m
  46 0x2E 00101110 .
 100 0x64 01100100 d
 105 0x69 01101001 i
 103 0x67 01100111 g
 117 0x75 01110101 u
  97 0x61 01100001 a
 103 0x67 01100111 g
 101 0x65 01100101 e
  46 0x2E 00101110 .
  87 0x57 01010111 W
 101 0x65 01100101 e
  98 0x62 01100010 b
  85 0x55 01010101 U
 115 0x73 01110011 s
 101 0x65 01100101 e
 114 0x72 01110010 r
-107 0x95 10010101
   4 0x04 00000100 
 115 0x73 01110011 s
 105 0x69 01101001 i
 116 0x74 01110100 t
 101 0x65 01100101 e
   2 0x02 00000010 
 105 0x69 01101001 i
 100 0x64 01100100 d
   4 0x04 00000100 
 110 0x6E 01101110 n
  97 0x61 01100001 a
 109 0x6D 01101101 m
 101 0x65 01100101 e
   8 0x08 00001000
  98 0x62 01100010 b
 105 0x69 01101001 i
 114 0x72 01110010 r
 116 0x74 01110100 t
 104 0x68 01101000 h
 100 0x64 01100100 d
  97 0x61 01100001 a
 121 0x79 01111001 y
   5 0x05 00000101 
 109 0x6D 01101101 m
 111 0x6F 01101111 o
 110 0x6E 01101110 n
 101 0x65 01100101 e
 121 0x79 01111001 y
  96 0x60 01100000 `
  23 0x17 00010111 
 104 0x68 01101000 h
 116 0x74 01110100 t
 116 0x74 01110100 t
 112 0x70 01110000 p
 115 0x73 01110011 s
  58 0x3A 00111010 :
  47 0x2F 00101111 /
  47 0x2F 00101111 /
 119 0x77 01110111 w
 119 0x77 01110111 w
 119 0x77 01110111 w
  46 0x2E 00101110 .
 100 0x64 01100100 d
 105 0x69 01101001 i
 103 0x67 01100111 g
 117 0x75 01110101 u
  97 0x61 01100001 a
 103 0x67 01100111 g
 101 0x65 01100101 e
  46 0x2E 00101110 .
  99 0x63 01100011 c
 111 0x6F 01101111 o
 109 0x6D 01101101 m
-108 0x94 10010100
   7 0x07 00000111 
 100 0x64 01100100 d
 105 0x69 01101001 i
 103 0x67 01100111 g
 117 0x75 01110101 u
  97 0x61 01100001 a
 103 0x67 01100111 g
 101 0x65 01100101 e
  74 0x4A 01001010 J
   0 0x00 00000000  
   0 0x00 00000000  
   1 0x01 00000001 
-126 0x82 10000010
 109 0x6D 01101101 m
 -53 0xCB 11001011
-105 0x97 10010111
  -9 0xF7 11110111
  67 0x43 01000011 C
  20 0x14 00010100 
 106 0x6A 01101010 j
  97 0x61 01100001 a
 118 0x76 01110110 v
  97 0x61 01100001 a
  46 0x2E 00101110 .
 109 0x6D 01101101 m
  97 0x61 01100001 a
 116 0x74 01110100 t
 104 0x68 01101000 h
  46 0x2E 00101110 .
  66 0x42 01000010 B
 105 0x69 01101001 i
 103 0x67 01100111 g
  68 0x44 01000100 D
 101 0x65 01100101 e
  99 0x63 01100011 c
 105 0x69 01101001 i
 109 0x6D 01101101 m
  97 0x61 01100001 a
 108 0x6C 01101100 l
-111 0x91 10010001
   5 0x05 00000101 
 118 0x76 01110110 v
  97 0x61 01100001 a
 108 0x6C 01101100 l
 117 0x75 01110101 u
 101 0x65 01100101 e
  97 0x61 01100001 a
   7 0x07 00000111 
  49 0x31 00110001 1
  50 0x32 00110010 2
  51 0x33 00110011 3
  52 0x34 00110100 4
  46 0x2E 00101110 .
  53 0x35 00110101 5
  55 0x37 00110111 7
----

ä»åºåˆ—åŒ–ç»“æœä¸Šæ¥çœ‹ï¼Œåºåˆ—åŒ–æœ‰ç»§æ‰¿å…³ç³»çš„å®ä¾‹å¯¹è±¡æ—¶ï¼Œä¼šæŠŠå¯¹è±¡æŒ‰ç…§å­ç±»ä¸€ä¸ªç±»å¤„ç†ï¼›ä½†æ˜¯ï¼Œå’Œæ²¡æœ‰ç»§æ‰¿å…³ç³»åˆç•¥æœ‰ä¸åŒï¼š**æœ‰çˆ¶å­å…³ç³»çš„å®ä¾‹å¯¹è±¡ä¼šå…ˆå¤„ç†å­ç±»çš„å±æ€§ï¼Œç„¶åå†å¤„ç†çˆ¶ç±»çš„å±æ€§ã€‚**

=== é‡å¤å­—ç¬¦ä¸²çš„å¤„ç†

åœ¨ https://www.diguage.com/post/hessian-protocol-interpretation-and-practice-4/#object[Hessian åè®®è§£é‡Šä¸å®æˆ˜ï¼ˆå››ï¼‰ï¼šæ•°ç»„ä¸é›†åˆï¼šé¦–è°ˆå®ä¾‹å¯¹è±¡^] ä¸­æåˆ° â€œé‡å¤å¯¹è±¡ä¼šä½¿ç”¨å‰ç½®æ ‡å¿—ä½ `0x51`ï¼ˆ`Q`ï¼‰+ ç¼–å·æ¥å¤„ç†â€ã€‚å¯¹äºå­—ç¬¦ä¸²ä¼šæ€ä¹ˆå¤„ç†å‘¢ï¼Ÿä¸‹é¢åšæµ‹è¯•æ¥éªŒè¯ä¸€ä¸‹ï¼š

[source%nowrap,java,{source_attr}]
----
/**
 * æµ‹è¯•é‡å¤å­—ç¬¦ä¸²çš„åºåˆ—åŒ–
 *
 * @author Dç“œå“¥ Â· https://www.diguage.com
 */
@Test
public void testDuplicateString() throws Throwable {
    String string = "I'm Dç“œå“¥ï¼ŒğŸ˜";
    List<String> strings = Arrays.asList(string, string);
    List<String> stringList = new ArrayList<>(strings);
    objectTo(stringList);
}


// -- è¾“å‡ºç»“æœ ------------------------------------------------
== Object: java.util.ArrayList  ==
== Generic: java.lang.String  ==
== object: json length=27 ==
["I'm Dç“œå“¥ï¼ŒğŸ˜","I'm Dç“œå“¥ï¼ŒğŸ˜"]
== object: hessian result ==
.... 0 ~ 43 ....
 122 0x7A 01111010 z
  10 0x0A 00001010

  73 0x49 01001001 I
  39 0x27 00100111 '
 109 0x6D 01101101 m
  32 0x20 00100000
  68 0x44 01000100 D
 -25 0xE7 11100111
-109 0x93 10010011
-100 0x9C 10011100
 -27 0xE5 11100101
-109 0x93 10010011
 -91 0xA5 10100101
 -17 0xEF 11101111
 -68 0xBC 10111100
-116 0x8C 10001100
 -19 0xED 11101101
 -96 0xA0 10100000
 -67 0xBD 10111101
 -19 0xED 11101101
 -72 0xB8 10111000
-127 0x81 10000001
  10 0x0A 00001010

  73 0x49 01001001 I
  39 0x27 00100111 '
 109 0x6D 01101101 m
  32 0x20 00100000
  68 0x44 01000100 D
 -25 0xE7 11100111
-109 0x93 10010011
-100 0x9C 10011100
 -27 0xE5 11100101
-109 0x93 10010011
 -91 0xA5 10100101
 -17 0xEF 11101111
 -68 0xBC 10111100
-116 0x8C 10001100
 -19 0xED 11101101
 -96 0xA0 10100000
 -67 0xBD 10111101
 -19 0xED 11101101
 -72 0xB8 10111000
-127 0x81 10000001
----

ä»å®éªŒç»“æœä¸Šæ¥çœ‹ï¼Œ**å¯¹äºå­—ç¬¦ä¸²æ¥è¯´ï¼Œ Hessian å¹¶æ²¡æœ‰åšç‰¹æ®Šå¤„ç†ï¼Œé‡åˆ°ç›¸åŒçš„å­—ç¬¦ä¸²è¿˜æ˜¯ä¼šåå¤åºåˆ—åŒ–ã€‚**


=== â€œæ··åˆâ€é›†åˆçš„åºåˆ—åŒ–

æœ‰å°ä¼™ä¼´æäº†ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœé›†åˆç±»æ˜¯æœ‰å„ç§å„æ ·å¯¹è±¡çš„â€œæ··åˆâ€é›†åˆï¼Œ Hessian å¯ä»¥å¦‚ä½•åºåˆ—åŒ–çš„ï¼Ÿä¸‹é¢åšå®éªŒéªŒè¯ä¸€ä¸‹ï¼š

[source%nowrap,java,{source_attr}]
----
/**
 * æµ‹è¯•â€œæ··åˆâ€é›†åˆçš„åºåˆ—åŒ–
 *
 * @author Dç“œå“¥ Â· https://www.diguage.com
 */
@Test
public void testHybridList() throws Throwable {
    BigDecimal money = new BigDecimal("1234.56789")
            .setScale(2, BigDecimal.ROUND_HALF_UP);
    int id = 4;
    String name = "diguage";
    Date date = new Date();
    String site = "https://www.diguage.com";
    User user = new User(id, name, date, money);
    WebUser webUser = new WebUser(id, name, date, money, site);
    Car car = new Car(name, id);
    List<Object> hybridList = new ArrayList<>();
    // åœ¨é›†åˆä¸­ï¼Œæ”¾äº† WebUserã€ User å’Œ Car ä¸‰ä¸ªç±»å‹çš„å®ä¾‹å¯¹è±¡
    hybridList.add(webUser);
    hybridList.add(user);
    hybridList.add(car);
    objectTo(hybridList);
}


// -- è¾“å‡ºç»“æœ ------------------------------------------------
== Object: java.util.ArrayList  ==
== Generic: com.diguage.WebUser  ==
== object: json length=211ï¼ˆä¸‹é¢æ˜¯æ ¼å¼åŒ–ä»£ç ï¼‰ ==
[
  {
    "id": 4,
    "name": "diguage",
    "birthday": "2022-08-05 19:57:18",
    "money": 1234.57,
    "site": "https://www.diguage.com"
  },
  {
    "id": 4,
    "name": "diguage",
    "birthday": "2022-08-05 19:57:18",
    "money": 1234.57
  },
  {
    "name": "diguage",
    "age": 4
  }
]
== object: hessian result ==
.... 0 ~ 232 ....
 123 0x7B 01111011 {
  67 0x43 01000011 C
  19 0x13 00010011 
  99 0x63 01100011 c
 111 0x6F 01101111 o
 109 0x6D 01101101 m
  46 0x2E 00101110 .
 100 0x64 01100100 d
 105 0x69 01101001 i
 103 0x67 01100111 g
 117 0x75 01110101 u
  97 0x61 01100001 a
 103 0x67 01100111 g
 101 0x65 01100101 e
  46 0x2E 00101110 .
  87 0x57 01010111 W
 101 0x65 01100101 e
  98 0x62 01100010 b
  85 0x55 01010101 U
 115 0x73 01110011 s
 101 0x65 01100101 e
 114 0x72 01110010 r
-107 0x95 10010101
   4 0x04 00000100 
 115 0x73 01110011 s
 105 0x69 01101001 i
 116 0x74 01110100 t
 101 0x65 01100101 e
   2 0x02 00000010 
 105 0x69 01101001 i
 100 0x64 01100100 d
   4 0x04 00000100 
 110 0x6E 01101110 n
  97 0x61 01100001 a
 109 0x6D 01101101 m
 101 0x65 01100101 e
   8 0x08 00001000
  98 0x62 01100010 b
 105 0x69 01101001 i
 114 0x72 01110010 r
 116 0x74 01110100 t
 104 0x68 01101000 h
 100 0x64 01100100 d
  97 0x61 01100001 a
 121 0x79 01111001 y
   5 0x05 00000101 
 109 0x6D 01101101 m
 111 0x6F 01101111 o
 110 0x6E 01101110 n
 101 0x65 01100101 e
 121 0x79 01111001 y
  96 0x60 01100000 `
  23 0x17 00010111 
 104 0x68 01101000 h
 116 0x74 01110100 t
 116 0x74 01110100 t
 112 0x70 01110000 p
 115 0x73 01110011 s
  58 0x3A 00111010 :
  47 0x2F 00101111 /
  47 0x2F 00101111 /
 119 0x77 01110111 w
 119 0x77 01110111 w
 119 0x77 01110111 w
  46 0x2E 00101110 .
 100 0x64 01100100 d
 105 0x69 01101001 i
 103 0x67 01100111 g
 117 0x75 01110101 u
  97 0x61 01100001 a
 103 0x67 01100111 g
 101 0x65 01100101 e
  46 0x2E 00101110 .
  99 0x63 01100011 c
 111 0x6F 01101111 o
 109 0x6D 01101101 m
-108 0x94 10010100
   7 0x07 00000111 
 100 0x64 01100100 d
 105 0x69 01101001 i
 103 0x67 01100111 g
 117 0x75 01110101 u
  97 0x61 01100001 a
 103 0x67 01100111 g
 101 0x65 01100101 e
  74 0x4A 01001010 J
   0 0x00 00000000  
   0 0x00 00000000  
   1 0x01 00000001 
-126 0x82 10000010
 109 0x6D 01101101 m
 -35 0xDD 11011101
 -14 0xF2 11110010
  21 0x15 00010101 
  67 0x43 01000011 C
  20 0x14 00010100 
 106 0x6A 01101010 j
  97 0x61 01100001 a
 118 0x76 01110110 v
  97 0x61 01100001 a
  46 0x2E 00101110 .
 109 0x6D 01101101 m
  97 0x61 01100001 a
 116 0x74 01110100 t
 104 0x68 01101000 h
  46 0x2E 00101110 .
  66 0x42 01000010 B
 105 0x69 01101001 i
 103 0x67 01100111 g
  68 0x44 01000100 D
 101 0x65 01100101 e
  99 0x63 01100011 c
 105 0x69 01101001 i
 109 0x6D 01101101 m
  97 0x61 01100001 a
 108 0x6C 01101100 l
-111 0x91 10010001
   5 0x05 00000101 
 118 0x76 01110110 v
  97 0x61 01100001 a
 108 0x6C 01101100 l
 117 0x75 01110101 u
 101 0x65 01100101 e
  97 0x61 01100001 a
   7 0x07 00000111 
  49 0x31 00110001 1
  50 0x32 00110010 2
  51 0x33 00110011 3
  52 0x34 00110100 4
  46 0x2E 00101110 .
  53 0x35 00110101 5
  55 0x37 00110111 7
  67 0x43 01000011 C
  16 0x10 00010000 
  99 0x63 01100011 c
 111 0x6F 01101111 o
 109 0x6D 01101101 m
  46 0x2E 00101110 .
 100 0x64 01100100 d
 105 0x69 01101001 i
 103 0x67 01100111 g
 117 0x75 01110101 u
  97 0x61 01100001 a
 103 0x67 01100111 g
 101 0x65 01100101 e
  46 0x2E 00101110 .
  85 0x55 01010101 U
 115 0x73 01110011 s
 101 0x65 01100101 e
 114 0x72 01110010 r
-108 0x94 10010100
   2 0x02 00000010 
 105 0x69 01101001 i
 100 0x64 01100100 d
   4 0x04 00000100 
 110 0x6E 01101110 n
  97 0x61 01100001 a
 109 0x6D 01101101 m
 101 0x65 01100101 e
   8 0x08 00001000
  98 0x62 01100010 b
 105 0x69 01101001 i
 114 0x72 01110010 r
 116 0x74 01110100 t
 104 0x68 01101000 h
 100 0x64 01100100 d
  97 0x61 01100001 a
 121 0x79 01111001 y
   5 0x05 00000101 
 109 0x6D 01101101 m
 111 0x6F 01101111 o
 110 0x6E 01101110 n
 101 0x65 01100101 e
 121 0x79 01111001 y
  98 0x62 01100010 b
-108 0x94 10010100
   7 0x07 00000111 
 100 0x64 01100100 d
 105 0x69 01101001 i
 103 0x67 01100111 g
 117 0x75 01110101 u
  97 0x61 01100001 a
 103 0x67 01100111 g
 101 0x65 01100101 e
  74 0x4A 01001010 J
   0 0x00 00000000  
   0 0x00 00000000  
   1 0x01 00000001 
-126 0x82 10000010
 109 0x6D 01101101 m
 -35 0xDD 11011101
 -14 0xF2 11110010
  21 0x15 00010101 
  81 0x51 01010001 Q
-110 0x92 10010010
  67 0x43 01000011 C
  15 0x0F 00001111 
  99 0x63 01100011 c
 111 0x6F 01101111 o
 109 0x6D 01101101 m
  46 0x2E 00101110 .
 100 0x64 01100100 d
 105 0x69 01101001 i
 103 0x67 01100111 g
 117 0x75 01110101 u
  97 0x61 01100001 a
 103 0x67 01100111 g
 101 0x65 01100101 e
  46 0x2E 00101110 .
  67 0x43 01000011 C
  97 0x61 01100001 a
 114 0x72 01110010 r
-110 0x92 10010010
   4 0x04 00000100 
 110 0x6E 01101110 n
  97 0x61 01100001 a
 109 0x6D 01101101 m
 101 0x65 01100101 e
   3 0x03 00000011 
  97 0x61 01100001 a
 103 0x67 01100111 g
 101 0x65 01100101 e
  99 0x63 01100011 c
   7 0x07 00000111 
 100 0x64 01100100 d
 105 0x69 01101001 i
 103 0x67 01100111 g
 117 0x75 01110101 u
  97 0x61 01100001 a
 103 0x67 01100111 g
 101 0x65 01100101 e
-108 0x94 10010100
----

ä»åºåˆ—åŒ–ç»“æœä¸Šæ¥çœ‹ï¼Œå’Œ https://www.diguage.com/post/hessian-protocol-interpretation-and-practice-4/#object[Hessian åè®®è§£é‡Šä¸å®æˆ˜ï¼ˆå››ï¼‰ï¼šæ•°ç»„ä¸é›†åˆï¼šé¦–è°ˆå®ä¾‹å¯¹è±¡^] ä»‹ç»çš„åºåˆ—åŒ–æ–¹æ³•æ˜¯ä¸€è‡´çš„ã€‚ä½†æ˜¯ï¼Œ**è¿™ç§åœ¨é›†åˆä¸­æ··åˆå„ç§å„æ ·å¯¹è±¡çš„ç”¨æ³•éå¸¸å®¹æ˜“å‡ºé—®é¢˜ï¼Œå»ºè®®ç¦æ­¢è¿™æ ·ç¼–ç ï¼**


[#summary]
== æ€»ç»“

å‰é¢å‡ ç¯‡æ–‡ç« ä»‹ç»äº†å„ä¸ªå‰ç½®æ ‡å¿—ä½ï¼Œè¿™é‡Œåšä¸€ä¸ªæ€»ç»“ï¼š

[#hessian-bytecode]
image::/images/marshal/hessian-bytecode.svg[{image_attr}]
