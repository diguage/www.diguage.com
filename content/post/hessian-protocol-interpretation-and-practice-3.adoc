---
title: "Hessian åè®®è§£é‡Šä¸å®æˆ˜ï¼ˆä¸‰ï¼‰ï¼šå­—ç¬¦ä¸²"
date: 2022-05-04T16:09:05+00:00
draft: false
keywords: ["Hessian","åºåˆ—åŒ–","åè®®","Java","å¾®æœåŠ¡","æ¶æ„","ç¨‹åºè®¾è®¡","ç¼–ç ","å­—ç¬¦é›†","UTF-8","UTF-16","Unicode"]
tags: ["Java","å¾®æœåŠ¡","æ¶æ„","è®¾è®¡","åºåˆ—åŒ–","ç¼–ç "]
categories: ["ç³»ç»Ÿæ¶æ„","ç¨‹åºè®¾è®¡"]
thumbnail: "images/common/confused-target-vector.jpg"

weight: 1
---

:icons: font
:source-highlighter: rouge
:rouge-style: monokai
:source_attr: indent=0
:image_attr: align=center,width=100%

å‰æ®µæ—¶é—´ï¼Œç¿»è¯‘äº† Hessian 2.0 çš„åºåˆ—åŒ–åè®®ï¼Œå‘å¸ƒåœ¨äº† https://www.diguage.com/post/hessian-serialization-protocol/[Hessian 2.0 åºåˆ—åŒ–åè®®ï¼ˆä¸­æ–‡ç‰ˆï¼‰^]ã€‚ä½†æ˜¯ï¼Œå…¶ä¸­æœ‰å¾ˆå¤šè¨€è¯­ä¸è¯¦ä¹‹å¤„ã€‚æ‰€ä»¥ï¼Œæ¥ä¸‹æ¥ä¼šç”¨å‡ ç¯‡æ–‡ç« æ¥è¯¦ç»†è§£é‡Šå¹¶å®è·µä¸€ä¸‹ Hessian åºåˆ—åŒ–åè®®ï¼Œä»¥æ±‚åšåˆ°çŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶ã€‚ç›®å½•å¦‚ä¸‹ï¼š

. https://www.diguage.com/post/hessian-protocol-interpretation-and-practice-1/[Hessian åè®®è§£é‡Šä¸å®æˆ˜ï¼ˆä¸€ï¼‰ï¼šå¸ƒå°”ã€æ—¥æœŸã€æµ®ç‚¹æ•°ä¸æ•´æ•°^] -- ä»‹ç»å¸ƒå°”å‹æ•°æ®ã€æ—¥æœŸç±»å‹ã€æµ®ç‚¹ç±»å‹æ•°æ®å’Œæ•´æ•°ç±»å‹æ•°æ®ç­‰å››ç§ç±»å‹çš„æ•°æ®çš„å¤„ç†ã€‚
. https://www.diguage.com/post/hessian-protocol-interpretation-and-practice-2/[Hessian åè®®è§£é‡Šä¸å®æˆ˜ï¼ˆäºŒï¼‰ï¼šé•¿æ•´å‹ã€äºŒè¿›åˆ¶æ•°æ®ä¸ Null^] -- ä»‹ç»é•¿æ•´æ•°ç±»å‹æ•°æ®ã€äºŒè¿›åˆ¶æ•°æ®å’Œ `null` ç­‰ä¸‰ç§ç±»å‹çš„æ•°æ®çš„å¤„ç†ã€‚
. https://www.diguage.com/post/hessian-protocol-interpretation-and-practice-3/[Hessian åè®®è§£é‡Šä¸å®æˆ˜ï¼ˆä¸‰ï¼‰ï¼šå­—ç¬¦ä¸²^] -- ä¸“é—¨ä»‹ç»äº†å…³äºå­—ç¬¦ä¸²çš„å¤„ç†ã€‚ç”±äºå­—ç¬¦ä¸²éœ€è¦é“ºå«çš„åŸºç¡€çŸ¥è¯†æ¯”è¾ƒå¤šï¼Œå¤„ç†ç»†èŠ‚ä¹Ÿæœ‰ç¹çï¼Œæ‰€ä»¥å•ç‹¬æˆç¯‡æ¥ä»‹ç»ã€‚
. https://www.diguage.com/post/hessian-source-analysis-for-java/[Hessian æºç åˆ†æï¼ˆJavaï¼‰^] -- å¼€å§‹ç¬¬å››ç¯‡åˆ†æä¹‹å‰ï¼Œå…ˆæ¥ä»‹ç»ä¸€ä¸‹ Hessian çš„æºç å®ç°ã€‚æ–¹ä¾¿åç»­å±•å¼€è¯´æ˜ã€‚
. https://www.diguage.com/post/hessian-protocol-interpretation-and-practice-4/[Hessian åè®®è§£é‡Šä¸å®æˆ˜ï¼ˆå››ï¼‰ï¼šæ•°ç»„ä¸é›†åˆ^] -- é“ºå«äº†ä¸€äº›å…³äºå®ä¾‹å¯¹è±¡çš„å¤„ç†ï¼Œé‡ç‚¹ä»‹ç»å…³äºæ•°ç»„å’Œé›†åˆçš„ç›¸å…³å¤„ç†ã€‚
. https://www.diguage.com/post/hessian-protocol-interpretation-and-practice-5/[Hessian åè®®è§£é‡Šä¸å®æˆ˜ï¼ˆäº”ï¼‰ï¼šå¯¹è±¡ä¸æ˜ å°„^] -- é‡ç‚¹ä»‹ç»å…³äºå¯¹è±¡ä¸æ˜ å°„çš„ç›¸å…³å¤„ç†ã€‚
. æœªå®Œå¾…ç»­ï¼Œæ•¬è¯·ç»§ç»­å…³æ³¨ https://www.diguage.com/["åœ°ç“œå“¥"åšå®¢ç½‘^]ã€‚

åœ¨ä¸Šä¸€ç¯‡æ–‡ç«  https://www.diguage.com/post/hessian-protocol-interpretation-and-practice-2/[Hessian åè®®è§£é‡Šä¸å®æˆ˜ï¼ˆäºŒï¼‰ï¼šé•¿æ•´å‹ã€äºŒè¿›åˆ¶æ•°æ®ä¸ Null^] ä¸­ç ”ç©¶äº†é•¿æ•´å‹ã€äºŒè¿›åˆ¶æ•°æ®ä¸ `null` ç­‰ä¸‰ç§æ•°æ®ç±»å‹çš„å¤„ç†æ–¹å¼ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥ä»‹ç»å­—ç¬¦ä¸²çš„å¤„ç†æƒ…å†µã€‚

== åŸºç¡€å·¥å…·æ–¹æ³•

åŸºç¡€å·¥å…·æ–¹æ³•å°±ä¸å†èµ˜è¿°ï¼Œè¯·ç›´æ¥å‚è€ƒ https://www.diguage.com/post/hessian-protocol-interpretation-and-practice-1/#helper-methods[Hessian åè®®è§£é‡Šä¸å®æˆ˜ï¼ˆä¸€ï¼‰ï¼šå¸ƒå°”ã€æ—¥æœŸã€æµ®ç‚¹æ•°ä¸æ•´æ•°ï¼šåŸºç¡€å·¥å…·æ–¹æ³•^] ä¸­æåˆ°çš„å‡ ä¸ªæ–¹æ³•ã€‚

[#string]
== å­—ç¬¦ä¸²

åœ¨ https://www.diguage.com/post/hessian-serialization-protocol/#string[Hessian 2.0 åºåˆ—åŒ–åè®®ï¼ˆä¸­æ–‡ç‰ˆï¼‰ï¼šå­—ç¬¦ä¸²ç±»å‹æ•°æ®^] ä¸­å¯¹å­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®åšäº†æè¿°ã€‚æ€»å¾—æ¥è¯´ï¼Œè¿˜ç®—æ¯”è¾ƒæ¸…æ¥šã€‚ä½†æ˜¯ä¸€äº›ç»†èŠ‚ä¸æ˜¯ç‰¹åˆ«æ¸…æ¥šï¼Œæ¯”å¦‚â€œä»¥ UTF-8 ç¼–ç çš„ 16 ä½ Unicode å­—ç¬¦ä¸²â€ï¼Œå†æ¯”å¦‚ï¼Œå››ä¸ªå­—èŠ‚çš„ UTF-8 æ€ä¹ˆè¢« 16 ä½ Unicode å­—ç¬¦ä¸²è¡¨ç¤ºç­‰ã€‚è¿™é‡Œæ·±ç©¶ä¸€ä¸‹ã€‚

åœ¨è®²è¿° Hessian å¦‚æœå¤„ç†å­—ç¬¦ä¸²ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç®€è¦ä»‹ç»ä¸€äº›ç¼–ç ä¸å­—ç¬¦ä¸²çš„åŸºç¡€çŸ¥è¯†ï¼Œæ–¹ä¾¿åç»­å†…å®¹å±•å¼€ã€‚

=== ç¼–ç ä¸å­—ç¬¦é›†æ¦‚è¿°

å…³äºå­—ç¬¦ä¸²ç¼–ç æœ‰éå¸¸éå¸¸å¤šçš„è®¡ç®—æœºåº•å±‚çŸ¥è¯†ã€‚åœ¨æ¢ç©¶çš„è¿‡ç¨‹ä¸­ï¼Œè¿˜æ˜¯è´¹äº†ä¸å°‘åŠ›æ°”ã€‚å…³äº Unicodeã€UTF-8ã€UTF-16ï¼ˆä»¥åŠç›¸å…³å˜ç§ UTF-16BE å’Œ UTF-166LEï¼‰ç­‰ç›¸å…³çŸ¥è¯†æœ‰éå¸¸éå¸¸å¤šï¼Œè¿™é‡Œä¸å±•å¼€è®²è§£ã€‚é‚£é‡Œæåˆ°äº†ç›¸å…³çŸ¥è¯†ï¼Œä¼šç®€å•è¯‰è¯´ä¸€ä¸‹ï¼Œåªæ˜¯åšäº›é“ºå«å·¥ä½œã€‚åç»­æœ‰æœºä¼šï¼Œå†å‘æ–‡ç»†è®²ã€‚

****
å…³äºç¼–ç ä¸å­—ç¬¦é›†çš„é—®é¢˜ï¼Œä¸“é—¨å»æŸ¥äº†ä¸€äº›èµ„æ–™ï¼Œè¶Šäº†è§£è¶Šå¿ƒæƒŠï¼Œæ²¡æƒ³åˆ°è¿™é‡Œé¢çš„æ°´æ˜¯å¦‚æ­¤ä¹‹æ·±ï¼Œä¸æ˜¯ç®€å•å‡ å¥å°±èƒ½è¯´æ˜ç™½äº†ã€‚å¹²è„†ç»™è‡ªå·±æŒ–ä¸ªå‘ï¼Œä¸“é—¨å†™ä¸€ç¯‡æ–‡ç« æ¥è¯¦ç»†è¯´æ˜å§ã€‚å…ˆæŠŠå‘ä½é€‰å¥½ï¼š https://www.diguage.com/post/dive-into-encoding-and-character-set/[ç»†è¯´ç¼–ç ä¸å­—ç¬¦é›†^]ã€‚
****

==== ASCII ç 

ASCII æ˜¯ American Standard Code for Information Interchange çš„ç®€ç§°ï¼Œå®šä¹‰äº†128ä¸ªå­—ç¬¦çš„ç¼–ç è§„åˆ™ï¼Œå…¶å­—ç¬¦é›†åˆå« ASCII å­—ç¬¦é›†ã€‚å®Œæ•´åˆ—è¡¨å¦‚ä¸‹ï¼š

image::/images/encoding/ascii-table.svg[alt="ASCII Table",{image_attr}]

==== Unicode

ASCII ç æ˜¯ç¾å›½åˆ¶å®šå‡ºæ¥é’ˆå¯¹è‹±è¯­çš„ç¼–ç æ ‡å‡†ï¼›åæ¥ï¼Œä¸­å›½å‘å±•å‡ºæ¥è‡ªå·±çš„ GB2312ï¼Œåæ¥ä¸ºäº†å¢åŠ å¯¹ç¹ä½“å­—çš„æ”¯æŒï¼Œåˆæ‰©å±•å‡ºæ¥äº† GB18030ã€‚å…¶ä»–å›½å®¶ä¹Ÿå‘å±•å‡ºæ¥è‡ªå·±çš„ç¼–ç æ ‡å‡†ã€‚ä¸ºäº†è§£å†³ä¸åŒå›½å®¶é—´å´ç»å¸¸å‡ºç°ç¼–ç ä¸ç›¸å®¹çš„æƒ…å†µï¼Œå‘å±•å‡ºäº† Unicode ç¼–ç ã€‚

åœ¨æ–‡å­—å¤„ç†æ–¹é¢ï¼ŒUnicode ä¸ºæ¯ä¸€ä¸ªå­—ç¬¦è€Œéå­—å½¢å®šä¹‰å”¯ä¸€çš„ä»£ç ï¼ˆå³ä¸€ä¸ªæ•´æ•°ï¼‰ã€‚æ¢å¥è¯è¯´ï¼Œç»Ÿä¸€ç ä»¥ä¸€ç§æŠ½è±¡çš„æ–¹å¼ï¼ˆå³æ•°å­—ï¼‰æ¥å¤„ç†å­—ç¬¦ï¼Œå¹¶å°†è§†è§‰ä¸Šçš„æ¼”ç»å·¥ä½œï¼ˆä¾‹å¦‚å­—ä½“å¤§å°ã€å¤–è§‚å½¢çŠ¶ã€å­—ä½“å½¢æ€ã€æ–‡ä½“ç­‰ï¼‰ç•™ç»™å…¶ä»–è½¯ä»¶æ¥å¤„ç†ã€‚Dç“œå“¥çš„ç†è§£å°±æ˜¯ç»™æ¯ä¸ªå­—ç¬¦åˆ†é…äº†ä¸€ä¸ªèº«ä»½è¯å·ã€‚

åœ¨è¡¨ç¤ºä¸€ä¸ª Unicode çš„å­—å…ƒæ—¶ï¼Œé€šå¸¸ä¼šç”¨ â€œU+â€ ç„¶åç´§æ¥ç€ä¸€ç»„åå…­è¿›ä½çš„æ•°å­—æ¥è¡¨ç¤ºè¿™ä¸€ä¸ªå­—å…ƒã€‚

Unicode çš„å®ç°æ–¹å¼ç§°ä¸º Unicodeè½¬æ¢æ ¼å¼ï¼ˆUnicode Transformation Formatï¼Œç®€ç§°ä¸ºUTFï¼‰ã€‚ç›®å‰ï¼Œå¸¸ç”¨çš„ä¸º UTF-8 å’Œ UTF-16ã€‚

==== UTF-8 ç¼–ç 

Unicode å’Œ UTF-8 çš„è½¬æ¢å…³ç³»æ¯”è¾ƒç»Ÿä¸€ã€‚ç”¨è¡¨æ ¼å±•ç¤ºï¼š

image::/images/encoding/utf8-encoding-scheme.svg[alt="Unicode ä¸ UTF-8 çš„è½¬æ¢",{image_attr}]

[#utf-16]
==== UTF-16 ç¼–ç 

UTF-16 ç›®å‰å¯ä»¥åˆ†ä¸ºä¸¤ç§è½¬åŒ–æ ¼å¼ï¼š

. å¦‚ `U âˆˆ [U+0000, U+D7FF]` or `U âˆˆ [U+E000, U+FFFF]`ï¼Œåˆ™ UTF-16 å’Œ Unicode ç›¸åŒ
. å¦‚æœ `U âˆˆ [U+010000, U+10FFFF]`ï¼Œåˆ™è½¬åŒ–å…³ç³»ç•¥å¤æ‚ï¼Œå…·ä½“å¦‚ä¸‹ï¼š
+
--
[source%nowrap,{source_attr}]
----
// Basic Multilingual Plane (BMP)
U  âˆˆ [U+0000, U+D7FF] or U âˆˆ [U+E000, U+FFFF]
U+â’¶â’·â’¸â’¹ â†’ 0xâ’¶â’·â’¸â’¹

// Supplementary Planes
U  âˆˆ [U+010000, U+10FFFF]                // U - 0x10000 ä¹‹åï¼Œåªæœ‰ 20 ä½
U' = â‘²â‘±â‘°â‘¯â‘®â‘­â‘¬â‘«â‘ªâ‘© â‘¨â‘§â‘¦â‘¥â‘¤â‘£â‘¢â‘¡â‘ â“ª  // U - 0x10000
Wâ‚ = 110110â‘²â‘± â‘°â‘¯â‘®â‘­â‘¬â‘«â‘ªâ‘©            // 0xD800 + â‘²â‘±â‘°â‘¯â‘®â‘­â‘¬â‘«â‘ªâ‘©
Wâ‚‚ = 110111â‘¨â‘§ â‘¦â‘¥â‘¤â‘£â‘¢â‘¡â‘ â“ª            // 0xDC00 + â‘¨â‘§â‘¦â‘¥â‘¤â‘£â‘¢â‘¡â‘ â“ª
----

image::/images/encoding/utf16-surrogate-decoder.png[alt="UTF-16 surrogate decoder",{image_attr}]

ç¼–ç ä¹‹åï¼Œæ¯ä¸ªå­—ç¬¦çš„ç¼–ç èŒƒå›´æ˜¯ `W âˆˆ [0xD800, 0xDFFF]`ï¼Œå…¶ä¸­ï¼Œhigh surrogate `Wâ‚ âˆˆ [0xD800, 0xDBFF]`ï¼Œ low surrogate `Wâ‚‚ âˆˆ [0xDC00, 0xDFFF]`ï¼Œæ­£å¥½å¯ä»¥ BMP çš„å­—åŒºåˆ†å¼€ã€‚
--

é“ºå«å·¥ä½œåŸºæœ¬å¤Ÿç”¨äº†ï¼Œä¸‹é¢å¼€å§‹ä»‹ç» Hessian å¯¹å­—ç¬¦ä¸²çš„å¤„ç†ã€‚

=== Hessian å¯¹å­—ç¬¦ä¸²çš„åŸºæœ¬å¤„ç†

å¦ç™½è®²ï¼ŒHessian å¯¹å­—ç¬¦ä¸²å¤„ç†çš„æè¿°ä¸€è„¸æ‡µé€¼ã€‚æ‰€ä»¥ï¼Œè¿˜æ˜¯ç›´æ¥ç»“åˆ Hessian çš„ä»£ç ï¼Œæ¥è¯´æ˜ä¸€ä¸‹ Hessian ä¸­å¯¹å•ä¸ªå­—ç¬¦æ€ä¹ˆå¤„ç†çš„ã€‚ç›´æ¥ä¸Šä»£ç ï¼š

.Hessian ä¸­ Hessian2Output#printString çš„ä»£ç 
[source%nowrap,java,{source_attr}]
----
public void printString(String v, int strOffset, int length)
  throws IOException
{
  int offset = _offset;
  byte []buffer = _buffer;

  for (int i = 0; i < length; i++) {
    if (SIZE <= offset + 16) {
      _offset = offset;
      flushBuffer();
      offset = _offset;
    }

    char ch = v.charAt(i + strOffset);

    if (ch < 0x80)
      buffer[offset++] = (byte) (ch);
    else if (ch < 0x800) {
      buffer[offset++] = (byte) (0xc0 + ((ch >> 6) & 0x1f));
      buffer[offset++] = (byte) (0x80 + (ch & 0x3f));
    }
    else {
      buffer[offset++] = (byte) (0xe0 + ((ch >> 12) & 0xf));
      buffer[offset++] = (byte) (0x80 + ((ch >> 6) & 0x3f));
      buffer[offset++] = (byte) (0x80 + (ch & 0x3f));
    }
  }

  _offset = offset;
}
----

è¿™æ®µä»£ç ä¸­ï¼Œå…³äºå­—ç¬¦ï¼ˆ`char`ï¼‰çš„å¤„ç†æœ‰ä¸‰ä¸ªåˆ†æ”¯ï¼Œåˆ†å¼€æ¥è¯´æ˜ä¸€ä¸‹ï¼š

. ç¬¬ä¸€ä¸ªåˆ†æ”¯æ¡ä»¶ `ch < 0x80`ï¼Œè¿™é‡Œçš„ `0x80` ç­‰ä»·äº `8*16 + 0 = 128`ï¼Œæ­£å¥½æ˜¯ ASCII ç¼–ç èŒƒå›´å†…çš„å­—ç¬¦ã€‚æ‰€ä»¥ï¼Œè¿™ä¸ªåˆ†æ”¯çš„æ„æ€å°±å¾ˆæ˜ç¡®äº†ï¼š ASCII ç¼–ç èŒƒå›´å†…çš„å­—ç¬¦ç›´æ¥ä½¿ç”¨å…¶ç¼–ç æ¥ä½œä¸ºåºåˆ—åŒ–çš„ç»“æœã€‚å¦å¤–ï¼ŒUTF-8 åœ¨ ASCII ç¼–ç èŒƒå›´å†…ï¼Œä¸ä¹‹ç›¸åŒã€‚æ‰€ä»¥ï¼Œè¿™å’Œæ ‡å‡†ä¸­æåˆ°çš„ä½¿ç”¨ UTF-8 ç¼–ç æ˜¯æ²¡æœ‰å†²çªçš„ã€‚
. ç¬¬äºŒä¸ªåˆ†æ”¯ `ch < 0x800`ï¼Œå¦ç™½è®²ï¼Œæœ€åˆçœ‹åˆ°è¿™ä¸ªæ•°å­—æ˜¯æ‡µé€¼çš„ã€‚ä¸çŸ¥é“è¿™ä¸ª `0x800`ã€‚åœ¨æŸ¥ç›¸å…³èµ„æ–™æ—¶ï¼Œçœ‹åˆ°äº† UTF-8 ç¼–ç çš„æ°›å›´åˆ’åˆ†ï¼Œåœ¨ https://en.wikipedia.org/wiki/UTF-8#Encoding[UTF-8 - Wikipedia^] ä¸­çœ‹åˆ°æœ‰ `U+0800`ã€‚åœ¨å…¶ä¸Šçš„ä¸€è¡Œå†…å®¹æ˜¾ç¤ºä¸ºä¸¤ä¸ªå­—èŠ‚çš„ UTF-8 ç¼–ç èŒƒå›´æ˜¯ `U+0080` ~ `U+07FF`	ï¼Œå…¶äºŒè¿›åˆ¶è¡¨ç¤ºæ˜¯ `110xxxxx` + `10xxxxxx`ã€‚è¿™é‡Œçš„ `U+07FF` å’Œ `0x800` æ­£å¥½ç›¸é‚»ï¼Œç»“åˆåºåˆ—åŒ–çš„ç»“æœæ¥çœ‹ï¼Œä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºçš„ UTF-8 çš„å­—ç¬¦ç›´æ¥æ˜¯ä½¿ç”¨ UTF-8 ç¼–ç æ¥ä½œä¸ºå…¶åºåˆ—åŒ–ç»“æœã€‚æ‰€ä»¥ï¼Œä»è¿™ç‚¹å¯ä»¥çœ‹å‡ºï¼Œè¿™é‡Œçš„ `0x800` å°±æ˜¯ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºçš„ UTF-8 çš„å­—ç¬¦çš„ä¸Šé™ã€‚å¦å¤–ï¼Œ UTF-8 ç¼–ç èŒƒå›´çš„ `U+0080` å’Œä¸Šé¢çš„ `0x80` ä¹Ÿæ˜¯ç›¸å»åˆçš„ã€‚
+
--
image::/images/encoding/code-point-utf8-conversion.png[{image_attr}]
--
+ 
. ç¬¬ä¸‰ä¸ªæƒ…å†µå°±æ¯”è¾ƒå¤æ‚äº†ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ https://docs.oracle.com/javase/specs/jls/se17/html/index.html[ã€ŠThe JavaÂ® Language Specificationã€‹^] ä¸­æ€ä¹ˆæ¥å®šä¹‰å­—ç¬¦çš„ã€‚è¿™é‡Œç›´æ¥æ‘˜å½•è§„èŒƒåŸæ–‡ï¼š
+
--
[quote, The JavaÂ® Language Specification,Java SE 17 Edition]
____
The Unicode standard was originally designed as a fixed-width 16-bit character encoding. It has since been changed to allow for characters whose representation requires more than 16 bits. The range of legal code points is now U+0000 to U+10FFFF, using the hexadecimal U+n notation. Characters whose code points are greater than U+FFFF are called supplementary characters. To represent the complete range of characters using only 16-bit units, the Unicode standard defines an encoding called UTF-16. In this encoding, supplementary characters are represented as pairs of 16-bit code units, the first from the high-surrogates range (U+D800 to U+DBFF), and the second from the low-surrogates range (U+DC00 to U+DFFF). 

The Java programming language represents text in sequences of 16-bit code units, using the UTF-16 encoding.
____

ä»è¿™ä¸ªè§„èŒƒä¸­å¯ä»¥çœ‹å‡ºï¼ŒJava ä½¿ç”¨ UTF-16 ç¼–ç æ¥è¡¨ç¤ºæ–‡æœ¬ã€‚

å¦å¤–ï¼Œåœ¨ https://en.wikipedia.org/wiki/UTF-16[UTF-16 - Wikipedia^] ä¸­æœ‰å¦‚ä¸‹æè¿°ï¼š

[quote, UTF-16, Wikipedia]
____
Code points from the other planes (called Supplementary Planes) are encoded as two 16-bit code units called a surrogate pairã€‚

â€¦â€¦

Java originally used UCS-2, and added UTF-16 supplementary character support in J2SE 5.0.
____

ä»è¿™äº›æè¿°ä¸­ï¼Œå¯ä»¥çœ‹å‡ºï¼Œåœ¨ Java ä¸­ï¼Œåœ¨è¡¨ç¤º https://en.wikipedia.org/wiki/Plane_(Unicode)#Basic_Multilingual_Plane[BMP (Basic Multilingual Plane)^] çš„å­—ç¬¦æ—¶ï¼Œä½¿ç”¨ä¸€ä¸ª `char` å­—ç¬¦æ¥è¡¨ç¤ºï¼Œè€Œä¸” `char` å€¼ç­‰äºå­—ç¬¦çš„ UTF-16 ç¼–ç ï¼›åœ¨è¡¨ç¤ºé™¤ BMP ä¹‹å¤–çš„ *supplementary* å­—ç¬¦æ—¶ï¼Œä½¿ç”¨ä¸¤ä¸ª `char` è¡¨ç¤ºï¼Œä¸¤ä¸ª `char` çš„å€¼æ˜¯ UTF-16 ç¼–ç ã€‚

åŸºæœ¬çš„é“ºå«å·¥ä½œå·²ç»å¤Ÿäº†ï¼Œæˆ‘ä»¬æ¥ç»“åˆç¤ºä¾‹çœ‹ä¸€ä¸‹ Hessian å¯¹å­—ç¬¦ä¸²çš„å¤„ç†è¿‡ç¨‹ã€‚
--

[source%nowrap,java,{source_attr}]
----
/**
 * @author Dç“œå“¥ Â· https://www.diguage.com/
 */
@Test
public void testString() throws Throwable {
    // å•å­—èŠ‚å­—ç¬¦ä¸²
    stringTo("D");
    // åŒå­—èŠ‚å­—ç¬¦ä¸²
    stringTo("Ã…");
    // ä¸‰å­—èŠ‚å­—ç¬¦ä¸²
    stringTo("ç“œ");
    // å››å­—èŠ‚å­—ç¬¦ä¸²
    stringTo("ğŸ˜‚");
    // ğŸ˜‚ = U+1f602
    // ç¬¬ä¸€æ­¥ï¼Œå…ˆå°† Unicode è½¬æ¢æˆ UTF-16 ç¼–ç ï¼›
    //      å¯¹äºè¶…è¿‡ BMP çš„å­—ç¬¦ï¼ŒUTF-16 ä¼šå°†å…¶æ‹†
    //      åˆ†æˆä¸¤ä¸ªå­—ç¬¦æ¥å¤„ç†ã€‚ç”±äº Java å†…éƒ¨ï¼Œchar
    //      ç±»å‹çš„æ•°æ®å°±æ˜¯ä½¿ç”¨ UTF-16 ç¼–ç çš„ï¼Œæ‰€ä»¥ï¼Œ
    //      è¿™ä¸€æ­¥å·²ç»æå‰å®Œæˆï¼Œæ— éœ€å†åšå¤„ç†ã€‚
    // (æ‰“å¼€è°ƒè¯•ï¼ŒæŸ¥çœ‹ char çš„å†…å®¹å³å¯ç¡®è®¤)
    // è¿™é‡Œæ¼”ç¤ºä¸€ä¸‹ä» Unicode è½¬ UTF-16 çš„è¿‡ç¨‹ï¼š
    // U+1f602 - 0x10000 = 0x0f602
    // 0x0f602 = 00 0011 1101, 10 0000 0010
    //   00 0011 1101 + 0XD800
    // =         00 0011 1101
    //   + 11011000 0000 0000
    // ----------------------
    // =   11011000 0011 1101
    // = d83d
    //
    //   10 0000 0010 + 0xDC00
    // =         10 0000 0010
    //   + 11011100 0000 0000
    // ----------------------
    // =   11011110 0000 0010
    // = de02
    //
    // ç¬¬äºŒæ­¥ï¼Œ`char` å€¼å¤§äºç­‰äº `0x800` çš„ `char`ï¼Œä¼šå°†å…¶
    //      â€œå€¼â€å½“åš Unicode ç„¶åè½¬æ¢æˆâ€œ3ä¸ªå­—èŠ‚çš„UTF-8â€ã€‚
    //      å¦‚æœæ˜¯éœ€è¦ä¸¤ä¸ª `char` è¡¨ç¤ºçš„å­—ç¬¦ï¼Œåˆ™å½“åšä¸¤ä¸ª â€œUnicode å€¼â€
    //      å¤„ç†ï¼Œåˆ™ ä¼šè½¬æˆä¸¤ä¸ªâ€œ3 ä¸ªå­—èŠ‚çš„ UTF-8â€ï¼Œå°±æ˜¯å…­ä¸ªå­—èŠ‚ã€‚
    // æ³¨ï¼šè¿™é‡Œçš„â€œ3ä¸ªå­—èŠ‚çš„UTF-8â€ï¼Œå¹¶ä¸æ˜¯é€šå¸¸è¯´çš„ UTF-8 ç¼–ç ï¼Œ
    //     åªæ˜¯å€Ÿç”¨äº†â€œ3ä¸ªå­—èŠ‚çš„UTF-8â€çš„ç¼–ç æ ¼å¼ï¼Œå¾’æœ‰å…¶è¡¨è€Œå·²ã€‚
    // 11011000 0011 1101 â†’ 11101101 10100000 10111101
    // 11011110 0000 0010 â†’ 11101101 10111000 10000010
    // è½¬æ¢ç®—æ³•è§ä¸Šé¢çš„â€œUnicode ä¸ UTF-8 çš„è½¬æ¢â€å›¾è¡¨ã€‚

    // å¤§å®¶å¯ä»¥è¯•è¯• ğŸ‘ çš„è½¬æ¢ï¼š ğŸ‘ = U+1F44D
    stringTo("ğŸ‘");

    // æ›´é•¿ä¹…çš„é•¿å­—ç¬¦ä¸²å¤„ç†ç¤ºä¾‹
    ByteArrayOutputStream bos = new ByteArrayOutputStream();
    Hessian2Output out = getHessian2Output(bos);
    out.writeString("Dç“œå“¥");
    out.writeString("https://www.diguage.com");
    out.writeString("ğŸ‘ğŸ‘ğŸ‘ï¼Œè€æå–ç“œï¼Œè‡ªå–è‡ªå¤¸ï¼ŒğŸ˜‚ğŸ˜‚ğŸ˜‚");
    out.close();
    byte[] hessianBytes = bos.toByteArray();
    ByteArrayInputStream bais = new ByteArrayInputStream(hessianBytes);
    Hessian2Input hessian2Input = getHessian2Input(bais);
    String s1 = hessian2Input.readString();
    System.out.println(s1);
    String s2 = hessian2Input.readString();
    System.out.println(s2);
    String s3 = hessian2Input.readString();
    System.out.println(s3);
    hessian2Input.close();
    bais.close();
}

/**
 * @author Dç“œå“¥ Â· https://www.diguage.com/
 */
public void stringTo(String value) throws Throwable {
    ByteArrayOutputStream bos = new ByteArrayOutputStream();
    Hessian2Output out = getHessian2Output(bos);

    out.writeString(value);
    out.close();
    byte[] result = bos.toByteArray();

    System.out.println("\n== string: " + value + " ==");
    byte[] utf8Bytes = value.getBytes(StandardCharsets.UTF_8);
    System.out.println("== string: value UTF-8 bytes ==");
    printBytes(utf8Bytes);

    byte[] utf16Bytes = value.getBytes(StandardCharsets.UTF_16);
    System.out.println("== string: value UTF-16 bytes ==");
    printBytes(utf16Bytes);

    byte[] utf16beBytes = value.getBytes(StandardCharsets.UTF_16BE);
    System.out.println("== string: value UTF-16BE bytes ==");
    printBytes(utf16beBytes);

    byte[] utf16leBytes = value.getBytes(StandardCharsets.UTF_16LE);
    System.out.println("== string: value UTF-16LE bytes ==");
    printBytes(utf16leBytes);

    System.out.println("== string: hessian result ==");
    printBytes(result);
}


// -- è¾“å‡ºç»“æœ ------------------------------------------------
== string: D ==
== string: value UTF-8 bytes ==
  68 0x44 01000100 D 
== string: value UTF-16 bytes ==
  -2 0xFE 11111110 
  -1 0xFF 11111111 
   0 0x00 00000000   
  68 0x44 01000100 D 
== string: value UTF-16BE bytes ==
   0 0x00 00000000   
  68 0x44 01000100 D 
== string: value UTF-16LE bytes ==
  68 0x44 01000100 D 
   0 0x00 00000000   
== string: hessian result ==
   1 0x01 00000001  
  68 0x44 01000100 D 

== string: Ã… ==
== string: value UTF-8 bytes ==
 -61 0xC3 11000011 
-123 0x85 10000101 
== string: value UTF-16 bytes ==
  -2 0xFE 11111110 
  -1 0xFF 11111111 
   0 0x00 00000000   
 -59 0xC5 11000101 
== string: value UTF-16BE bytes ==
   0 0x00 00000000   
 -59 0xC5 11000101 
== string: value UTF-16LE bytes ==
 -59 0xC5 11000101 
   0 0x00 00000000   
== string: hessian result ==
   1 0x01 00000001  
 -61 0xC3 11000011 
-123 0x85 10000101 

== string: ç“œ ==
== string: value UTF-8 bytes ==
 -25 0xE7 11100111 
-109 0x93 10010011 
-100 0x9C 10011100 
== string: value UTF-16 bytes ==
  -2 0xFE 11111110 
  -1 0xFF 11111111 
 116 0x74 01110100 t 
 -36 0xDC 11011100 
== string: value UTF-16BE bytes ==
 116 0x74 01110100 t 
 -36 0xDC 11011100 
== string: value UTF-16LE bytes ==
 -36 0xDC 11011100 
 116 0x74 01110100 t 
== string: hessian result ==
   1 0x01 00000001  
 -25 0xE7 11100111 
-109 0x93 10010011 
-100 0x9C 10011100  

== string: ğŸ˜‚ ==
== string: value UTF-8 bytes ==
 -16 0xF0 11110000 
 -97 0x9F 10011111 
-104 0x98 10011000 
-126 0x82 10000010 
== string: value UTF-16 bytes ==
  -2 0xFE 11111110 
  -1 0xFF 11111111 
 -40 0xD8 11011000 
  61 0x3D 00111101 = 
 -34 0xDE 11011110 
   2 0x02 00000010  
== string: value UTF-16BE bytes ==
 -40 0xD8 11011000 
  61 0x3D 00111101 = 
 -34 0xDE 11011110 
   2 0x02 00000010  
== string: value UTF-16LE bytes ==
  61 0x3D 00111101 = 
 -40 0xD8 11011000 
   2 0x02 00000010  
 -34 0xDE 11011110 
== string: hessian result ==
   2 0x02 00000010  
 -19 0xED 11101101 
 -96 0xA0 10100000 
 -67 0xBD 10111101 
 -19 0xED 11101101 
 -72 0xB8 10111000 
-126 0x82 10000010 

== string: ğŸ‘ ==
== string: value UTF-8 bytes ==
 -16 0xF0 11110000 
 -97 0x9F 10011111 
-111 0x91 10010001 
-115 0x8D 10001101 
== string: value UTF-16 bytes ==
  -2 0xFE 11111110 
  -1 0xFF 11111111 
 -40 0xD8 11011000 
  61 0x3D 00111101 = 
 -36 0xDC 11011100 
  77 0x4D 01001101 M 
== string: value UTF-16BE bytes ==
 -40 0xD8 11011000 
  61 0x3D 00111101 = 
 -36 0xDC 11011100 
  77 0x4D 01001101 M 
== string: value UTF-16LE bytes ==
  61 0x3D 00111101 = 
 -40 0xD8 11011000 
  77 0x4D 01001101 M 
 -36 0xDC 11011100 
== string: hessian result ==
   2 0x02 00000010  
 -19 0xED 11101101 
 -96 0xA0 10100000 
 -67 0xBD 10111101 
 -19 0xED 11101101 
 -79 0xB1 10110001 
-115 0x8D 10001101 
// ä½ ç®—å¯¹äº†å—ï¼Ÿ

Dç“œå“¥
https://www.diguage.com
ğŸ‘ğŸ‘ğŸ‘ï¼Œè€æå–ç“œï¼Œè‡ªå–è‡ªå¤¸ï¼ŒğŸ˜‚ğŸ˜‚ğŸ˜‚
----

è¿™é‡Œå¯¹äº Unicode å€¼å¤§äºç­‰äº `0x800` çš„å­—ç¬¦çš„å¤„ç†è¿‡ç¨‹åšä¸ªæ€»ç»“ï¼š

. ç¬¬ä¸€æ­¥ï¼Œå…ˆå°† Unicode è½¬æ¢æˆ UTF-16 ç¼–ç ï¼›å¯¹äºè¶…è¿‡ BMP çš„å­—ç¬¦ï¼ŒUTF-16 ä¼šå°†å…¶æ‹†åˆ†æˆä¸¤ä¸ªå­—ç¬¦æ¥å¤„ç†ã€‚ç”±äº Java å†…éƒ¨ï¼Œ `char` ç±»å‹çš„æ•°æ®å°±æ˜¯ä½¿ç”¨ UTF-16 ç¼–ç çš„ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸€æ­¥å·²ç»æå‰å®Œæˆï¼Œæ— éœ€å†åšå¤„ç†ã€‚
. ç¬¬äºŒæ­¥ï¼Œ`char` å€¼å¤§äºç­‰äº `0x800` çš„ `char`ï¼Œä¼šå°†å…¶â€œå€¼â€å½“åš Unicode ç„¶åè½¬æ¢æˆâ€œ3ä¸ªå­—èŠ‚çš„UTF-8â€ã€‚å¦‚æœæ˜¯éœ€è¦ä¸¤ä¸ª `char` è¡¨ç¤ºçš„å­—ç¬¦ï¼Œåˆ™å½“åšä¸¤ä¸ªâ€œUnicode å€¼â€å¤„ç†ï¼Œåˆ™ ä¼šè½¬æˆä¸¤ä¸ªâ€œ3ä¸ªå­—èŠ‚çš„UTF-8â€ï¼Œå°±æ˜¯å…­ä¸ªå­—èŠ‚ã€‚

=== Hessian å¯¹å­—ç¬¦ä¸²çš„â€œåˆ‡å‰²â€å¤„ç†

è¦æµ‹è¯• Hessian å¯¹å­—ç¬¦ä¸²çš„åˆ‡å‰²ï¼Œåˆ™ä¼šä½¿ç”¨éå¸¸é•¿çš„å­—ç¬¦ä¸²ï¼Œå°†å…¶ç¼–ç å…¨éƒ¨æ‰“å°å‡ºæ¥æ„ä¹‰ä¸å¤§ã€‚æ‰€ä»¥ï¼Œåœ¨å¼€å§‹è®²è§£ä¹‹å‰ï¼Œå…ˆå¯¹ä¹‹å‰çš„å·¥å…·æ–¹æ³• `printBytes` è¿›è¡Œé€‚å½“çš„æ”¹é€ ã€‚

[source%nowrap,java,{source_attr}]
----
/**
 * æ‰“å°å­—èŠ‚æ•°ç»„
 *
 * @author Dç“œå“¥ Â· https://www.diguage.com/
 */
private void printBytes(byte[] result) {
    int chunk = 0x8000;
    if (0 < result.length && chunk < result.length & result[0] == 'R') {
        for (int i = 0; i < result.length; i += (chunk + 3)) {
            int j = Math.max(i - 1, 0);
            int end = Math.min(i + 4, result.length);
            System.out.println(".... " + j + " ~ " + end + " ....");
            for (; j < end; j++) {
                printByte(result[j]);
            }
        }
        System.out.println("...... " + result.length);
    } else {
        int max = 10;
        for (int i = 0; i < result.length && i < max; i++) {
            printByte(result[i]);
        }
        if (result.length > max) {
            System.out.println("...... " + result.length);
        }
    }
}

/**
 * æ‰“å°å•ä¸ªå­—èŠ‚
 *
 * @author Dç“œå“¥ Â· https://www.diguage.com/
 */
private void printByte(byte b) {
    String bitx = Integer.toBinaryString(Byte.toUnsignedInt(b));
    String zbits = String.format("%8s", bitx).replace(' ', '0');
    if (0 <= b) {
        System.out.printf("%4d 0x%02X %8s %c %n", b, b, zbits, b);
    } else {
        System.out.printf("%4d 0x%02X %8s %n", b, b, zbits);
    }
}
----

Hessian ä¸­å¯¹å­—ç¬¦ä¸²çš„å¤„ç†ï¼Œæ ¹æ®é•¿åº¦å¯åˆ†ä¸åŒçš„å‡ ç§æƒ…å†µï¼š

* é•¿åº¦å°äº 32 çš„å­—ç¬¦ä¸²å¯ä»¥ç”¨ä¸€ä¸ªå­—èŠ‚é•¿åº¦ç¼–ç  `[x00-x1f]`ã€‚
* `[x30-x33] b0 <utf8-data>`
* `x52 b1 b0 <utf8-data> string`
* `S b1 b0 <utf8-data>`
* å­—ç¬¦ä¸²è¢«ç¼–ç æˆå—ã€‚`x53`ï¼ˆ`S`ï¼‰è¡¨ç¤ºæœ€ç»ˆå—ï¼Œ`x52`ï¼ˆ`R`ï¼‰è¡¨ç¤ºä»»ä½•éæœ€ç»ˆå—ã€‚æ¯ä¸ªå—æœ‰ä¸€ä¸ª 16 ä½æ— ç¬¦å·æ•´å‹é•¿åº¦å€¼ã€‚

ç”±æ­¤å¯çŸ¥ï¼ŒHessian å¯¹ä¸åŒé•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œåœ¨ç¼–ç æ—¶ï¼Œå‰ç½®æ ‡å¿—ç¬¦æ˜¯ä¸ä¸€æ ·çš„ã€‚æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š

[source%nowrap,java,{source_attr}]
----
/**
 * æµ‹è¯•å­—ç¬¦ä¸²çš„å¤„ç†
 *
 * @author Dç“œå“¥ Â· https://www.diguage.com/
 */
@Test
public void testString() throws Throwable {
    // 0x00~0x31 0~31
    // 32~255 çš„å‰ç½®æ ‡å¿—ä½æ˜¯ 0x30ï¼Œç„¶åä» 256 å¼€å§‹ï¼Œæ¯éš” 256 ä¸ªä¸€ä¸ªæ ‡å¿—ä½ã€‚
    // 0x30 32~255
    // 0x31 256~511
    // 0x32 512~767
    // 0x33 768~1023
    // ä¹‹æ‰€ä»¥è¿™æ ·ï¼Œæ˜¯å› ä¸ºä½¿ç”¨ä¸€ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºâ€œé•¿åº¦â€ï¼›è€Œ 0ã€1ã€2ã€3 ä¿å­˜åœ¨å‰ç½®æ ‡å¿—ä½çš„æœ«å°¾ã€‚
    // è¿™é‡Œåˆæœ‰ä¸€ä¸ªé”™è¯¯ï¼šHessian2Constants.STRING_SHORT_MAX = 0x3ff æœ€å¤§å€¼æ˜¯ 1023ï¼Œ
    // å¯¹åº” 0x33ã€‚æ‰€ä»¥ï¼Œ0x34 ä¸ä¼šå‡ºç°çš„ã€‚è¶…è¿‡ 1023 ä¹‹åï¼Œå‰ç½®æ ‡å¿—ä½å°±æ˜¯ S äº†ã€‚
    stringTo("");
    // 0~31 ä¹‹é—´ï¼Œç›´æ¥ä½¿ç”¨ä¸€ä¸ªå­—ç¬¦è¿›è¡Œç¼–ç 
    stringTo(getStringByLength("a", 31));
    stringTo(getStringByLength("a", 32));
    // 32~255 ä¹‹é—´ï¼Œä½¿ç”¨ä¸€ä¸ªå‰ç¼€æ ‡å¿—ç¬¦ 0x30(0) + ä¸€ä¸ªå­—ç¬¦è¿›è¡Œç¼–ç 
    stringTo(getStringByLength("a", 255));
    stringTo(getStringByLength("a", 256));
    // 256~511 ä¹‹é—´ï¼Œä½¿ç”¨ä¸€ä¸ªå‰ç¼€æ ‡å¿—ç¬¦ 0x31(1) + ä¸€ä¸ªå­—ç¬¦è¿›è¡Œç¼–ç 
    stringTo(getStringByLength("a", 511));
    stringTo(getStringByLength("a", 512));
    // 512~767 ä¹‹é—´ï¼Œä½¿ç”¨ä¸€ä¸ªå‰ç¼€æ ‡å¿—ç¬¦ 0x32(2) + ä¸€ä¸ªå­—ç¬¦è¿›è¡Œç¼–ç 
    stringTo(getStringByLength("a", 767));
    stringTo(getStringByLength("a", 768));
    // 768~1023 ä¹‹é—´ï¼Œä½¿ç”¨ä¸€ä¸ªå‰ç¼€æ ‡å¿—ç¬¦ 0x33(3) + ä¸€ä¸ªå­—ç¬¦è¿›è¡Œç¼–ç 
    stringTo(getStringByLength("a", 1023));
    stringTo(getStringByLength("a", 1024));
    // 1024~32768 ä¹‹é—´ï¼Œä½¿ç”¨ä¸€ä¸ªå‰ç¼€æ ‡å¿—ç¬¦ 0x53(S) + ä¸¤ä¸ªå­—ç¬¦è¿›è¡Œç¼–ç 

    // æµ‹è¯•å­—ç¬¦ä¸²åˆ†å—
    // æ ¹æ®åè®®ä¸­å¯¹äºå­—ç¬¦ä¸²çš„â€œé•¿åº¦ä¸º 0-65535 çš„å­—ç¬¦ä¸²â€çš„æè¿°ï¼Œ65535 ä¸ºåˆ†å—å¤§å°çš„ç•Œé™ã€‚
    // é‚£ä¹ˆï¼Œé•¿åº¦ä¸º 65535 åº”è¯¥ä¸åˆ†å—ï¼Œa*65535 åºåˆ—åŒ–åï¼Œé•¿åº¦åº”è¯¥æ˜¯ 65535 + 3ã€‚
    // ä½†æ˜¯ï¼Œå®é™…å®éªŒçš„ç»“æœä¸º 65535 + 6ã€‚é‚£ä¹ˆåè®®æè¿°æœ‰é—®é¢˜ã€‚
    // stringTo(getStringByLength("a", 65535));
    //
    // æŸ¥çœ‹ä»£ç ï¼Œåˆ†å—ç›¸å…³ä»£ç çš„åˆ¤æ–­æ¡ä»¶æ˜¯ length > 0x8000ï¼Œé‚£ä¹ˆåˆ†å—è¾¹ç•Œ
    // ä¸º 0x8000 = 32768ã€‚æ ¹æ®è¾“å‡ºï¼Œè·Ÿä»£ç æ˜¯å»åˆçš„ã€‚
    // å¦å¤–ï¼Œåè®®ä¸­â€œ`x53`ï¼ˆ`S`ï¼‰è¡¨ç¤ºæœ€ç»ˆå—â€ çš„è¡¨è¿°ä¸æ­£ç¡®ï¼æœ€ç»ˆå—çš„å‰ç½®æ ‡å¿—ç¬¦æ˜¯ä»€ä¹ˆï¼Œ
    // å¾—çœ‹æˆªå–å®Œå‰é¢çš„åˆ†å—ä¹‹åï¼Œå‰©ä½™çš„å­—ç¬¦çš„ä¸ªæ•°ã€‚å¦‚æœå¤§äº 1023 æ‰ä¼šä»¥ `x53`ï¼ˆ`S`ï¼‰å¼€å¤´ã€‚
    // æœ€ç»ˆå—çš„å‰ç½®æ ‡å¿—ç¬¦ã€‚
    stringTo(getStringByLength("a", 32768));
    stringTo(getStringByLength("a", 32768 + 1));
    stringTo(getStringByLength("a", 32768 + 32));
    stringTo(getStringByLength("a", 32768 + 256));
    stringTo(getStringByLength("a", 32768 + 512));
    stringTo(getStringByLength("a", 32768 + 768));
    stringTo(getStringByLength("a", 32768 + 1024));
}

/**
 * æ ¹æ®å­—ç¬¦ä¸²å’Œé•¿åº¦ç”Ÿæˆå¯¹åº”é•¿çš„å­—ç¬¦ä¸²
 *
 * @author Dç“œå“¥ Â· https://www.diguage.com/
 */
private String getStringByLength(String item, int length) {
    StringBuilder sb = new StringBuilder(length);
    for (int i = 0; i < length; i++) {
        sb.append(item);
    }
    return sb.toString();
}


// -- è¾“å‡ºç»“æœ ------------------------------------------------
== string:  ==
== string: length = 0 ==
== string: value UTF-8 bytes ==
== string: value UTF-16BE bytes ==
== string: hessian result ==
   0 0x00 00000000  

== string: aaaaaaaaaa...31 ==
== string: length = 31 ==
== string: value UTF-8 bytes ==
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 31
== string: value UTF-16BE bytes ==
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
...... 62
== string: hessian result ==
  31 0x1F 00011111 
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 32

== string: aaaaaaaaaa...32 ==
== string: length = 32 ==
== string: value UTF-8 bytes ==
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 32
== string: value UTF-16BE bytes ==
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
...... 64
== string: hessian result ==
  48 0x30 00110000 0
  32 0x20 00100000
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 34

== string: aaaaaaaaaa...255 ==
== string: length = 255 ==
== string: value UTF-8 bytes ==
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 255
== string: value UTF-16BE bytes ==
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
...... 510
== string: hessian result ==
  48 0x30 00110000 0
  -1 0xFF 11111111
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 257

== string: aaaaaaaaaa...256 ==
== string: length = 256 ==
== string: value UTF-8 bytes ==
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 256
== string: value UTF-16BE bytes ==
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
...... 512
== string: hessian result ==
  49 0x31 00110001 1
   0 0x00 00000000  
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 258

== string: aaaaaaaaaa...511 ==
== string: length = 511 ==
== string: value UTF-8 bytes ==
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 511
== string: value UTF-16BE bytes ==
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
...... 1022
== string: hessian result ==
  49 0x31 00110001 1
  -1 0xFF 11111111
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 513

== string: aaaaaaaaaa...512 ==
== string: length = 512 ==
== string: value UTF-8 bytes ==
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 512
== string: value UTF-16BE bytes ==
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
...... 1024
== string: hessian result ==
  50 0x32 00110010 2
   0 0x00 00000000  
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 514

== string: aaaaaaaaaa...767 ==
== string: length = 767 ==
== string: value UTF-8 bytes ==
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 767
== string: value UTF-16BE bytes ==
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
...... 1534
== string: hessian result ==
  50 0x32 00110010 2
  -1 0xFF 11111111
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 769

== string: aaaaaaaaaa...768 ==
== string: length = 768 ==
== string: value UTF-8 bytes ==
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 768
== string: value UTF-16BE bytes ==
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
...... 1536
== string: hessian result ==
  51 0x33 00110011 3
   0 0x00 00000000  
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 770

== string: aaaaaaaaaa...1023 ==
== string: length = 1023 ==
== string: value UTF-8 bytes ==
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 1023
== string: value UTF-16BE bytes ==
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
...... 2046
== string: hessian result ==
  51 0x33 00110011 3
  -1 0xFF 11111111
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 1025

== string: aaaaaaaaaa...1024 ==
== string: length = 1024 ==
== string: value UTF-8 bytes ==
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 1024
== string: value UTF-16BE bytes ==
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
...... 2048
== string: hessian result ==
  83 0x53 01010011 S
   4 0x04 00000100 
   0 0x00 00000000  
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 1027

== string: aaaaaaaaaa...32768 ==
== string: length = 32768 ==
== string: value UTF-8 bytes ==
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 32768
== string: value UTF-16BE bytes ==
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
...... 65536
== string: hessian result ==
  83 0x53 01010011 S
-128 0x80 10000000
   0 0x00 00000000  
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 32771

== string: aaaaaaaaaa...32769 ==
== string: length = 32769 ==
== string: value UTF-8 bytes ==
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 32769
== string: value UTF-16BE bytes ==
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
...... 65538
== string: hessian result ==
.... 0 ~ 4 ....
  82 0x52 01010010 R
-128 0x80 10000000
   0 0x00 00000000  
  97 0x61 01100001 a
.... 32770 ~ 32773 ....
  97 0x61 01100001 a
   1 0x01 00000001 
  97 0x61 01100001 a
...... 32773

== string: aaaaaaaaaa...32800 ==
== string: length = 32800 ==
== string: value UTF-8 bytes ==
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 32800
== string: value UTF-16BE bytes ==
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
...... 65600
== string: hessian result ==
.... 0 ~ 4 ....
  82 0x52 01010010 R
-128 0x80 10000000
   0 0x00 00000000  
  97 0x61 01100001 a
.... 32770 ~ 32775 ....
  97 0x61 01100001 a
  48 0x30 00110000 0
  32 0x20 00100000
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 32805

== string: aaaaaaaaaa...33024 ==
== string: length = 33024 ==
== string: value UTF-8 bytes ==
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 33024
== string: value UTF-16BE bytes ==
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
...... 66048
== string: hessian result ==
.... 0 ~ 4 ....
  82 0x52 01010010 R
-128 0x80 10000000
   0 0x00 00000000  
  97 0x61 01100001 a
.... 32770 ~ 32775 ....
  97 0x61 01100001 a
  49 0x31 00110001 1
   0 0x00 00000000  
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 33029

== string: aaaaaaaaaa...33280 ==
== string: length = 33280 ==
== string: value UTF-8 bytes ==
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 33280
== string: value UTF-16BE bytes ==
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
...... 66560
== string: hessian result ==
.... 0 ~ 4 ....
  82 0x52 01010010 R
-128 0x80 10000000
   0 0x00 00000000  
  97 0x61 01100001 a
.... 32770 ~ 32775 ....
  97 0x61 01100001 a
  50 0x32 00110010 2
   0 0x00 00000000  
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 33285

== string: aaaaaaaaaa...33536 ==
== string: length = 33536 ==
== string: value UTF-8 bytes ==
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 33536
== string: value UTF-16BE bytes ==
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
...... 67072
== string: hessian result ==
.... 0 ~ 4 ....
  82 0x52 01010010 R
-128 0x80 10000000
   0 0x00 00000000  
  97 0x61 01100001 a
.... 32770 ~ 32775 ....
  97 0x61 01100001 a
  51 0x33 00110011 3
   0 0x00 00000000  
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 33541

== string: aaaaaaaaaa...33792 ==
== string: length = 33792 ==
== string: value UTF-8 bytes ==
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
  97 0x61 01100001 a
...... 33792
== string: value UTF-16BE bytes ==
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
   0 0x00 00000000  
  97 0x61 01100001 a
...... 67584
== string: hessian result ==
.... 0 ~ 4 ....
  82 0x52 01010010 R
-128 0x80 10000000
   0 0x00 00000000  
  97 0x61 01100001 a
.... 32770 ~ 32775 ....
  97 0x61 01100001 a
  83 0x53 01010011 S
   4 0x04 00000100 
   0 0x00 00000000  
  97 0x61 01100001 a
...... 33798

----

ç»è¿‡ä¸Šé¢çš„æµ‹è¯•å¯ä»¥å¾—å‡ºï¼š

. `0` ~ `31` ä¹‹é—´ï¼Œç›´æ¥ä½¿ç”¨ä¸€ä¸ªå­—ç¬¦è¿›è¡Œç¼–ç 
. `32` ~ `255` ä¹‹é—´ï¼Œä½¿ç”¨ä¸€ä¸ªå‰ç¼€æ ‡å¿—ç¬¦ `0x30(0)` + ä¸€ä¸ªå­—ç¬¦è¿›è¡Œç¼–ç 
. `256` ~ `511` ä¹‹é—´ï¼Œä½¿ç”¨ä¸€ä¸ªå‰ç¼€æ ‡å¿—ç¬¦ `0x31(1)` + ä¸€ä¸ªå­—ç¬¦è¿›è¡Œç¼–ç 
. `512` ~ `767` ä¹‹é—´ï¼Œä½¿ç”¨ä¸€ä¸ªå‰ç¼€æ ‡å¿—ç¬¦ `0x32(2)` + ä¸€ä¸ªå­—ç¬¦è¿›è¡Œç¼–ç 
. `768` ~ `1023` ä¹‹é—´ï¼Œä½¿ç”¨ä¸€ä¸ªå‰ç¼€æ ‡å¿—ç¬¦ `0x33(3)` + ä¸€ä¸ªå­—ç¬¦è¿›è¡Œç¼–ç 
. `1024` ~ `32768` ä¹‹é—´ï¼Œä½¿ç”¨ä¸€ä¸ªå‰ç¼€æ ‡å¿—ç¬¦ `0x53(S)` + ä¸¤ä¸ªå­—ç¬¦è¿›è¡Œç¼–ç 
. å¦‚æœå­—ç¬¦ä¸²é•¿åº¦å¤§äº `32768`ï¼Œåˆ™ä¼šå…ˆæˆªå–æˆé•¿åº¦ä¸º `32768` çš„ä¸€ä¸ªæˆ–å¤šä¸ªå—ï¼Œä½¿ç”¨ä¸€ä¸ªå‰ç¼€æ ‡å¿—ç¬¦ `0x52\(R)` + ä¸¤ä¸ªå­—ç¬¦è¿›è¡Œç¼–ç ï¼› ä¸å¤Ÿ `32768` çš„éƒ¨åˆ†ï¼Œæ ¹æ®ä»¥ä¸Šæ¡è§„åˆ™è¿›è¡Œç¼–ç ã€‚

æœ‰ä¸€ç‚¹éœ€è¦å¼ºè°ƒï¼š `32768` ä¹Ÿä¸æ˜¯ä¸€æˆä¸å˜çš„ã€‚æ ¹æ®æˆªå–å­—ç¬¦ä¸²çš„æœ€åä¸€ä¸ª `char` æ¥åˆ¤æ–­ã€‚å¦‚æœæœ€åä¸€ä¸ªå­—ç¬¦æ˜¯ high surrogateï¼Œ
å³  `0xD800 \<= Value \<= 0xDBFF`ï¼Œåˆ™ä¼šé•¿åº¦å‡ä¸€ï¼Œå³å‡å°‘ä¸€ä¸ª `char`ï¼Œæ¥ä¿è¯åé¢å­—ç¬¦çš„å®Œæ•´æ€§ã€‚

NOTE: å…³äº â€œhigh surrogateâ€ è¯·é—® <<utf-16>>ã€‚

å¦å¤–ï¼Œä¸Šæ–‡æåˆ°çš„â€œå­—ç¬¦ä¸²é•¿åº¦â€å¹¶ä¸è¡¨ç¤ºæˆ‘ä»¬é€šå¸¸æ„ä¹‰çš„â€œå­—â€çš„ä¸ªæ•°ï¼›è€Œæ˜¯ï¼ŒJava å†…éƒ¨è¡¨ç¤ºå­—ç¬¦ä¸²çš„ char æ•°ç»„çš„é•¿åº¦ã€‚
æ¯”å¦‚ï¼Œä¸€ä¸ª Emoji è¡¨æƒ…å°±æ˜¯ç”¨ä¸¤ä¸ª char æ¥è¡¨ç¤ºï¼Œåˆ™é•¿åº¦ä¸º 2ã€‚

Hessian åè®®ä¸­ï¼Œæœ‰ä¸¤å¤„æè¿°ä¸ä¸¥è°¨ç”šè‡³é”™è¯¯çš„åœ°æ–¹ï¼Œè¿™é‡Œä¹Ÿé‡ç‚¹è¯´æ˜ä¸€ä¸‹ï¼š

. æ ¹æ®åè®®ä¸­å¯¹äºå­—ç¬¦ä¸²çš„â€œé•¿åº¦ä¸º `0` - `65535` çš„å­—ç¬¦ä¸²â€çš„æè¿°ï¼Œ`65535` ä¸ºåˆ†å—å¤§å°çš„ç•Œé™ã€‚ é‚£ä¹ˆï¼Œé•¿åº¦ä¸º `65535` åº”è¯¥ä¸åˆ†å—ï¼Œ`a*65535` åºåˆ—åŒ–åï¼Œé•¿åº¦åº”è¯¥æ˜¯ `65535 + 3`ã€‚ä½†æ˜¯ï¼Œå®é™…å®éªŒçš„ç»“æœä¸º `65535 + 6`ã€‚é‚£ä¹ˆåè®®æè¿°æœ‰é—®é¢˜ã€‚æŸ¥çœ‹ä»£ç ï¼Œåˆ†å—ç›¸å…³ä»£ç çš„åˆ¤æ–­æ¡ä»¶æ˜¯ `length > 0x8000`ï¼Œé‚£ä¹ˆåˆ†å—è¾¹ç•Œä¸º `0x8000 = 32768`ã€‚æ ¹æ®è¾“å‡ºï¼Œè·Ÿä»£ç æ˜¯å»åˆçš„ã€‚
. åè®®ä¸­â€œ`x53`ï¼ˆ`S`ï¼‰è¡¨ç¤ºæœ€ç»ˆå—â€ çš„è¡¨è¿°ä¸æ­£ç¡®ï¼æœ€ç»ˆå—çš„å‰ç½®æ ‡å¿—ç¬¦æ˜¯ä»€ä¹ˆï¼Œ å¾—çœ‹æˆªå–å®Œå‰é¢çš„åˆ†å—ä¹‹åï¼Œå‰©ä½™çš„å­—ç¬¦çš„ä¸ªæ•°ã€‚å¦‚æœå¤§äº 1023 æ‰ä¼šä»¥ `x53`ï¼ˆ`S`ï¼‰å¼€å¤´ã€‚

image::/images/marshal/hessian-string.svg[alt="Hessian å­—ç¬¦ä¸²(string)çš„å¤„ç†",{image_attr}]

å†è¡¥å……ä¸€å¥ï¼šDç“œå“¥ä»¥ä¸ºï¼Œå¯¹äºåˆ†å—çš„å¤„ç†ï¼Œä½¿ç”¨é•¿åº¦ä¸º `32767` æ›´ä¸ºåˆç†ã€‚ç°åœ¨ä½¿ç”¨ `32768`ï¼Œé•¿åº¦æ ‡å¿—ç¬¦çš„ç¼–ç ä¸º `10000000 00000000`ï¼›è€Œéç»ˆå—çš„é•¿åº¦æ ‡å¿—ç¬¦çš„ç¼–ç ä¹Ÿæ˜¯ `10000000 00000000`ï¼Œæœ‰äº›é‡å ï¼ä½¿ç”¨ `32767`ï¼Œåˆ™æ ‡å¿—ç¬¦çš„ç¼–ç ä¸º `01111111 11111111ï¼Œè¿™æ ·å°±å¯ä»¥å’Œéç»ˆå—çš„é•¿åº¦æ ‡å¿—ä½åŒºåˆ†å¼€ã€‚å½“ç„¶ï¼Œè¿™æ˜¯ä¸ªäººæ„è§ã€‚

== å‚è€ƒèµ„æ–™

. https://en.wikipedia.org/wiki/UTF-8[UTF-8 - Wikipedia^]
. https://en.wikipedia.org/wiki/Latin-script_alphabet[Latin-script alphabet - Wikipedia^]
. https://stackoverflow.com/questions/2241348/what-are-unicode-utf-8-and-utf-16[encoding - What are Unicode, UTF-8, and UTF-16?^]
. http://www.unicode.org/notes/tn23/[UTN #23: To the BMP and Beyond^]
. http://www.unicode.org/notes/tn23/Muller-Slides+Narr.pdf[To the BMP and beyond! - Eric Muller^]
. https://www.iteye.com/topic/216577[JAVAé¢è¯•é¢˜è§£æƒ‘ç³»åˆ—ï¼ˆå…­ï¼‰â€”â€”å­—ç¬¦ä¸²ï¼ˆStringï¼‰æ‚è°ˆ^]
. https://docs.oracle.com/javase/specs/jls/se17/html/jls-3.html#jls-3.1[The JavaÂ® Language Specification: ChapterÂ 3.Â Lexical Structure / 3.1. Unicode^]