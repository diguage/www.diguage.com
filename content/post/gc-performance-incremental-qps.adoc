---
title: "Java JVM GC 性能测试（二）"
date: 2024-04-29T22:22:47+08:00
draft: true
keywords: [""]
tags: [""]
categories: [""]
thumbnail: "images/logo/jvm.jpg"
# aliases: "/old/path/"

weight: 1
---

== 压测机器

. J21-G1
.. 4500(平均每台机器900)，特别稳，CPU 80%，感觉还可以加点
.. 5000(平均每台机器1000)，偶尔抖动(不固定机器)，大部分时候很平稳，平均CPU可以干到80%+。
.. 5250（1050），偶尔抖动(不固定机器)，大部分时候很平稳，平均CPU可以干到90%+。
.. 5500（1100），抖动变多(不固定机器)，大部分时候很平稳，平均CPU可以干到95%+。
.. 5750（1150），抖动变多(不固定机器)，出现剧烈抖动，大部分时候很平稳，平均CPU可以干到97%+。
.. 6000（1200），抖动变多(不固定机器)，剧烈抖动频繁出现，大部分时候很平稳，平均CPU可以干到98%+。

. J8-G1: 20*5 850+qps  抖动厉害，压不上去（压力机不给力啊！）
.. 4750(950)，CPU95%+
.. 5000(平均每台机器1000)，抖动幅度比较大，偶尔出现剧烈抖动，CPU99%+
.. 5250(平均每台机器1050)，抖动幅度比较大，频繁出现剧烈抖动，CPU波动（由于剧烈抖动，导致的访问量变少）


. J21-ZGC:
.. 2750（550）,稳定，没有抖动，CPU 81%
.. 3000（600）,稳定，没有抖动，CPU 86%
.. 3250（650）,稳定，没有抖动，CPU 88%
.. 3500（700）,稳定，没有抖动，CPU 91%
.. 3750（750）,稳定，没有抖动，CPU 93%
.. 4000（800）,稳定，没有抖动，CPU 97%
.. 4250（850）,稳定，没有抖动，CPU 99%
.. 4500（900）,稳定，没有抖动，CPU 99%
.. 4750（950）,出现剧烈抖动（五台中的三台），CPU 95%（由于抖动，访问量压不上来）
.. 5000（1000）,全部机器出现剧烈抖动，CPU 80%（由于抖动，访问量压不上来）

. J17-ZGC
.. 第一轮（当前线程池）
.. 2750（550）,稳定，没有抖动，CPU
.. 3000（600）,稳定，没有抖动，CPU
.. 3250（650）,稳定，没有抖动，CPU
.. 3500（700）,稳定，没有抖动，CPU
.. 3750（750）,稳定，没有抖动，CPU 90%
.. 4000（800）,稳定，没有抖动，CPU 93%
.. 4250（850）,稳定，没有抖动，CPU 95%
.. 4500（900）,稳定，没有抖动，CPU 97%
.. 4750（950）,稳定，没有抖动，CPU 99%
.. 5000（1000）,一台机器剧烈抖动，CPU 99%
.. 第二轮（所有线程共享）
.. 2750（550）,稳定，没有抖动，CPU
.. 3000（600）,稳定，没有抖动，CPU
.. 3250（650）,稳定，没有抖动，CPU
.. 3500（700）,稳定，没有抖动，CPU 88%
.. 3750（750）,稳定，没有抖动，CPU 91%
.. 4000（800）,1/5台机器剧烈抖动，CPU 93%（一台机器抖动，访问量降低，导致平均CPU降低）
.. 4250（850）,1/5台机器剧烈抖动，CPU 93%
.. 4500（900）,1/5台机器剧烈抖动，CPU 93%
.. 4750（950）,稳定，没有抖动，CPU 99%
.. 5000（1000）,一台机器剧烈抖动，CPU 99%

. J21 Gen ZGC:
.. 4500(平均每台机器900)，特别稳，CPU 80%，感觉还可以加点
.. 950问题不大，个别机器(五台中的一台，其他很稳)开始疯狂抖动；其他还是很稳，没有特别的抖动，平均CPU可以干到92%+。
.. 1000也还行，个别机器(五台中的二台，其他很稳)开始疯狂抖动；其他还是很稳，没有特别的抖动，平均CPU可以干到96%+。
.. 5250(1050)，个别机器(五台中的三台，其他很稳)开始疯狂抖动；其他还是很稳，没有特别的抖动，平均CPU可以干到99%+。
.. 5500(1100)，全部开始疯狂抖动，平均CPU可以干到99%+。


压测计划：

. 1000 - 30s
. 2000 - 30s
. 3000 - 30s
. 3750 - 300s
. 4000 - 600s
. 4250 - 600s
. 4500 - 600s
. 4750 - 600s
. 5000 - 600s
. 5250 - 600s
. 5500 - 600s

== 压测

开始时间： 2024-04-29 23:13:03

== 4000（800）

开始时间： 2024-04-29 23:19:03

整体平稳

. J21-ZGC CPU 96%
. J17-ZGC CPU 92%
. J8-G1 CPU 87%，YoungGC最频繁，次数是ZGC的三倍
. J21-GenZGC CPU 77%(波动较大)
. J21-G1 CPU 69%(波动较大)

== 4250（850）

开始时间： 2024-04-29 23:29:30

波动变大，从分组的TP999 来看，J8-G1 波动最大，其次是 J21-G1，三个ZGC稳定性解决，最稳的是 J21-Gen-ZGC

. J21-ZGC CPU 98%
. J8-G1 CPU 96%，YoungGC更频繁了，是上个请求量的1.5倍
. J17-ZGC CPU 95%
. J21-GenZGC CPU 83%
. J21-G1 CPU 77%(波动略大)

== 4500（900）

开始时间： 2024-04-29 23:39:30

更多机器（大概5台）开始出现剧烈抖动，分组TP999，J8-G1 波动最大，其次是 J21-ZGC，再次是 J21-G1（也比其他分组高），比较稳定是 J17-ZGC 和 J21-Gen-ZGC(表现最好)。

J8-GC 出现明细剧烈抖动

. J8-G1 CPU 98%，YoungGC更频繁了
. J21-ZGC CPU 98%
. J17-ZGC CPU 95%
. J21-GenZGC CPU 89%
. J21-G1 CPU 83%

== 4750（950）

开始时间： 2024-04-29 23:49:30

. J8-G1 全部机器开始剧烈抖动，CPU也抖动
. J17-ZGC CPU98%
. J21-Gen-ZGC 95%
. J21-G1 CPU 86%
. J21-ZGC 77%(开始出现抖动， 4/5剧烈抖动)

== 5000（1000）

开始时间： 2024-04-29 23:59:30

. J21-ZGC 也开始沦陷 4/5 机器剧烈抖动
. J8-G1 全部机器开始抖动，但是只是个别点在抖，大部分时间是平稳的，感觉是依赖的RPC抖动导致的？？
. J21-Gen-ZGC 2/5 机器开始剧烈抖动，幅度比上两个要小，TP999维持在160ms上下波动（除这个和J21-G1外，其他波动都超过1000ms了）
. J17-ZGC 也很稳，有点说不过去啊！
. J21-G1 还是很稳，TP999波动最稳，维持在100ms左右

== 5250（1050）

开始时间： 2024-04-30 00:09:30

. J21-Gen-ZGC 全部机器开始剧烈抖动，CPU97%
. J21-ZGC 全部机器开始剧烈抖动
. J17-ZGC 3/5 机器开始剧烈抖动
. J8-G1 机器周期性抖动
. J21-G1 整体非常平稳，没有抖动，CPU 95%

== 5500（1100）

开始时间： 2024-04-30 00:19:30

. J21-G1 有个别剧烈抖动，CPU96%，感觉还可以再加点压力
. J8-G1 全部机器开始抖动，但是只是个别点在抖，大部分时间是平稳的，
. 其他分组机器全部沦陷




image::/images/java/gc-performance/[title="",alt="",{image_attr}]
image::/images/java/gc-performance/[title="",alt="",{image_attr}]
image::/images/java/gc-performance/[title="",alt="",{image_attr}]
image::/images/java/gc-performance/[title="",alt="",{image_attr}]
image::/images/java/gc-performance/[title="",alt="",{image_attr}]
image::/images/java/gc-performance/[title="",alt="",{image_attr}]
image::/images/java/gc-performance/[title="",alt="",{image_attr}]
image::/images/java/gc-performance/[title="",alt="",{image_attr}]
image::/images/java/gc-performance/[title="",alt="",{image_attr}]
image::/images/java/gc-performance/[title="",alt="",{image_attr}]



// [source%nowrap,java,{source_attr}]
// ----
// // code
// ----
